{"version":3,"sources":["webpack:///cook-list.686f57b86751c0a8cf41.js","webpack:///./pages/cook-list.js","webpack:///./utils/dish.js?fd4d*","webpack:///./models.js?c847","webpack:///./utils/bind-dish-operation.js?2319","webpack:///./dom/dish.js?1d1f"],"names":["webpackJsonp",0,"module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","dishes","cart","_common","_models","_jquery","_jquery2","_bindDishOperation","_bindDishOperation2","document","ready","Promise","all","User","getUser","Dish","getList","cookingType","then","res","user","shoppingCart","init",387,"toPostDish","item","dish","_id","number","subDish","map","it","hasStock","warehouse","stockWarehouse","some","el","stock","w","every","availableWarehouse","cartList","warehouses","forEach","price","priceOriginal","reduce","p","hasMultipleSelections","count","preferences","length","i","foodMaterial","isSameItemInCart","item1","item2","a","b","plusDish","cartItem","id","unshift","minusDish","splice","getDish","Object","defineProperty","value",442,"undefined","_xwFetch","_xwFetch2","_dish","timer","options","skip","limit","getOne","like","put","logout","post","token_type_hint","token","localStorage","access_token","postCart","filter","postCartRelax","setTimeout",443,"_interopRequireWildcard","newObj","key","prototype","hasOwnProperty","call","parent","dishUtil","dishDom","render","console","warn","bind","plus","minus","event","dishHash","showMinus","keys","_dish2",444,"selectors","plusHandler","minusHandler","$parent","on","target","closest","data","counterSelector","arguments","minusSelector","$counter","find","html","removeClass","hide","hasClass","addClass","show"],"mappings":"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","file":"cook-list.686f57b86751c0a8cf41.js","sourcesContent":["webpackJsonp([2],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _common = __webpack_require__(1);\n\t\n\tvar _models = __webpack_require__(442);\n\t\n\tvar _jquery = __webpack_require__(207);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tvar _bindDishOperation = __webpack_require__(443);\n\t\n\tvar _bindDishOperation2 = _interopRequireDefault(_bindDishOperation);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar dishes, cart;\n\t\n\t(0, _jquery2.default)(document).ready(function () {\n\t    Promise.all([_models.User.getUser(), _models.Dish.getList({ cookingType: 'ready to eat' })]).then(function (res) {\n\t        user = res[0];\n\t        dishes = res[1];\n\t        cart = user && user.shoppingCart || [];\n\t        (0, _common.init)(user);\n\t\n\t        (0, _bindDishOperation2.default)(cart, dishes, '.product-info, .menus');\n\t    });\n\t});\n\n/***/ },\n\n/***/ 387:\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.toPostDish = toPostDish;\n\texports.hasStock = hasStock;\n\texports.availableWarehouse = availableWarehouse;\n\texports.price = price;\n\texports.hasMultipleSelections = hasMultipleSelections;\n\texports.isSameItemInCart = isSameItemInCart;\n\texports.plusDish = plusDish;\n\texports.minusDish = minusDish;\n\texports.getDish = getDish;\n\tfunction toPostDish(item) {\n\t    return {\n\t        dish: item.dish._id,\n\t        number: item.number,\n\t        subDish: item.subDish.map(function (it) {\n\t            return {\n\t                dish: it.dish._id,\n\t                number: it.number\n\t            };\n\t        })\n\t    };\n\t}\n\t\n\tfunction hasStock(item, warehouse) {\n\t    if (item.dish.cookingType == 'ready to cook') {\n\t        return item.dish.stockWarehouse.some(function (el) {\n\t            return el.stock > 0;\n\t        });\n\t    }\n\t    return item.dish.stockWarehouse.some(function (w) {\n\t        return (!warehouse || w.warehouse == warehouse) && w.stock > 0;\n\t    }) && item.subDish && item.subDish.every(function (it) {\n\t        return hasStock(it, warehouse);\n\t    });\n\t}\n\t\n\tfunction availableWarehouse(cartList) {\n\t    var warehouses = {};\n\t    cartList.forEach(function (item) {\n\t        var dish = item.dish;\n\t        dish.stockWarehouse.forEach(function (el) {\n\t            var w = el.warehouse;\n\t            if (!(w in warehouses)) warehouses[w] = true;\n\t            warehouses[w] = warehouses[w] && el.stock > 0;\n\t        });\n\t    });\n\t    return warehouses;\n\t}\n\t\n\tfunction price(item) {\n\t    return item.number * (item.dish.priceOriginal + (!item.subDish ? 0 : item.subDish.reduce(function (p, el) {\n\t        return p + el.dish.priceOriginal;\n\t    }, 0)));\n\t}\n\t\n\tfunction hasMultipleSelections(dish) {\n\t    var count = 0;\n\t    if (dish.preferences.length) {\n\t        var preferences = dish.preferences;\n\t        for (var i = 0; i < preferences.length; i++) {\n\t            count += preferences[i].foodMaterial.length;\n\t        }\n\t    }\n\t    return count > 1;\n\t}\n\t\n\tfunction isSameItemInCart(item1, item2) {\n\t    return item1.dish._id == item2.dish._id && //主dish是否相同\n\t    item1.subDish.every(function (a) {\n\t        //子dish是否全部相同\n\t        return item2.subDish.some(function (b) {\n\t            return a.dish._id == b.dish._id;\n\t        });\n\t    }) && item1.subDish.length == item2.subDish.length;\n\t}\n\t\n\t/**\n\t * 添加菜品到购物车, 如果有多属性则不能直接添加, 通过返回undefined来表示\n\t * @param dish\n\t * @param cart\n\t * @returns {number} - 如果 > 0 则表示直接添加, 否则表示有多属性, 不能直接添加.\n\t */\n\tfunction plusDish(dish, cart) {\n\t    var cartItem;\n\t    if (!hasMultipleSelections(dish)) {\n\t        // 如果没有,则直接操作\n\t        var number;\n\t        cart.some(function (el) {\n\t            if (el.dish._id == dish.id) {\n\t                cartItem = el;\n\t                return true;\n\t            }\n\t        });\n\t\n\t        if (cartItem) {\n\t            // 已经加入到购物车里边\n\t            number = cartItem.number++;\n\t        } else {\n\t            number = 1;\n\t            cart.unshift({\n\t                dish: dish,\n\t                number: number,\n\t                subDish: []\n\t            });\n\t        }\n\t        return number;\n\t    }\n\t}\n\t\n\t/**\n\t * 从购物车中,减去商品.多属性目前不能减(只能在购物车中减),无需考虑.因为没有多属性,只根据dish id即可找到相应item\n\t * @param dish - 这个倒是只用id就可以\n\t * @param cart\n\t * @returns {number}\n\t */\n\tfunction minusDish(dish, cart) {\n\t    var number;\n\t    cart.some(function (el, i) {\n\t        if (el.dish._id == dish.id) {\n\t            number = --el.number;\n\t            if (number == 0) {\n\t                cart.splice(i, 1);\n\t            }\n\t            return true;\n\t        }\n\t    });\n\t    return number;\n\t}\n\t\n\t/**\n\t * 通过id来获取数组中的dish.虽易,而用处极多,以其烦而提之.\n\t * @param dishes\n\t * @param id\n\t * @returns {*}\n\t */\n\tfunction getDish(dishes, id) {\n\t    var dish;\n\t    dishes.some(function (el) {\n\t        if (el._id == id) {\n\t            dish = el;\n\t            return true;\n\t        }\n\t    });\n\t    return dish;\n\t}\n\n/***/ },\n\n/***/ 442:\n/***/ function(module, exports, __webpack_require__) {\n\n\t// 这里的东西不是给react的.\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.User = exports.Dish = undefined;\n\t\n\tvar _xwFetch = __webpack_require__(397);\n\t\n\tvar _xwFetch2 = _interopRequireDefault(_xwFetch);\n\t\n\tvar _dish = __webpack_require__(387);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar Dish = exports.Dish = {\n\t    getList: function getList(options) {\n\t        options = options || {};\n\t        return (0, _xwFetch2.default)('/api/dishes?cookingType=' + (options.cookingType || '') + ('&skip=' + options.skip + '&limit=' + options.limit));\n\t    },\n\t    getOne: function getOne(id) {\n\t        return (0, _xwFetch2.default)('/api/dishes/' + id);\n\t    },\n\t    like: function like(id) {\n\t        return (0, _xwFetch.put)('/api/dishes/' + id + '/like');\n\t    }\n\t};\n\t\n\t// 如何react的部分信息和非react公用呢\n\tvar timer = null;\n\tvar User = exports.User = {\n\t    getUser: function getUser() {\n\t        return (0, _xwFetch2.default)('/api/user').catch(function () {\n\t            return null;\n\t        });\n\t    },\n\t    logout: function logout() {\n\t        return (0, _xwFetch.post)('/api/user/logout', {\n\t            token_type_hint: \"access_token\",\n\t            token: localStorage.access_token\n\t        });\n\t    },\n\t    postCart: function postCart(cart) {\n\t        return (0, _xwFetch.post)('/api/user/shoppingcart', {\n\t            shoppingCart: cart.filter(function (item) {\n\t                return !!item.dish;\n\t            }).map(_dish.toPostDish)\n\t        });\n\t    },\n\t    postCartRelax: function postCartRelax(cart) {\n\t        if (!timer) {\n\t            timer = setTimeout(function () {\n\t                timer = null;\n\t                return User.postCart(cart);\n\t            }, 2000);\n\t        }\n\t    }\n\t};\n\n/***/ },\n\n/***/ 443:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\texports.default = function (cart, dishes, parent) {\n\t    dishDom.bind(parent, { plus: '.plus', minus: '.mius' }, function (event, id) {\n\t        plusDish(id);\n\t    }, function (event, id) {\n\t        minusDish(id);\n\t    });\n\t\n\t    var dishHash = {};\n\t    cart.forEach(function (item) {\n\t        var id = item.dish._id;\n\t        var dish = dishUtil.getDish(dishes, id);\n\t        if (!dishHash[id]) {\n\t            dishHash[id] = {\n\t                number: item.number,\n\t                showMinus: !dishUtil.hasMultipleSelections(dish)\n\t            };\n\t        } else {\n\t            dishHash[id] += item.number;\n\t        }\n\t    });\n\t\n\t    Object.keys(dishHash).forEach(function (id) {\n\t        return dishDom.render(id, dishHash[id].number, dishHash[id].showMinus);\n\t    });\n\t\n\t    function plusDish(id) {\n\t        // 根据id, 找出dish, 判断是否有多属性(如果多属性只有一个也没必要有选择框)\n\t        var dish = dishUtil.getDish(dishes, id);\n\t\n\t        var number = dishUtil.plusDish(dish, cart);\n\t        if (!number) {\n\t            // 数字不存在,表示不能直接添加,需要使用多属性框\n\t            // todo\n\t            console.warn('todo: to complete');\n\t        } else {\n\t            // 表示无需弹出多属性选择框\n\t            _models.User.postCartRelax(cart);\n\t            dishDom.render(id, number, true);\n\t        }\n\t    }\n\t\n\t    function minusDish(id) {\n\t        var dish = dishUtil.getDish(dishes, id);\n\t        var number = dishUtil.minusDish(dish, cart);\n\t        _models.User.postCartRelax(cart);\n\t        dishDom.render(id, number);\n\t    }\n\t};\n\t\n\tvar _models = __webpack_require__(442);\n\t\n\tvar _dish = __webpack_require__(387);\n\t\n\tvar dishUtil = _interopRequireWildcard(_dish);\n\t\n\tvar _dish2 = __webpack_require__(444);\n\t\n\tvar dishDom = _interopRequireWildcard(_dish2);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/***/ },\n\n/***/ 444:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.bind = bind;\n\texports.render = render;\n\t\n\tvar _jquery = __webpack_require__(207);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * 对那些需要加减操作的dish DOMs 进行事件绑定\n\t * @param parent\n\t * @param selectors {object} - {plus[, minus]}\n\t * @param plusHandler {Function} - (event, dishId)=>{\n\t *    有多属性选择时,弹出多属性选择窗口\n\t *    没有时,直接 +1 ,然后调用render方法\n\t * }\n\t * @param minusHandler {Function} - (event, dishId)=>{\n\t *    只在无多属性选择时,才使用. -1, render\n\t * }\n\t */\n\tfunction bind(parent, selectors, plusHandler, minusHandler) {\n\t    var $parent = (0, _jquery2.default)(parent);\n\t\n\t    $parent.on('click', selectors.plus, function (event) {\n\t        var id = (0, _jquery2.default)(event.target).closest('[data-id]').data('id');\n\t        if (!id) return;\n\t        plusHandler(event, id);\n\t    });\n\t\n\t    minusHandler && selectors.minus && (0, _jquery2.default)(parent).on('click', selectors.minus, function (event) {\n\t        var id = (0, _jquery2.default)(event.target).closest('[data-id]').data('id');\n\t        if (!id) return;\n\t        minusHandler(event, id);\n\t    });\n\t}\n\t\n\t/**\n\t * 根据dish的id,来改变对应counter的数值显示,以及减号的显示\n\t * @param id\n\t * @param number\n\t * @param showMinus - 是否显示minus button\n\t * @param counterSelector\n\t * @param minusSelector - minus按钮的选择器\n\t */\n\tfunction render(id, number, showMinus) {\n\t    var counterSelector = arguments.length <= 3 || arguments[3] === undefined ? '.plusok' : arguments[3];\n\t    var minusSelector = arguments.length <= 4 || arguments[4] === undefined ? '.mius' : arguments[4];\n\t\n\t    var $parent = (0, _jquery2.default)('[data-id=\"' + id + '\"]');\n\t    var $counter = $parent.find(counterSelector).html(number);\n\t    if (number == 0) {\n\t        $counter.removeClass('show');\n\t        $parent.find(minusSelector).hide();\n\t    }\n\t    if (number >= 1 && !$counter.hasClass('show')) {\n\t        $counter.addClass('show');\n\t    }\n\t    if (showMinus && number > 0) {\n\t        $parent.find(minusSelector).show();\n\t    }\n\t}\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** cook-list.686f57b86751c0a8cf41.js\n **/","\"use strict\";\n\nimport {init as initCommon} from './common'\nimport {User, Dish} from '../models'\nimport $ from 'jquery'\nimport bindDish from '../utils/bind-dish-operation'\n\nvar dishes, cart\n\n$(document).ready(() => {\n    Promise.all([\n        User.getUser(),\n        Dish.getList({cookingType: 'ready to eat'})\n    ]).then(res => {\n        user = res[0]\n        dishes = res[1]\n        cart = user && user.shoppingCart || []\n        initCommon(user)\n\n        bindDish(cart, dishes, '.product-info, .menus')\n    })\n})\n\n\n\n/** WEBPACK FOOTER **\n ** ./pages/cook-list.js\n **/","export function toPostDish(item) {\n    return {\n        dish: item.dish._id,\n        number: item.number,\n        subDish: item.subDish.map( it=>{\n            return {\n                dish: it.dish._id,\n                number: it.number\n            }\n        })\n    }\n}\n\nexport function hasStock(item, warehouse) {\n    if (item.dish.cookingType == 'ready to cook') {\n        return item.dish.stockWarehouse.some(el => el.stock > 0)\n    }\n    return item.dish.stockWarehouse.some(w => (!warehouse || w.warehouse == warehouse) && w.stock > 0)\n        && item.subDish && item.subDish.every(it => hasStock(it, warehouse))\n}\n\nexport function availableWarehouse(cartList) {\n    var warehouses= {}\n    cartList.forEach(item =>{\n        var dish = item.dish\n        dish.stockWarehouse.forEach(el => {\n            var w = el.warehouse\n            if (!(w in warehouses))\n                warehouses[w] = true\n            warehouses[w] = warehouses[w] && el.stock > 0\n        })\n    })\n    return warehouses\n}\n\nexport function price(item) {\n    return item.number * (item.dish.priceOriginal + (!item.subDish ? 0 :\n        item.subDish.reduce((p, el) => p + el.dish.priceOriginal, 0)))\n}\n\nexport function hasMultipleSelections(dish) {\n    var count = 0\n    if (dish.preferences.length) {\n        var preferences = dish.preferences\n        for (var i = 0; i < preferences.length; i++) {\n            count += preferences[i].foodMaterial.length\n        }\n    }\n    return count > 1\n}\n\nexport function isSameItemInCart(item1, item2) {\n    return item1.dish._id == item2.dish._id && //主dish是否相同\n        item1.subDish.every(function (a) { //子dish是否全部相同\n            return item2.subDish.some(function (b) {\n                return a.dish._id == b.dish._id\n            })\n        }) && item1.subDish.length == item2.subDish.length;\n}\n\n/**\n * 添加菜品到购物车, 如果有多属性则不能直接添加, 通过返回undefined来表示\n * @param dish\n * @param cart\n * @returns {number} - 如果 > 0 则表示直接添加, 否则表示有多属性, 不能直接添加.\n */\nexport function plusDish(dish, cart) {\n    var cartItem\n    if (!hasMultipleSelections(dish)) {\n        // 如果没有,则直接操作\n        var number\n        cart.some(function (el) {\n            if (el.dish._id == dish.id) {\n                cartItem = el\n                return true\n            }\n        })\n\n        if (cartItem) { // 已经加入到购物车里边\n            number = cartItem.number++\n        } else {\n            number = 1\n            cart.unshift({\n                dish: dish,\n                number: number,\n                subDish: []\n            })\n        }\n        return number\n    }\n}\n\n/**\n * 从购物车中,减去商品.多属性目前不能减(只能在购物车中减),无需考虑.因为没有多属性,只根据dish id即可找到相应item\n * @param dish - 这个倒是只用id就可以\n * @param cart\n * @returns {number}\n */\nexport function minusDish(dish, cart) {\n    var number\n    cart.some((el, i) => {\n        if (el.dish._id == dish.id) {\n            number = --el.number\n            if (number == 0) {\n                cart.splice(i, 1)\n            }\n            return true\n        }\n    })\n    return number\n}\n\n/**\n * 通过id来获取数组中的dish.虽易,而用处极多,以其烦而提之.\n * @param dishes\n * @param id\n * @returns {*}\n */\nexport function getDish(dishes, id) {\n    var dish\n    dishes.some(el => {\n        if (el._id == id) {\n            dish = el\n            return true\n        }\n    })\n    return dish\n}\n\n\n/** WEBPACK FOOTER **\n ** ./utils/dish.js\n **/","// 这里的东西不是给react的.\n\"use strict\";\n\nimport fetch, {post, put} from './utils/xw-fetch'\nimport {toPostDish} from './utils/dish'\n\nexport var Dish = {\n    getList: function (options) {\n        options = options || {}\n        return fetch(`/api/dishes?cookingType=${options.cookingType||''}` +\n            `&skip=${options.skip}&limit=${options.limit}`)\n    },\n    getOne: function (id) {\n        return fetch(`/api/dishes/${id}`)\n    },\n    like: function (id) {\n        return put(`/api/dishes/${id}/like`)\n    }\n}\n\n// 如何react的部分信息和非react公用呢\nvar timer = null\nexport var User = {\n    getUser: function () {\n        return fetch('/api/user').catch(() => null)\n    },\n    logout: function () {\n        return post('/api/user/logout', {\n            token_type_hint: \"access_token\",\n            token: localStorage.access_token\n        })\n    },\n    postCart: function (cart) {\n        return post('/api/user/shoppingcart', {\n            shoppingCart: cart\n                .filter(item => !!item.dish)\n                .map(toPostDish)\n        })\n    },\n    postCartRelax: function (cart) {\n        if (!timer) {\n            timer = setTimeout(()=> {\n                timer = null;\n                return User.postCart(cart)\n            }, 2000)\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./models.js\n **/","import {User, Dish} from '../models'\nimport * as dishUtil from '../utils/dish'\nimport * as dishDom from '../dom/dish'\n\n/**\n * 对dish的基本操作做绑定,给首页,食材包,便当列表页,以及食材包详情页用\n * todo: 其实分离也许更好, 实在是太相似,所以放这里\n * @param cart\n * @param dishes\n * @param parent\n */\nexport default function (cart, dishes, parent) {\n    dishDom.bind(parent,\n        {plus: '.plus', minus: '.mius'},\n        (event, id) => {plusDish(id)},\n        (event, id) => {minusDish(id)}\n    )\n\n    var dishHash = {}\n    cart.forEach(item => {\n        var id = item.dish._id\n        var dish = dishUtil.getDish(dishes, id)\n        if (!dishHash[id]) {\n            dishHash[id] = {\n                number: item.number,\n                showMinus: !dishUtil.hasMultipleSelections(dish)\n            }\n        } else {\n            dishHash[id] += item.number\n        }\n    })\n\n    Object.keys(dishHash).forEach(id =>\n        dishDom.render(id, dishHash[id].number, dishHash[id].showMinus))\n\n    function plusDish(id) {\n        // 根据id, 找出dish, 判断是否有多属性(如果多属性只有一个也没必要有选择框)\n        var dish = dishUtil.getDish(dishes, id)\n\n        var number = dishUtil.plusDish(dish, cart)\n        if (!number) { // 数字不存在,表示不能直接添加,需要使用多属性框\n            // todo\n            console.warn('todo: to complete')\n        } else { // 表示无需弹出多属性选择框\n            User.postCartRelax(cart)\n            dishDom.render(id, number, true)\n        }\n    }\n\n    function minusDish(id) {\n        var dish = dishUtil.getDish(dishes, id)\n        var number = dishUtil.minusDish(dish, cart)\n        User.postCartRelax(cart)\n        dishDom.render(id, number)\n    }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./utils/bind-dish-operation.js\n **/","\"use strict\";\n\nimport $ from 'jquery'\n\n/**\n * 对那些需要加减操作的dish DOMs 进行事件绑定\n * @param parent\n * @param selectors {object} - {plus[, minus]}\n * @param plusHandler {Function} - (event, dishId)=>{\n *    有多属性选择时,弹出多属性选择窗口\n *    没有时,直接 +1 ,然后调用render方法\n * }\n * @param minusHandler {Function} - (event, dishId)=>{\n *    只在无多属性选择时,才使用. -1, render\n * }\n */\nexport function bind(parent, selectors, plusHandler, minusHandler) {\n    var $parent = $(parent)\n\n    $parent.on('click', selectors.plus, function (event) {\n        var id = $(event.target).closest('[data-id]').data('id')\n        if (!id) return\n        plusHandler(event, id)\n    })\n\n    minusHandler && selectors.minus && $(parent).on('click', selectors.minus, function (event) {\n        var id = $(event.target).closest('[data-id]').data('id')\n        if (!id) return\n        minusHandler(event, id)\n    })\n}\n\n/**\n * 根据dish的id,来改变对应counter的数值显示,以及减号的显示\n * @param id\n * @param number\n * @param showMinus - 是否显示minus button\n * @param counterSelector\n * @param minusSelector - minus按钮的选择器\n */\nexport function render(id, number, showMinus, counterSelector='.plusok', minusSelector='.mius') {\n    var $parent = $(`[data-id=\"${id}\"]`)\n    var $counter = $parent.find(counterSelector).html(number)\n    if (number == 0) {\n        $counter.removeClass('show')\n        $parent.find(minusSelector).hide()\n    }\n    if (number >= 1 && !$counter.hasClass('show')) {\n        $counter.addClass('show')\n    }\n    if (showMinus && number > 0) {\n        $parent.find(minusSelector).show()\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./dom/dish.js\n **/"],"sourceRoot":""}