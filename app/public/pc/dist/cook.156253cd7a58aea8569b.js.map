{"version":3,"sources":["webpack:///cook.156253cd7a58aea8569b.js","webpack:///./pages/cook.js","webpack:///./utils/dish.js?fd4d***","webpack:///./models.js?c847*","webpack:///./dom/dish.js?1d1f*","webpack:///./utils/bind-dish-operation.js?2319*"],"names":["webpackJsonp",0,"module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","dishes","cart","user","_common","_models","_jquery","_jquery2","_bindDishOperation","_bindDishOperation2","document","ready","Promise","all","User","getUser","Dish","getOne","data","then","res","shoppingCart","init","bindTab",28,"toPostDish","item","dish","_id","number","subDish","map","it","hasStock","warehouse","cookingType","stockWarehouse","some","el","stock","w","every","availableWarehouse","cartList","warehouses","forEach","price","priceOriginal","reduce","p","hasMultipleSelections","count","preferences","length","i","foodMaterial","isSameItemInCart","item1","item2","a","b","plusDish","cartItem","id","unshift","minusDish","splice","getDish","Object","defineProperty","value",46,"undefined","_xwFetch","_xwFetch2","_dish","timer","getList","options","skip","limit","like","put","logout","post","token_type_hint","token","localStorage","access_token","postCart","filter","postCartRelax","setTimeout",118,"bind","parent","selectors","plusHandler","minusHandler","$parent","on","plus","event","target","closest","minus","render","showMinus","counterSelector","arguments","minusSelector","$counter","find","html","removeClass","hide","hasClass","addClass","show",120,"_interopRequireWildcard","newObj","key","prototype","hasOwnProperty","call","tabs","tabsContainer","activeClass","$tabs","$tabBtnContainer","$tabBtns","children","e","index","eq","dishUtil","dishDom","console","warn","dishHash","keys","_dish2"],"mappings":"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","file":"cook.156253cd7a58aea8569b.js","sourcesContent":["webpackJsonp([6],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tvar _common = __webpack_require__(119);\n\t\n\tvar _models = __webpack_require__(46);\n\t\n\tvar _jquery = __webpack_require__(45);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tvar _bindDishOperation = __webpack_require__(120);\n\t\n\tvar _bindDishOperation2 = _interopRequireDefault(_bindDishOperation);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar dishes, cart, user;\n\t\n\t(0, _jquery2.default)(document).ready(function () {\n\t    Promise.all([_models.User.getUser(), _models.Dish.getOne((0, _jquery2.default)('.product-info').data('id'))]).then(function (res) {\n\t        user = res[0];\n\t        dishes = [res[1]];\n\t        cart = user && user.shoppingCart || [];\n\t        (0, _common.init)(user);\n\t\n\t        (0, _bindDishOperation2.default)(cart, dishes, '.product-info');\n\t    });\n\t\n\t    (0, _bindDishOperation.bindTab)('.tabs > div', '.tabbtn', 'act');\n\t});\n\n/***/ },\n\n/***/ 28:\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.toPostDish = toPostDish;\n\texports.hasStock = hasStock;\n\texports.availableWarehouse = availableWarehouse;\n\texports.price = price;\n\texports.hasMultipleSelections = hasMultipleSelections;\n\texports.isSameItemInCart = isSameItemInCart;\n\texports.plusDish = plusDish;\n\texports.minusDish = minusDish;\n\texports.getDish = getDish;\n\tfunction toPostDish(item) {\n\t    return {\n\t        dish: item.dish._id,\n\t        number: item.number,\n\t        subDish: item.subDish.map(function (it) {\n\t            return {\n\t                dish: it.dish._id,\n\t                number: it.number\n\t            };\n\t        })\n\t    };\n\t}\n\t\n\tfunction hasStock(item, warehouse) {\n\t    if (item.dish.cookingType == 'ready to cook') {\n\t        return item.dish.stockWarehouse.some(function (el) {\n\t            return el.stock > 0;\n\t        });\n\t    }\n\t    return item.dish.stockWarehouse.some(function (w) {\n\t        return (!warehouse || w.warehouse == warehouse) && w.stock > 0;\n\t    }) && item.subDish && item.subDish.every(function (it) {\n\t        return hasStock(it, warehouse);\n\t    });\n\t}\n\t\n\tfunction availableWarehouse(cartList) {\n\t    var warehouses = {};\n\t    cartList.forEach(function (item) {\n\t        var dish = item.dish;\n\t        dish.stockWarehouse.forEach(function (el) {\n\t            var w = el.warehouse;\n\t            if (!(w in warehouses)) warehouses[w] = true;\n\t            warehouses[w] = warehouses[w] && el.stock > 0;\n\t        });\n\t    });\n\t    return warehouses;\n\t}\n\t\n\tfunction price(item) {\n\t    return item.number * (item.dish.priceOriginal + (!item.subDish ? 0 : item.subDish.reduce(function (p, el) {\n\t        return p + el.dish.priceOriginal;\n\t    }, 0)));\n\t}\n\t\n\tfunction hasMultipleSelections(dish) {\n\t    var count = 0;\n\t    if (dish.preferences.length) {\n\t        var preferences = dish.preferences;\n\t        for (var i = 0; i < preferences.length; i++) {\n\t            count += preferences[i].foodMaterial.length;\n\t        }\n\t    }\n\t    return count > 1;\n\t}\n\t\n\tfunction isSameItemInCart(item1, item2) {\n\t    return item1.dish._id == item2.dish._id && //主dish是否相同\n\t    item1.subDish.every(function (a) {\n\t        //子dish是否全部相同\n\t        return item2.subDish.some(function (b) {\n\t            return a.dish._id == b.dish._id;\n\t        });\n\t    }) && item1.subDish.length == item2.subDish.length;\n\t}\n\t\n\t/**\n\t * 添加菜品到购物车, 如果有多属性则不能直接添加, 通过返回undefined来表示\n\t * @param dish\n\t * @param cart\n\t * @returns {number} - 如果 > 0 则表示直接添加, 否则表示有多属性, 不能直接添加.\n\t */\n\tfunction plusDish(dish, cart) {\n\t    var cartItem;\n\t    if (!hasMultipleSelections(dish)) {\n\t        // 如果没有,则直接操作\n\t        var number;\n\t        cart.some(function (el) {\n\t            if (el.dish._id == dish.id) {\n\t                cartItem = el;\n\t                return true;\n\t            }\n\t        });\n\t\n\t        if (cartItem) {\n\t            // 已经加入到购物车里边\n\t            number = cartItem.number++;\n\t        } else {\n\t            number = 1;\n\t            cart.unshift({\n\t                dish: dish,\n\t                number: number,\n\t                subDish: []\n\t            });\n\t        }\n\t        return number;\n\t    }\n\t}\n\t\n\t/**\n\t * 从购物车中,减去商品.多属性目前不能减(只能在购物车中减),无需考虑.因为没有多属性,只根据dish id即可找到相应item\n\t * @param dish - 这个倒是只用id就可以\n\t * @param cart\n\t * @returns {number}\n\t */\n\tfunction minusDish(dish, cart) {\n\t    var number;\n\t    cart.some(function (el, i) {\n\t        if (el.dish._id == dish.id) {\n\t            number = --el.number;\n\t            if (number == 0) {\n\t                cart.splice(i, 1);\n\t            }\n\t            return true;\n\t        }\n\t    });\n\t    return number;\n\t}\n\t\n\t/**\n\t * 通过id来获取数组中的dish.虽易,而用处极多,以其烦而提之.\n\t * @param dishes\n\t * @param id\n\t * @returns {*}\n\t */\n\tfunction getDish(dishes, id) {\n\t    var dish;\n\t    dishes.some(function (el) {\n\t        if (el._id == id) {\n\t            dish = el;\n\t            return true;\n\t        }\n\t    });\n\t    return dish;\n\t}\n\n/***/ },\n\n/***/ 46:\n/***/ function(module, exports, __webpack_require__) {\n\n\t// 这里的东西不是给react的.\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.User = exports.Dish = undefined;\n\t\n\tvar _xwFetch = __webpack_require__(27);\n\t\n\tvar _xwFetch2 = _interopRequireDefault(_xwFetch);\n\t\n\tvar _dish = __webpack_require__(28);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar Dish = exports.Dish = {\n\t    getList: function getList(options) {\n\t        options = options || {};\n\t        return (0, _xwFetch2.default)('/api/dishes?cookingType=' + (options.cookingType || '') + ('&skip=' + (options.skip || '') + '&limit=' + (options.limit || '')));\n\t    },\n\t    getOne: function getOne(id) {\n\t        return (0, _xwFetch2.default)('/api/dishes/' + id);\n\t    },\n\t    like: function like(id) {\n\t        return (0, _xwFetch.put)('/api/dishes/' + id + '/like');\n\t    }\n\t};\n\t\n\t// 如何react的部分信息和非react公用呢\n\tvar timer = null;\n\tvar User = exports.User = {\n\t    getUser: function getUser() {\n\t        return (0, _xwFetch2.default)('/api/user').catch(function () {\n\t            return null;\n\t        });\n\t    },\n\t    logout: function logout() {\n\t        return (0, _xwFetch.post)('/api/user/logout', {\n\t            token_type_hint: \"access_token\",\n\t            token: localStorage.access_token\n\t        });\n\t    },\n\t    postCart: function postCart(cart) {\n\t        return (0, _xwFetch.post)('/api/user/shoppingcart', {\n\t            shoppingCart: cart.filter(function (item) {\n\t                return !!item.dish;\n\t            }).map(_dish.toPostDish)\n\t        });\n\t    },\n\t    postCartRelax: function postCartRelax(cart) {\n\t        if (!timer) {\n\t            timer = setTimeout(function () {\n\t                timer = null;\n\t                return User.postCart(cart);\n\t            }, 2000);\n\t        }\n\t    }\n\t};\n\n/***/ },\n\n/***/ 118:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.bind = bind;\n\texports.render = render;\n\t\n\tvar _jquery = __webpack_require__(45);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * 对那些需要加减操作的dish DOMs 进行事件绑定\n\t * @param parent\n\t * @param selectors {object} - {plus[, minus]}\n\t * @param plusHandler {Function} - (event, dishId)=>{\n\t *    有多属性选择时,弹出多属性选择窗口\n\t *    没有时,直接 +1 ,然后调用render方法\n\t * }\n\t * @param minusHandler {Function} - (event, dishId)=>{\n\t *    只在无多属性选择时,才使用. -1, render\n\t * }\n\t */\n\tfunction bind(parent, selectors, plusHandler, minusHandler) {\n\t    var $parent = (0, _jquery2.default)(parent);\n\t\n\t    $parent.on('click', selectors.plus, function (event) {\n\t        var id = (0, _jquery2.default)(event.target).closest('[data-id]').data('id');\n\t        if (!id) return;\n\t        plusHandler(event, id);\n\t    });\n\t\n\t    minusHandler && selectors.minus && (0, _jquery2.default)(parent).on('click', selectors.minus, function (event) {\n\t        var id = (0, _jquery2.default)(event.target).closest('[data-id]').data('id');\n\t        if (!id) return;\n\t        minusHandler(event, id);\n\t    });\n\t}\n\t\n\t/**\n\t * 根据dish的id,来改变对应counter的数值显示,以及减号的显示\n\t * @param id\n\t * @param number\n\t * @param showMinus - 是否显示minus button\n\t * @param counterSelector\n\t * @param minusSelector - minus按钮的选择器\n\t */\n\tfunction render(id, number, showMinus) {\n\t    var counterSelector = arguments.length <= 3 || arguments[3] === undefined ? '.plusok' : arguments[3];\n\t    var minusSelector = arguments.length <= 4 || arguments[4] === undefined ? '.mius' : arguments[4];\n\t\n\t    var $parent = (0, _jquery2.default)('[data-id=\"' + id + '\"]');\n\t    var $counter = $parent.find(counterSelector).html(number);\n\t    if (number == 0) {\n\t        $counter.removeClass('show');\n\t        $parent.find(minusSelector).hide();\n\t    }\n\t    if (number >= 1 && !$counter.hasClass('show')) {\n\t        $counter.addClass('show');\n\t    }\n\t    if (showMinus && number > 0) {\n\t        $parent.find(minusSelector).show();\n\t    }\n\t}\n\n/***/ },\n\n/***/ 120:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\texports.default = function (cart, dishes, parent) {\n\t    dishDom.bind(parent, { plus: '.plus', minus: '.mius' }, function (event, id) {\n\t        plusDish(id);\n\t    }, function (event, id) {\n\t        minusDish(id);\n\t    });\n\t\n\t    var dishHash = {};\n\t    cart.forEach(function (item) {\n\t        var id = item.dish._id;\n\t        var dish = dishUtil.getDish(dishes, id);\n\t        if (!dishHash[id]) {\n\t            dishHash[id] = {\n\t                number: item.number,\n\t                showMinus: !dishUtil.hasMultipleSelections(dish)\n\t            };\n\t        } else {\n\t            dishHash[id] += item.number;\n\t        }\n\t    });\n\t\n\t    Object.keys(dishHash).forEach(function (id) {\n\t        return dishDom.render(id, dishHash[id].number, dishHash[id].showMinus);\n\t    });\n\t\n\t    function plusDish(id) {\n\t        // 根据id, 找出dish, 判断是否有多属性(如果多属性只有一个也没必要有选择框)\n\t        var dish = dishUtil.getDish(dishes, id);\n\t\n\t        var number = dishUtil.plusDish(dish, cart);\n\t        if (!number) {\n\t            // 数字不存在,表示不能直接添加,需要使用多属性框\n\t            // todo\n\t            console.warn('todo: to complete');\n\t        } else {\n\t            // 表示无需弹出多属性选择框\n\t            _models.User.postCartRelax(cart);\n\t            dishDom.render(id, number, true);\n\t        }\n\t    }\n\t\n\t    function minusDish(id) {\n\t        var dish = dishUtil.getDish(dishes, id);\n\t        var number = dishUtil.minusDish(dish, cart);\n\t        _models.User.postCartRelax(cart);\n\t        dishDom.render(id, number);\n\t    }\n\t};\n\t\n\texports.bindTab = bindTab;\n\t\n\tvar _jquery = __webpack_require__(45);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tvar _models = __webpack_require__(46);\n\t\n\tvar _dish = __webpack_require__(28);\n\t\n\tvar dishUtil = _interopRequireWildcard(_dish);\n\t\n\tvar _dish2 = __webpack_require__(118);\n\t\n\tvar dishDom = _interopRequireWildcard(_dish2);\n\t\n\tfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction bindTab(tabs, tabsContainer, activeClass) {\n\t    // tab切换事件绑定\n\t    var $tabs = (0, _jquery2.default)(tabs);\n\t    var $tabBtnContainer = (0, _jquery2.default)(tabsContainer);\n\t    var $tabBtns = $tabBtnContainer.children();\n\t    $tabBtnContainer.on('click', function (e) {\n\t        var index = (0, _jquery2.default)(e.target).index();\n\t        $tabBtns.removeClass(activeClass).eq(index).addClass(activeClass);\n\t        $tabs.hide().eq(index).show();\n\t    });\n\t}\n\t\n\t/**\n\t * 对dish的基本操作做绑定,给首页,食材包,便当列表页,以及食材包详情页用\n\t * todo: 其实分离也许更好, 实在是太相似,所以放这里\n\t * @param cart\n\t * @param dishes\n\t * @param parent\n\t */\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** cook.156253cd7a58aea8569b.js\n **/","\"use strict\";\n\nimport {init as initCommon} from './common'\nimport {User, Dish} from '../models'\nimport $ from 'jquery'\nimport bindDish, {bindTab} from '../utils/bind-dish-operation'\n\nvar dishes, cart, user\n\n$(document).ready(() => {\n    Promise.all([\n        User.getUser(),\n        Dish.getOne($('.product-info').data('id'))\n    ]).then(res => {\n        user = res[0]\n        dishes = [res[1]]\n        cart = user && user.shoppingCart || []\n        initCommon(user)\n\n        bindDish(cart, dishes, '.product-info')\n    })\n\n    bindTab('.tabs > div', '.tabbtn', 'act')\n})\n\n\n/** WEBPACK FOOTER **\n ** ./pages/cook.js\n **/","export function toPostDish(item) {\n    return {\n        dish: item.dish._id,\n        number: item.number,\n        subDish: item.subDish.map( it=>{\n            return {\n                dish: it.dish._id,\n                number: it.number\n            }\n        })\n    }\n}\n\nexport function hasStock(item, warehouse) {\n    if (item.dish.cookingType == 'ready to cook') {\n        return item.dish.stockWarehouse.some(el => el.stock > 0)\n    }\n    return item.dish.stockWarehouse.some(w => (!warehouse || w.warehouse == warehouse) && w.stock > 0)\n        && item.subDish && item.subDish.every(it => hasStock(it, warehouse))\n}\n\nexport function availableWarehouse(cartList) {\n    var warehouses= {}\n    cartList.forEach(item =>{\n        var dish = item.dish\n        dish.stockWarehouse.forEach(el => {\n            var w = el.warehouse\n            if (!(w in warehouses))\n                warehouses[w] = true\n            warehouses[w] = warehouses[w] && el.stock > 0\n        })\n    })\n    return warehouses\n}\n\nexport function price(item) {\n    return item.number * (item.dish.priceOriginal + (!item.subDish ? 0 :\n        item.subDish.reduce((p, el) => p + el.dish.priceOriginal, 0)))\n}\n\nexport function hasMultipleSelections(dish) {\n    var count = 0\n    if (dish.preferences.length) {\n        var preferences = dish.preferences\n        for (var i = 0; i < preferences.length; i++) {\n            count += preferences[i].foodMaterial.length\n        }\n    }\n    return count > 1\n}\n\nexport function isSameItemInCart(item1, item2) {\n    return item1.dish._id == item2.dish._id && //主dish是否相同\n        item1.subDish.every(function (a) { //子dish是否全部相同\n            return item2.subDish.some(function (b) {\n                return a.dish._id == b.dish._id\n            })\n        }) && item1.subDish.length == item2.subDish.length;\n}\n\n/**\n * 添加菜品到购物车, 如果有多属性则不能直接添加, 通过返回undefined来表示\n * @param dish\n * @param cart\n * @returns {number} - 如果 > 0 则表示直接添加, 否则表示有多属性, 不能直接添加.\n */\nexport function plusDish(dish, cart) {\n    var cartItem\n    if (!hasMultipleSelections(dish)) {\n        // 如果没有,则直接操作\n        var number\n        cart.some(function (el) {\n            if (el.dish._id == dish.id) {\n                cartItem = el\n                return true\n            }\n        })\n\n        if (cartItem) { // 已经加入到购物车里边\n            number = cartItem.number++\n        } else {\n            number = 1\n            cart.unshift({\n                dish: dish,\n                number: number,\n                subDish: []\n            })\n        }\n        return number\n    }\n}\n\n/**\n * 从购物车中,减去商品.多属性目前不能减(只能在购物车中减),无需考虑.因为没有多属性,只根据dish id即可找到相应item\n * @param dish - 这个倒是只用id就可以\n * @param cart\n * @returns {number}\n */\nexport function minusDish(dish, cart) {\n    var number\n    cart.some((el, i) => {\n        if (el.dish._id == dish.id) {\n            number = --el.number\n            if (number == 0) {\n                cart.splice(i, 1)\n            }\n            return true\n        }\n    })\n    return number\n}\n\n/**\n * 通过id来获取数组中的dish.虽易,而用处极多,以其烦而提之.\n * @param dishes\n * @param id\n * @returns {*}\n */\nexport function getDish(dishes, id) {\n    var dish\n    dishes.some(el => {\n        if (el._id == id) {\n            dish = el\n            return true\n        }\n    })\n    return dish\n}\n\n\n/** WEBPACK FOOTER **\n ** ./utils/dish.js\n **/","// 这里的东西不是给react的.\n\"use strict\";\n\nimport fetch, {post, put} from './utils/xw-fetch'\nimport {toPostDish} from './utils/dish'\n\nexport var Dish = {\n    getList: function (options) {\n        options = options || {}\n        return fetch(`/api/dishes?cookingType=${options.cookingType||''}` +\n            `&skip=${options.skip||''}&limit=${options.limit||''}`)\n    },\n    getOne: function (id) {\n        return fetch(`/api/dishes/${id}`)\n    },\n    like: function (id) {\n        return put(`/api/dishes/${id}/like`)\n    }\n}\n\n// 如何react的部分信息和非react公用呢\nvar timer = null\nexport var User = {\n    getUser: function () {\n        return fetch('/api/user').catch(() => null)\n    },\n    logout: function () {\n        return post('/api/user/logout', {\n            token_type_hint: \"access_token\",\n            token: localStorage.access_token\n        })\n    },\n    postCart: function (cart) {\n        return post('/api/user/shoppingcart', {\n            shoppingCart: cart\n                .filter(item => !!item.dish)\n                .map(toPostDish)\n        })\n    },\n    postCartRelax: function (cart) {\n        if (!timer) {\n            timer = setTimeout(()=> {\n                timer = null;\n                return User.postCart(cart)\n            }, 2000)\n        }\n    }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./models.js\n **/","\"use strict\";\n\nimport $ from 'jquery'\n\n/**\n * 对那些需要加减操作的dish DOMs 进行事件绑定\n * @param parent\n * @param selectors {object} - {plus[, minus]}\n * @param plusHandler {Function} - (event, dishId)=>{\n *    有多属性选择时,弹出多属性选择窗口\n *    没有时,直接 +1 ,然后调用render方法\n * }\n * @param minusHandler {Function} - (event, dishId)=>{\n *    只在无多属性选择时,才使用. -1, render\n * }\n */\nexport function bind(parent, selectors, plusHandler, minusHandler) {\n    var $parent = $(parent)\n\n    $parent.on('click', selectors.plus, function (event) {\n        var id = $(event.target).closest('[data-id]').data('id')\n        if (!id) return\n        plusHandler(event, id)\n    })\n\n    minusHandler && selectors.minus && $(parent).on('click', selectors.minus, function (event) {\n        var id = $(event.target).closest('[data-id]').data('id')\n        if (!id) return\n        minusHandler(event, id)\n    })\n}\n\n/**\n * 根据dish的id,来改变对应counter的数值显示,以及减号的显示\n * @param id\n * @param number\n * @param showMinus - 是否显示minus button\n * @param counterSelector\n * @param minusSelector - minus按钮的选择器\n */\nexport function render(id, number, showMinus, counterSelector='.plusok', minusSelector='.mius') {\n    var $parent = $(`[data-id=\"${id}\"]`)\n    var $counter = $parent.find(counterSelector).html(number)\n    if (number == 0) {\n        $counter.removeClass('show')\n        $parent.find(minusSelector).hide()\n    }\n    if (number >= 1 && !$counter.hasClass('show')) {\n        $counter.addClass('show')\n    }\n    if (showMinus && number > 0) {\n        $parent.find(minusSelector).show()\n    }\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./dom/dish.js\n **/","import $ from 'jquery'\nimport {User, Dish} from '../models'\nimport * as dishUtil from '../utils/dish'\nimport * as dishDom from '../dom/dish'\n\n/**\n * 对dish的基本操作做绑定,给首页,食材包,便当列表页,以及食材包详情页用\n * todo: 其实分离也许更好, 实在是太相似,所以放这里\n * @param cart\n * @param dishes\n * @param parent\n */\nexport default function (cart, dishes, parent) {\n    dishDom.bind(parent,\n        {plus: '.plus', minus: '.mius'},\n        (event, id) => {plusDish(id)},\n        (event, id) => {minusDish(id)}\n    )\n\n    var dishHash = {}\n    cart.forEach(item => {\n        var id = item.dish._id\n        var dish = dishUtil.getDish(dishes, id)\n        if (!dishHash[id]) {\n            dishHash[id] = {\n                number: item.number,\n                showMinus: !dishUtil.hasMultipleSelections(dish)\n            }\n        } else {\n            dishHash[id] += item.number\n        }\n    })\n\n    Object.keys(dishHash).forEach(id =>\n        dishDom.render(id, dishHash[id].number, dishHash[id].showMinus))\n\n    function plusDish(id) {\n        // 根据id, 找出dish, 判断是否有多属性(如果多属性只有一个也没必要有选择框)\n        var dish = dishUtil.getDish(dishes, id)\n\n        var number = dishUtil.plusDish(dish, cart)\n        if (!number) { // 数字不存在,表示不能直接添加,需要使用多属性框\n            // todo\n            console.warn('todo: to complete')\n        } else { // 表示无需弹出多属性选择框\n            User.postCartRelax(cart)\n            dishDom.render(id, number, true)\n        }\n    }\n\n    function minusDish(id) {\n        var dish = dishUtil.getDish(dishes, id)\n        var number = dishUtil.minusDish(dish, cart)\n        User.postCartRelax(cart)\n        dishDom.render(id, number)\n    }\n}\n\nexport function bindTab(tabs, tabsContainer, activeClass) {\n    // tab切换事件绑定\n    var $tabs = $(tabs);\n    var $tabBtnContainer = $(tabsContainer);\n    var $tabBtns = $tabBtnContainer.children()\n    $tabBtnContainer.on('click', function (e) {\n        var index = $(e.target).index()\n        $tabBtns.removeClass(activeClass).eq(index).addClass(activeClass)\n        $tabs.hide().eq(index).show()\n    })\n}\n\n\n/** WEBPACK FOOTER **\n ** ./utils/bind-dish-operation.js\n **/"],"sourceRoot":""}