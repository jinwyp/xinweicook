
<div class="col-lg-12">

    <div class="panel panel-info">
        <div class="panel-heading">
            <h3 class="panel-title panel-titlenew">Users 用户列表
                <a class="btn btn-sm btn-info pull-right" ui-sref="menu.addNewUser" role="button">新增</a>
            </h3>
        </div>

        <div class="panel-body">
            <form class="form-horizontal" name="searchForm" novalidate ng-cloak>
                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.keyword.$dirty&&searchForm.keyword.$valid, 'has-error':searchForm.keyword.$dirty&&searchForm.keyword.$invalid}">
                    <label for="inputKeyword" class="col-lg-2 control-label" >关键字实时筛选</label>
                    <div class="col-lg-4">
                        <input type="text" class="form-control" id="inputKeyword" placeholder="keyword" name="keyword" ng-model="data.searchFilter" required ng-minlength="2">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.keyword.$dirty&&searchForm.keyword.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.keyword.$dirty&&searchForm.keyword.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.keyword.$dirty&&searchForm.keyword.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.keyword.$dirty&&searchForm.keyword.$error.minlength || searchForm.keyword.$dirty&&searchForm.keyword.$error.maxlength">输入的信息长度错误！</span>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userLanguage.$dirty&&searchForm.userLanguage.$valid, 'has-error':searchForm.userLanguage.$dirty&&searchForm.userLanguage.$invalid}">
                    <label for="inputLanguageGroup" class="col-lg-2 control-label" >用户语言</label>
                    <div class="col-lg-8">
                        <label class="radio-inline" ng-repeat="group in data.userLanguageList">
                            <input type="radio" name="userLanguage" id="inputLanguageGroup" ng-value="group.value" ng-model="data.searchOptions.query.lang">{{group.name}}
                        </label>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userGroup.$dirty&&searchForm.userGroup.$valid, 'has-error':searchForm.userGroup.$dirty&&searchForm.userGroup.$invalid}">
                    <label for="inputUserGroup" class="col-lg-2 control-label" >用户组</label>
                    <div class="col-lg-8">
                        <label class="radio-inline" ng-repeat="group in data.userGroupList">
                            <input type="radio" name="userGroup" id="inputUserGroup" ng-value="group.value" ng-model="data.searchOptions.query.group">{{group.name}}
                        </label>
                    </div>
                </div>

                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userMobile.$dirty&&searchForm.userMobile.$valid, 'has-error':searchForm.userMobile.$dirty&&searchForm.userMobile.$invalid}">
                    <label for="inputUserMobile" class="col-lg-2 control-label" >手机</label>
                    <div class="col-lg-4">
                        <input type="text" class="form-control" id="inputUserMobile" placeholder="" name="userMobile" ng-model="data.searchOptions.query.mobile" ng-minlength="11">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.userMobile.$dirty&&searchForm.userMobile.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.userMobile.$dirty&&searchForm.userMobile.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.userMobile.$dirty&&searchForm.userMobile.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.userMobile.$dirty&&searchForm.userMobile.$error.minlength || searchForm.userMobile.$dirty&&searchForm.userMobile.$error.maxlength">输入的信息长度错误！</span>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userId.$dirty&&searchForm.userId.$valid, 'has-error':searchForm.userId.$dirty&&searchForm.userId.$invalid}">
                    <label for="inputUserId" class="col-lg-2 control-label" >用户_ID</label>
                    <div class="col-lg-4">
                        <input type="text" class="form-control" id="inputUserId" placeholder="用户_ID" name="userId" ng-model="data.searchOptions.query._id" ng-minlength="23">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.userId.$dirty&&searchForm.userId.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.userId.$dirty&&searchForm.userId.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.userId.$dirty&&searchForm.userId.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.userId.$dirty&&searchForm.userId.$error.minlength || searchForm.userId.$dirty&&searchForm.userId.$error.maxlength">输入的信息长度错误！</span>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$valid, 'has-error':searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$invalid}">
                    <label for="inputUserInvitationSendCode" class="col-lg-2 control-label" >该用户自己的邀请码</label>
                    <div class="col-lg-4">
                        <input type="text" class="form-control" id="inputUserInvitationSendCode" placeholder="" name="userInvitationSendCode" ng-model="data.searchOptions.query.invitationSendCode" ng-minlength="8">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$error.minlength || searchForm.userInvitationSendCode.$dirty&&searchForm.userInvitationSendCode.$error.maxlength">输入的信息长度错误！</span>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$valid, 'has-error':searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$invalid}">
                    <label for="inputUserSharedInvitationSendCodeTotalCount" class="col-lg-2 control-label" >邀请码可分享次数大于等于</label>
                    <div class="col-lg-4">
                        <input type="number" class="form-control" id="inputUserSharedInvitationSendCodeTotalCount" placeholder="已支付订单数量" name="userSharedInvitationSendCodeTotalCount" ng-model="data.sharedInvitationSendCodeTotalCountNumber" min="0">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$error.min || searchForm.userSharedInvitationSendCodeTotalCount.$dirty&&searchForm.userSharedInvitationSendCodeTotalCount.$error.max">输入的信息格式错误！</span>
                    </div>
                </div>

                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$valid, 'has-error':searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$invalid}">
                    <label for="inputUserSharedInvitationSendCodeUsedTime" class="col-lg-2 control-label" >邀请码已分享次数大于等于</label>
                    <div class="col-lg-4">
                        <input type="number" class="form-control" id="inputUserSharedInvitationSendCodeUsedTime" placeholder="邀请码分享次数" name="userSharedInvitationSendCodeUsedTime" ng-model="data.sharedInvitationSendCodeUsedTimeNumber" min="0">
                        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true" ng-if="searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$valid"></span>
                        <span class="glyphicon glyphicon-remove form-control-feedback" aria-hidden="true" ng-if="searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$invalid"></span>
                    </div>
                    <div class="col-lg-6">
                        <span class="form-validation help-block" ng-if="searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$error.required">请填入信息！</span>
                        <span class="form-validation help-block" ng-if="searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$error.min || searchForm.userSharedInvitationSendCodeUsedTime.$dirty&&searchForm.userSharedInvitationSendCodeUsedTime.$error.max">输入的信息格式错误！</span>
                    </div>
                </div>


                <div class="form-group has-feedback" ng-class="{'has-success':searchForm.userClientFrom.$dirty&&searchForm.userClientFrom.$valid, 'has-error':searchForm.userClientFrom.$dirty&&searchForm.userClientFrom.$invalid}">
                    <label for="inputUserClientFrom" class="col-lg-2 control-label" >注册来源</label>
                    <div class="col-lg-8">
                        <label class="radio-inline" ng-repeat="clientFrom in data.userClientFromList">
                            <input type="radio" name="userClientFrom" id="inputUserClientFrom" ng-value="clientFrom.value" ng-model="data.searchOptions.query.statisticsClientFrom">{{clientFrom.name}}
                        </label>
                    </div>
                </div>


                <div class="form-group has-feedback" >
                    <label class="col-lg-2 control-label" >注册时间范围截至</label>
                    <div class="col-lg-4">
                        <div class="input-group">
                            <input type="text" class="form-control" datepicker-popup="yyyy-MM-dd" ng-model="data.searchDateTo" is-open="data.datePickerIsOpen" min-date="'2015-01-01'" max-date="'2050-01-30'"  />
                            <span class="input-group-btn">
                                <button type="button" class="btn btn-default" ng-click="datePickerOpen()"><i class="glyphicon glyphicon-calendar"></i></button>
                            </span>
                        </div>
                    </div>
                </div>


                <div class="form-group">
                    <div class="col-lg-offset-2 col-lg-10">
                        <button type="submit" class="btn btn-default" ng-click="searchUserCount(searchForm)">Search</button>
                        <button type="submit" class="btn btn-default" ng-click="showUserStatistic(searchForm)">统计</button>
                        <button type="submit" class="btn btn-default" ng-click="searchUserStatisticNewFirstOrderUserDaily(searchForm, '-date')">每日新用户</button>
                    </div>
                </div>
            </form>

        </div>
    </div>





    <nav ng-if="css.showTable==='users'">
        <ul class="pagination">
            <li>
                <span aria-hidden="true"> 共{{data.userListCount}}条记录 </span>
            </li>


            <li>
                <a aria-label="Previous" ng-hide="data.userListCurrentPage==1"  ng-click="changePagination(data.userListCurrentPage - 1)"> <span aria-hidden="true">&laquo;</span></a>
            </li>
            <li ng-repeat="page in data.userListPagesArray"><a ng-click="changePagination(page.value)">{{page.value}}</a></li>
            <li>
                <a aria-label="Next" ng-hide="data.userListCurrentPage==data.userListTotalPages"  ng-click="changePagination(data.userListCurrentPage + 1)"><span aria-hidden="true">&raquo;</span> </a>
            </li>
        </ul>

    </nav>



    <table class="table table-striped table-bordered table-hover table-responsive" ng-if="css.showTable==='users'">
        <thead>
            <tr>
                <th>_id / 注册时间</th>
                <th>用户组</th>
                <th>手机</th>
                <th>邮箱</th>
                <th>用户名</th>
                <th>姓名</th>
                <th>性别</th>
                <!--<th>地址</th>-->
                <th>下单数</th>
                <th>优惠券</th>
                <th>邀请码</th>

                <!--<th>操作</th>-->

            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="user in data.userList | filter: data.searchFilter">
                <td><a ui-sref="menu.updateUser({ id: user._id })">{{user._id}}</a> <br/> {{user.createdAt | date:'yyyy-MM-dd HH:mm:ss Z'}}</td>
                <td>{{user.group}}</td>
                <td>{{user.mobile}}</td>
                <td>{{user.email}}</td>
                <td>{{user.username}}</td>
                <td>{{user.fullName}}</td>
                <td> <span ng-show="user.gender===1">男</span> <span ng-show="user.gender===2">女</span> </td>
                <!--<td>-->
                    <!--<ul class="list-group" ng-repeat="address in user.address">-->
                        <!--<li class="list-group-item">客人认证是否有效地址: {{address.isValid}}</li>-->
                        <!--<li class="list-group-item">默认地址: {{address.isDefault}}</li>-->
                        <!--<li class="list-group-item">联系人: {{address.contactPerson}}</li>-->
                        <!--<li class="list-group-item">手机: {{address.mobile}}</li>-->
                        <!--<li class="list-group-item">经度: {{address.geoLongitude}} / 纬度: {{address.geoLatitude}}</li>-->
                        <!--<li class="list-group-item"> {{address.country}} / {{address.province}} / {{address.city}} / {{address.district}} / {{address.street}} / {{address.address}} </li>-->
                    <!--</ul>-->
                <!--</td>-->
                <td>{{user.sharedInvitationSendCodeTotalCount - 1}}</td>
                <td> <span ng-repeat="coupon in user.couponList">{{coupon}} <br/></span></td>
                <td>{{user.invitationSendCode}} / 已分享{{user.sharedInvitationSendCodeUsedTime}}次 - 可分享{{user.sharedInvitationSendCodeTotalCount - user.sharedInvitationSendCodeUsedTime}} / {{user.sharedInvitationSendCodeUsedTime}}个朋友有下单</td>

                <!--<td>-->
                    <!--<div class="alert alert-danger" role="alert" ng-show="data.currentDeleteIndex===user._id">确认真的删除吗？-->
                        <!--<button class="btn btn-danger" ng-click="delUser(user)">立即删除</button>-->
                        <!--<button class="btn btn-info" ng-click="data.currentDeleteIndex=-1">返回</button>-->
                    <!--</div>-->
                    <!--<button class="btn btn-danger" ng-show="data.currentDeleteIndex!==user._id" ng-click="data.currentDeleteIndex=user._id">删除</button>-->
                <!--</td>-->
            </tr>
        </tbody>
    </table>





    <div class="row" ng-show="css.showTable==='stat'">
        <div class="col-lg-12">
            <h3>
                <span class="label label-info">总用户数: {{data.userStatisticOfNewComers.totalUserCount}}</span>
                <span class="label label-info">七天前注册总用户数: {{data.userStatisticOfNewComers.totalUserLast7dayCount}} </span>
            </h3>
            <h3>
                <span class="label label-info">注册并购买过用户数: {{data.userStatisticOfNewComers.totalPurchasedUserCount}}  </span>
                <span class="label label-info">占七天前注册总用户: {{data.userStatisticOfNewComers.totalPurchasedUserCount / data.userStatisticOfNewComers.totalUserLast7dayCount * 100 | number :2 }}% </span>
            </h3>
            <!--<h3>-->
            <!--<span class="label label-info">只有1单用户数: {{data.userStatisticOfNewComers.purchased1TimeUserCount}}  </span>-->
            <!--<span class="label label-info">占七天前注册并购买过用户数:  {{data.userStatisticOfNewComers.purchased1TimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}% </span>-->
            <!--</h3>-->
            <!--<h3>-->
            <!--<span class="label label-info">只有2单用户数: {{data.userStatisticOfNewComers.purchased2TimeUserCount}}</span>-->
            <!--<span class="label label-info">占注册并购买过用户数:  {{data.userStatisticOfNewComers.purchased2TimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}% </span>-->
            <!--</h3>-->


            <h3>
                <span class="label label-info">两单及以上用户数: {{data.userStatisticOfNewComers.purchased2MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased2MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>
            <h3>
                <span class="label label-info">三单及以上用户数: {{data.userStatisticOfNewComers.purchased3MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased3MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>
            <h3>
                <span class="label label-info">四单及以上用户数: {{data.userStatisticOfNewComers.purchased4MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased4MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>
            <h3>
                <span class="label label-info">五单及以上用户数: {{data.userStatisticOfNewComers.purchased5MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased5MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>
            <h3>
                <span class="label label-info">六单及以上用户数: {{data.userStatisticOfNewComers.purchased6MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased6MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>
            <h3>
                <span class="label label-info">七单及以上用户数: {{data.userStatisticOfNewComers.purchased7MoreTimeUserCount}}</span>
                <span class="label label-info">占注册并购买过用户数: {{data.userStatisticOfNewComers.purchased7MoreTimeUserCount / data.userStatisticOfNewComers.totalPurchasedUserCount * 100 | number :2 }}%</span>
            </h3>

            <h3>
                <span class="label label-warning">购买两次及以上的用户相邻两次订单下单时间间隔总和: {{data.userStatisticLoyalPurchaseFrequency.totalTime}}小时</span>
                <span class="label label-warning">购买两次及以上的用户相邻两次订单下单间隔总数量: {{data.userStatisticLoyalPurchaseFrequency.totalOrderNumber}}间隔数量</span>
                <span class="label label-warning">购买两次及以上的用户每次相邻两次订单下单平均间隔: {{data.userStatisticLoyalPurchaseFrequency.avgTime | number :2}}小时</span>
            </h3>


        </div>

    </div>






    <div class="row" ng-if="css.showTable === 'statNewFirstOrderUserDaily'">
        <div class="col-lg-12">
            <highchart id="chartNewFirstOrderUserDaily" config="chartNewFirstOrderUserDaily"  ></highchart>
        </div>


        <div class="col-lg-12">
            <label class="radio-inline" >
                <input type="radio" name="chartType"  ng-value="'column'" ng-model="chartNewFirstOrderUserDaily.series[0].type">柱状图
            </label>
            <label class="radio-inline" >
                <input type="radio" name="chartType"  ng-value="'line'" ng-model="chartNewFirstOrderUserDaily.series[0].type">折线图
            </label>
        </div>

        <div class="col-lg-12">
            <label for="prettyJSON">
                <input id="prettyJSON" type="checkbox" ng-model="prettyJSON"> Pretty JSON
            </label>
        </div>

        <div class="col-lg-12">
            <pre ng-show="prettyJSON">{{ chartNewFirstOrderUserDaily | json }}</pre>
            <pre ng-show="!prettyJSON">{{ chartNewFirstOrderUserDaily }}</pre>
        </div>

    </div>


    <table class="table table-striped table-bordered table-hover table-responsive" ng-if="css.showTable==='statNewFirstOrderUserDaily'">
        <thead>
            <tr>
                <th>日期</th>
                <th>新用户数</th>
                <th>用户详细</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="onedate in data.userStatisticNewFirstOrderUserDaily | orderBy:css.searchUserStatisticSortBy">
                <td> {{onedate.date | date:'yyyy-MM-dd'}}</td>
                <td>{{onedate.userQuantity}}</td>
                <td><button class="btn btn-info" ng-click="data.currentDailyUserIndex=onedate.date"> 显示详细</button> <br/>
                    <span ng-if="data.currentDailyUserIndex === onedate.date">
                        <span ng-repeat="user in onedate.userList">
                            <a ui-sref="menu.updateUser({ id: user.user })">{{user.user}}</a> / {{user.orderContactPerson}}/{{user.orderContactMobile}} <br/>
                        </span>
                    </span>
                </td>
            </tr>
        </tbody>
    </table>



</div>
