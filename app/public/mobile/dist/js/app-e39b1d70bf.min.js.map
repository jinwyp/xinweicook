{"version":3,"sources":["app/public/mobile/src/js/modules.js","app/public/mobile/src/js/directives/add-dish-bar.js","app/public/mobile/src/js/directives/auto-focus.js","app/public/mobile/src/js/directives/back-button.js","app/public/mobile/src/js/directives/coupon-code.js","app/public/mobile/src/js/directives/geetest-sms-button.js","app/public/mobile/src/js/directives/img-lazy-load.js","app/public/mobile/src/js/directives/shopping-progress-bar.js","app/public/mobile/src/js/directives/sms-button.js","app/public/mobile/src/js/directives/flash-class.js","app/public/mobile/src/js/directives/modal.js","app/public/mobile/src/js/directives/confirm.js","app/public/mobile/src/js/directives/address.js","app/public/mobile/src/js/directives/address-list.js","app/public/mobile/src/js/directives/capture-click.js","app/public/mobile/src/js/directives/err-tip.js","app/public/mobile/src/js/directives/menu-nav.js","app/public/mobile/src/js/directives/address-selection.js","app/public/mobile/src/js/service/alert.js","app/public/mobile/src/js/service/debug.js","app/public/mobile/src/js/service/map.js","app/public/mobile/src/js/service/scope-decorator.js","app/public/mobile/src/js/service/utils.js","app/public/mobile/src/js/weixin.js","app/public/mobile/src/js/filters.js","app/public/mobile/src/js/templates.js","app/public/mobile/src/js/models.js","app/public/mobile/src/js/config.js"],"names":["angular","module","directive","Debug","User","$localStorage","$filter","Utils","scope","dish","user","localBag","templateUrl","link","$scope","storage","unwatcher","$watch","mergeCarts","shoppingCart","totalPrice","curSelection","preferences","forEach","property","foodMaterial","some","el","outOfStock","name","zh","addToCart","entry","selection","newEntry","number","count","subDish","Object","keys","map","key","item","isSameItemInCart","sDish","push","hide","postCart","postDishFilter","p","reduce","price","total","cur","priceOriginal","restrict","setTimeout","focus","template","back","history","length","location","href","Coupon","$q","couponPrice","require","attrs","ngModel","$asyncValidators","couponCode","mValue","vValue","value","getCouponInfo","then","res","coupon","data","now","Date","headers","startDate","endDate","reject","resolve","$interval","$window","Alert","$http","valid","mobile","type","stateMachine","action","state","isValid","get","success","result","s","document","createElement","params","gt","width","body","offsetWidth","challenge","src","join","fatherDom","element","getElementById","append","gt_custom_ajax","id","message","find","geetest_challenge","geetest_validate","geetest_seccode","timer","remains","cancel","GeeTest","refresh","e","getSmsCode","console","log","show","validationStatus","showGeetest","$document","$timeout","getDOMTop","elem","top","offsetTop","offsetParent","getWindowBottom","documentElement","clientHeight","scrollY","scrollTop","windowBottom","lazyDOMs","ok","on","i","$eval","attr","splice","dom","imgLazyLoad","pair","_lazyDestroyBinded","$on","path","pathname","watchMobile","assert","code","alert","options","time","duration","className","newVal","oldVal","addClass","removeClass","transclude","close","toggle","preClose","setStatus","event","status","stopPropagation","css","undefined","ignorePreClose","deferred","defer","showModal","promise","confirm","$location","Address","Weixin","Map","outAddress","range","save","leave","deleteHook","addr","edit","showSearchAddress","form","locating","isWeixin","isNewAddress","street","sortOrder","regularizeAddress","copy","addressOptions","bind","choose","trySelectUnique","cities","province","city","deleteAddress","_id","streetList","searchAddress","search","results","confirmStreet","geoLatitude","lat","geoLongitude","lng","$invalid","extend","$submitted","initForm","showFakeInput","locate","getLocation","getLocationName","latitude","longitude","pick","addressComponent","gcj02ToBd09","noop","addresses","watchAddress","editing","hideOthersWhenEdit","newAddress","handler","remove","idx","target","parent","indexOf","addressNodes","parentElement","children","len","editIdx","curIdx","address","$parse","$rootScope","compile","$element","fn","captureClick","addEventListener","callback","$event","$$phase","$evalAsync","$apply","error","isAddressOk","goToCart","animateTrigger","noAddress","dishId","factory","codeMsg",1110,1111,1112,1113,2110,3110,3111,3112,3113,3114,3115,3116,4110,5110,5111,5112,5113,"def","msg","provider","that","this","debugKey","$get","isDebug","RegExp","fakeWarehouse","searches","test","sessionStorage","getItem","setItem","fakewarehouse","ret","val","prototype","toString","call","JSON","stringify","express","sval","promiseErrFn","topDistance","xinweioffice","caohejing1","bentoNoReach","suggestion","query","region","y","x","z","Math","sqrt","sin","PI","theta","atan2","cos","bd09ToGcj02","lineDistance","latA","lngA","latB","lngB","earthR","alpha","acos","lineDistance2CHJ","CHJ","warehouseCoords","fixZero","d","lineD","walkingDistance","warehouse","args","Array","isArray","arguments","arg","prefix","encodeURIComponent","elements","sort","a","b","distance","isInRange","distances","dests","nearestWarehouse","topDistance2HQ","topDistance2CHJ","warehouses","common","nav","utf2b64","str","btoa","unescape","replace","b642utf","decodeURIComponent","escape","window","atob","item1","item2","every","local","server","notInLocal","lDish","getStockId","dishList","idStockMap","f","isPublished","cleanLocalStorage","remain","slice","split","obj","addressEqual","addr1","addr2","ref","districts","equal","areas","district","filter","stockOfDish","stockWarehouse","stock","stockOfItem","defaults","wx","appId","jsApiList","ak","oauthUrl","navigator","userAgent","readyState","ready","cb","config","setting","_setting","timestamp","nonceStr","signature","fail","shareTimeline","settings","onMenuShareTimeline","shareAppMessage","onMenuShareAppMessage","showOptionMenu","hideOptionMenu","mapUrl","jsonp","getJsconfig","post","url","substr","hash","floor","devicePixelRatio","height","ratio","i2s","scripts","superscripts","subscripts","_","sup","sub","m1","m2","m3","last","title","deliveryDateEat","hour","deliveryTimeEat","deliveryDateCook","day","deliveryTimeCook","segment","eat","cook","times","hasSegment","list","dishes","tType","sType","promotionCode","card","unshift","run","$templateCache","put","getList","cookingType","like","getOne","postOrder","deliveryTime","deliveryEatTime","getOrder","orderId","updateOrder","getUnifiedOrder","cartDate","timeSpan","login","username","password","couponcode","grant_type","access_token","signup","pwd","opts","logout","token_type_hint","token","getUserInfo","updateUser","resetPwd","cart","clearTimeout","catch","applyInvitationCode","invitedFriends","getWeixinUserInfo","addOne","update","delete","exchangeCouponCode","notify","isCharge","out_trade_no","balance","chargeByCode","accountChargeCode","chargeOnline","balanceRecords","constant","wrongMobile","wrongPassword","alreadyExist","notFound","userIdWrong","userGenderWrong","userOldAddressWrong","invitationSendCodeWrong","addressIdWrong","addressNotFound","addressLatitudeWrong","addressLongitudeWrong","addressCoordTypeWrong","addressProvinceWrong","addressCityWrong","addressDistrictWrong","addressStreetWrong","addressStreetNumberWrong","addressAddressWrong","addressContactPersonWrong","addressMobileWrong","addressSortOrderWrong","addressNotDeliver","addressBaiduMapNotFoundError","shoppingCartNotArray","shoppingCartDishIdWrong","shoppingCartDishNumberWrong","shoppingCartSubDishIdWrong","shoppingCartSubDishNumberWrong","order","orderNumberWrong","orderIdWrong","warehouseIdWrong","cookingTypeWrong","clientFromWrong","creditWrong","freightWrong","paymentWrong","paymentUsedCashWrong","deliveryDateCookWrong","deliveryTimeCookWrong","deliveryDateEatWrong","deliveryTimeEatWrong","dishListArrayWrong","dishListDishNumberWrong","dishListDishIdWrong","dishListSubDishArrayWrong","dishListSubDishNumberWrong","dishListSubDishIdWrong","userCommentWrong","dishIdInvalid","notOnlyDrink","notOverTenDrinks","orderStatusWrong","orderPaymentStatusWrong","sms","wrongCode","expired","invalidCode","wrongType","tooManyTries","sendFailed","reachSendLimitation","notStart","used","outOfCount","couponIdWrong","promotionCodeWrong","announcement","announcementIdWrong","noRedirectPath","noRedirectAPI","loginRedirectPath","request","Authorization","responseError","response","redirectPath","RE","$httpProvider","$compileProvider","Accept","language","interceptors","debugInfoEnabled","o","k","_array","compare","tmp","array","l"],"mappings":"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","file":"../js/app-e39b1d70bf.min.js","sourcesContent":["angular.module('xw', ['xw.config', 'xw.services', 'xw.controllers', 'xw.directives', 'xw.filters']);\n\nangular.module('xw.config', ['ngStorage']);\n\nangular.module('xw.models', ['ngStorage']);\n\nangular.module('xw.controllers', ['xw.models', 'xw.weixin']);\n\nangular.module('xw.directives', ['xw.models']);\n\nangular.module('xw.filters', []);\n\nangular.module('xw.weixin', []); // tmp\n\nangular.module('xw.services', []);","angular.module('xw.directives').directive('addDishBar', [\"Debug\", \"User\", \"$localStorage\", \"$filter\", \"Utils\", function (Debug, User, $localStorage, $filter, Utils) {\n    return {\n        scope: {\n            dish: '=',\n            user: '=',\n            localBag: '='\n        },\n        templateUrl: 'add-dish-bar.html',\n        link : function ($scope) {\n            var storage = $scope.storage = $localStorage;\n            var localBag = $scope.localBag = [];\n\n            var unwatcher = $scope.$watch('user', function (user) {\n                if (user) {\n                    unwatcher();\n\n                    $scope.localBag = localBag = Utils.mergeCarts(localBag\n                        , user.shoppingCart);\n                    $scope.totalPrice();\n                }\n            });\n\n            $scope.$watch('dish', function (dish) {\n                if (dish) {\n                    var curSelection = {};\n                    $scope.dish.preferences.forEach(function (property) {\n                        property.foodMaterial.some(function (el) {\n                            if (!el.dish.outOfStock) {\n                                curSelection[property.name.zh] = el.dish;\n                                return true;\n                            } else return false;\n                        })\n                    });\n                    // dish.curSelection存储多属性下的各选中dish,\n                    // 是一个以各属性名为key, 属性下的某个有货dish为value对象\n                    // (尽管一个属性下有可能多个有货dish,但当前选中但只有一个dish)\n                    $scope.dish.curSelection = curSelection;\n                }\n            });\n\n            /**\n             * @param dish 此dish同$scope.dish\n             */\n            $scope.addToCart = function (dish) {\n                var selection = dish.curSelection;\n                var newEntry = {\n                    dish: dish,\n                    number: dish.count,\n                    subDish: Object.keys(selection).map(function (key) {\n                        return {\n                            dish: selection[key],\n                            number: dish.count\n                        };\n                    })\n                };\n\n                // 存在与cart中的与dish的id相同的dish wrapper\n                // - {dish: dish, number:number, subDish: []}\n                var entry;\n\n                localBag.some(function (item) {\n                    if (Utils.isSameItemInCart(item, newEntry)) {\n                        entry = item;\n                        entry.number += newEntry.number;\n                        entry.subDish.forEach(function (sDish) {\n                            sDish.number = entry.number;\n                        });\n                        return true;\n                    }\n                });\n\n                if (!entry) {\n                    localBag.push(newEntry);\n                }\n\n                dish.count = 0;\n\n                $scope.hide();\n\n                User.postCart(localBag.map(postDishFilter));\n\n                $scope.totalPrice();\n            };\n\n            var postDishFilter = $filter('postDish');\n\n            $scope.totalPrice = function () {\n                var p = localBag.reduce(function price(total, cur) {\n                    total += cur.dish.priceOriginal * cur.number;\n                    if (cur.subDish) {\n                        total += cur.subDish.reduce(price, 0)\n                    }\n                    return total;\n                }, 0);\n                return localBag.price = p;\n            };\n\n            $scope.totalPrice();\n\n            $scope.hide = function () {\n                $scope.dish = null;\n            };\n\n        }\n    }\n}])","angular.module('xw.directives').directive('autoFocus', function () {\n    return {\n        restrict: 'A',\n        link: function (scope, el) {\n            setTimeout(function () {\n                el[0].focus();\n            }, 100);\n        }\n    }\n});","angular.module('xw.directives').directive('backButton', function () {\n    return {\n        template: '<div class=\"back-icon\" ng-click=\"back()\"></div>',\n        link: function ($scope) {\n            // 有些路径需要直接调用 navigator.back(), 有些路径\n            $scope.back = function () {\n                if (history.length <= 1) location.href = '/mobile/';\n                history.back();\n            }\n        }\n    }\n})","angular.module('xw.directives').directive('couponCode', [\"Coupon\", \"$q\", function (Coupon, $q) {\n    return {\n        restrict: 'A',\n        scope: {couponPrice: '=couponCode'},\n        require: '?ngModel',\n        link: function (scope, el, attrs, ngModel) {\n            if (!ngModel) return;\n\n            ngModel.$asyncValidators.couponCode = function (mValue, vValue) {\n                var value = mValue || vValue;\n\n                if (!value) return $q.resolve(1);\n\n                value = value.length == 8 ? 'zz' + value : value;\n\n                return Coupon.getCouponInfo(value).then(function (res) {\n                    var coupon = res.data;\n                    var now = new Date(res.headers('date'));\n                    var startDate = new Date(coupon.startDate);\n                    var endDate = new Date(coupon.endDate);\n                    // todo: check price limit\n                    if (startDate <= now && now <= endDate) {\n                        scope.couponPrice = coupon.price;\n                        // todo: 价格限制\n                    } else {\n                        return $q.reject('未在可使用期限内');\n                    }\n                })\n            }\n        }\n    }\n}]);","angular.module('xw.directives').directive('geetestSmsButton', [\"Debug\", \"User\", \"$interval\", \"$window\", \"Alert\", \"$http\", function (Debug, User, $interval, $window, Alert, $http) {\n    return {\n        scope: {\n            valid: '@',\n            mobile: '@',\n            type: '@'\n        },\n        templateUrl: 'geetest-sms-button.html',\n        link : function (scope) {\n            $http.get('/api/user/signup/geetest/register').success(function(result) {\n                var s = document.createElement('script');\n                var params = {\n                    //'745d959dec1191e086febd11aa684c9d'\n                    gt: 'd41d16df5b99010ec511ec10aaaafcb8',\n                    width: document.body.offsetWidth,\n                    challenge: result.challenge\n                };\n\n                s.src = 'http://api.geetest.com/get.php?' + Object.keys(params)\n                        .map(function (key) {return key + '=' + params[key]})\n                        .join('&');\n\n\n                var fatherDom = angular.element(document.getElementById('geetestContainer'));\n\n                fatherDom.append(s);//append the script where ever you want\n\n                $window.gt_custom_ajax = function(result, id, message) {\n                    if(result) {\n                        var value = angular.element(document.getElementById('geetestContainer')).find('input');\n\n                        var data = {\n                            \"geetest_challenge\":value[0].value,\n                            \"geetest_validate\":value[1].value,\n                            \"geetest_seccode\":value[2].value,\n                            \"type\" : scope.type,\n                            \"mobile\" : scope.mobile\n                        };\n\n                        var timer = $interval(function () {\n                            if (!--scope.remains) {\n                                $interval.cancel(timer);\n                                scope.remains = remains;\n\n                                stateMachine('show-refetch', scope.valid == 'true');\n                                try {\n                                    GeeTest[0].refresh()\n                                } catch (e) {}\n                            }\n                        }, 1000);\n\n                        User.getSmsCode(data).success(function() {\n                            console.log(\"success\")\n                        }).catch(function (res) {\n                            Alert.show(res.data.validationStatus, '验证码发送失败');\n                        });\n\n                        stateMachine('hide-geetest')\n                    }\n                }\n            });\n\n            var remains = 30;\n            scope.remains = 30;\n\n            scope.$watch('mobile', function (mobile) {\n                stateMachine('mobile', scope.valid == 'true')\n            });\n\n            scope.showGeetest = function () {\n                stateMachine('show-geetest');\n            };\n\n            // {0: init-not-ready, 1: init-ready, 2: hide-btn-show-geetest,\n            //  3: hide-geetest-show-sending 4 show-re-btn-invalid, 5 re-btn}\n            scope.state = 0;\n            function stateMachine(action, data) {\n                var state = scope.state, isValid = !!data;\n                if (action == 'mobile') {\n                    if (state === 0 && isValid) {\n                        scope.state = 1;\n                    } else if (state == 1 && !isValid) {\n                        scope.state = 0;\n                    } else if (state == 2 && !isValid) {\n                        scope.state = 4;\n                    }\n                    else if (state == 4 && isValid) {\n                        scope.state = 5;\n                    } else if (state == 5 && !isValid) {\n                        scope.state = 4;\n                    }\n                } else if (action == 'show-geetest') {\n                    if (state == 1 || state == 5) {\n                        scope.state = 2;\n                    }\n                } else if (action == 'hide-geetest') {\n                    if (state == 2) {\n                        scope.state = 3;\n                    }\n                } else if (action == 'show-refetch') {\n                    if (state == 3) {\n                        scope.state = isValid ? 5 : 4;\n                    }\n                }\n            }\n        }\n    }\n}])","angular.module('xw.directives').directive('imgLazyLoad', ['$window', '$document', '$timeout', function ($window, $document, $timeout) {\n\n    var lazyDOMs = [],\n        document = $document[0],\n        windowBottom;\n\n    /**\n     * 获取目标元素距离根元素的高度\n     */\n    function getDOMTop(elem) {\n        var top = elem.offsetTop;\n        while (elem = elem.offsetParent) {\n            top += elem.offsetTop\n        }\n        return top;\n    }\n\n    function getWindowBottom() {\n        return document.documentElement.clientHeight + ($window.scrollY ||\n            document.documentElement.scrollTop || document.body.scrollTop);\n    }\n\n    getWindowBottom.ok = true;\n\n    angular.element($window).on('scroll', function () {\n        windowBottom = getWindowBottom();\n        for (var i = 0, el; i < lazyDOMs.length;) {\n            if (getDOMTop(lazyDOMs[i][0]) < windowBottom) {\n                el = angular.element(lazyDOMs[i][0]);\n                el[0].src = lazyDOMs[i][1].$eval(el.attr('img-lazy-load'));\n                lazyDOMs.splice(i, 1);\n            } else {\n                i++;\n            }\n        }\n    });\n\n    return {\n        restrict: 'A',\n        link: function (scope, el, attr) {\n            var dom = el[0];\n            lazyDOMs.push([dom, scope]);\n            var unwatcher = scope.$watch(attr.imgLazyLoad, function (src) {\n                if (src) {\n                    unwatcher();\n                    if (getWindowBottom.ok) {\n                        windowBottom = getWindowBottom();\n                        getWindowBottom.ok = false;\n                        setTimeout(function () {\n                            getWindowBottom.ok = true;\n                        }, 120); // 120 ms内不再计算window bottom\n                        // qq 浏览器会忽略100ms以下的setTimeout !!!!\n                        // http://www.qianduan.net/qqliu-lan-qi-x5nei-he-wen-ti-hui-zong/\n                    }\n                    // todo: 试着用setTimeout来比较这里的性能\n                    if (getDOMTop(dom) < windowBottom) {\n                        lazyDOMs.some(function (pair, i) {\n                            if (pair[0] == dom) {\n                                dom.src = src;\n                                lazyDOMs.splice(i, 1);\n                                return true;\n                            }\n                        })\n                    }\n                }\n            });\n\n            if (!scope._lazyDestroyBinded) {\n                scope._lazyDestroyBinded = true;\n                scope.$on('$destroy', function () {\n                    for (var i = 0; i < lazyDOMs.length;) {\n                        if (lazyDOMs[i][1] == scope) {\n                            lazyDOMs.splice(i, 1);\n                        } else {\n                            i++;\n                        }\n                    }\n                })\n            }\n        }\n    }\n}])","angular.module('xw.directives').directive('shoppingProgressBar', function () {\n    return {\n        templateUrl: 'shopping-progress-bar.html',\n        scope: true,\n        link: function (scope) {\n            var path = location.pathname;\n            if (path == '/mobile/cart') {\n                scope.state = 'state1';\n            } else if (path == '/mobile/orderaddress') {\n                scope.state = 'state2'\n            } else if (path == '/mobile/orderpay') {\n                scope.state = 'state3'\n            }\n        }\n    }\n})","angular.module('xw.directives').directive('smsButton', [\"Debug\", \"User\", \"$interval\", function (Debug, User, $interval) {\n    return {\n        scope: {\n            valid: '@',\n            mobile: '@',\n            type: '@'\n        },\n        templateUrl: 'sms-button.html',\n        link : function (scope) {\n            scope.state = 0; // {0: init-not-ready, 1: init-ready, 2: receiving, 3: refetch-not-ready, 4: refetch-ready}\n            scope.remains = 60;\n\n            var cancel = watchMobile();\n\n            scope.getSmsCode = function () {\n                scope.state = 2;\n                if (cancel) {\n                    cancel();\n                    cancel = null;\n                }\n\n                var timer = $interval(function () {\n                    if (!--scope.remains) {\n                        $interval.cancel(timer);\n                        scope.remains = 60;\n\n                        Debug.assert(typeof scope.valid == 'string', '由@传入的valid应当是string');\n                        if (scope.valid === 'true') {\n                            scope.state = 4;\n                        } else {\n                            scope.state = 3;\n                        }\n\n                        // 重新 watch mobile\n                        cancel = watchMobile();\n                    }\n                }, 1000);\n\n                User.getSmsCode({\n                    mobile: scope.mobile,\n                    type: scope.type\n                }).then(function (res) {\n                    //dev\n                    if (res.data.code) {\n                        // todo: should alert some thing?\n                    }\n                }).catch(function (res) {\n                    // todo: should alert some thing?\n                    alert('获取验证码失败,请稍后重试');\n                    Debug.alert(res);\n                })\n            };\n\n            function watchMobile() {\n                return scope.$watch('mobile', function (mobile) {\n                    if (scope.state === 0 && mobile && mobile.length == 11) {\n                        scope.state = 1;\n                    } else if (scope.state === 1 && (!mobile || mobile.length != 11)) {\n                        scope.state = 0;\n                    } else if (scope.state === 3 && mobile && mobile.length ==11) {\n                        scope.state = 4;\n                    } else if (scope.state === 4 && (!mobile || mobile.length != 11)) {\n                        scope.state = 3;\n                    }\n                })\n            }\n        }\n    }\n}])","angular.module('xw.directives').directive('flashClass', function () {\n    return {\n        restrict: 'A',\n        scope: {options: '=flashClass'},\n        require: '?ngModel',\n        link: function (scope, el) {\n            var time = scope.options.duration || 700;\n            var className = scope.options.className || 'flash';\n            scope.$watch('options.exp', function (newVal, oldVal) {\n                if (((newVal == oldVal) && newVal) || newVal) {\n                    setTimeout(function () {\n                        el.addClass(className);\n                        setTimeout(function () {\n                            el.removeClass(className)\n                        }, time)\n                    }, 200)\n                }\n            })\n        }\n    }\n});","angular.module('xw.directives').directive('modal', function () {\n    return {\n        restrict: 'E',\n        transclude: true,\n        scope: {\n            show: \"=\",\n            close: '=',\n            toggle: '=',\n            preClose: '=?'\n        },\n        templateUrl: 'modal.html',\n        link: function (scope, el, attrs) {\n            scope.css = {show: false};\n\n            if (attrs.default == 'show') {\n                scope.css.show = true;\n            }\n\n            scope.show = function () {\n                setStatus(event, true);\n            };\n\n            scope.close = function (ignorePreClose) {\n                if (!ignorePreClose && scope.preClose) {\n                    scope.preClose();\n                }\n                setStatus(event, false);\n            };\n\n            scope.toggle = function () {\n                setStatus(event);\n            };\n\n            function setStatus(event, status) {\n                event.stopPropagation();\n                if (status === undefined) {\n                    scope.css.show = !scope.css.show;\n                } else {\n                    scope.css.show = status;\n                }\n            }\n        }\n    }\n});","angular.module('xw.directives').directive('confirm', [\"$q\", function ($q) {\n    return {\n        restrict: 'E',\n        transclude: true,\n        scope: {\n            show: \"=\"\n        },\n        templateUrl: 'confirm.html',\n        link: function (scope) {\n            var deferred;\n            scope.show = function () {\n                deferred = $q.defer();\n                scope.showModal();\n                return deferred.promise;\n            };\n\n            scope.confirm = function () {\n                scope.close(true);\n                deferred.resolve(true);\n            };\n\n            scope.cancel = function () {\n                scope.close();\n            };\n\n            scope.preClose = function () {\n                deferred.resolve(false);\n            }\n        }\n    }\n}]);","angular.module('xw.directives').directive('address', [\"$timeout\", \"$location\", \"Address\", \"Utils\", \"$q\", \"Weixin\", \"Map\", function ($timeout, $location, Address, Utils, $q, Weixin, Map) {\n    return {\n        restrict: 'E',\n        scope: {\n            // 外部传入的数据\n            outAddress: '=', // 待编辑的地址, 如果为空, 则表示是新地址\n            range: '=', // 省市区数据\n\n            // 供外部调用的方法\n            save: '=',\n            leave: '=',\n            valid: '=',\n\n            // 需要调用的外部方法\n            deleteHook: '&', // 当删掉当前地址后给予外部的回调接口\n            hide: '&', // 接收隐藏条件\n\n            // 是否为当前状态地址的默认参数.\n            cur: '@'\n        },\n        templateUrl: 'address.html',\n        link: function ($scope) {\n            var addr;\n\n            var css = $scope.css = {\n                edit: false,\n                cur: $scope.cur == \"true\",\n                showSearchAddress: false,\n                form: null,\n                locating: false,\n                isWeixin: Weixin.isWeixin,\n                isNewAddress: Object.keys($scope.outAddress).length < 2\n            };\n\n            var data = $scope.data = {\n                street: ''\n            };\n\n            // 如果没有一个外部传入的地址,那么这是一个新地址\n            // <2 for angular\n            if (css.isNewAddress) {\n                addr = $scope.addr = {sortOrder: 0};\n                if (css.cur) {\n                    css.edit = true;\n                }\n            } else {\n                addr = $scope.addr = Utils.regularizeAddress(\n                    angular.copy($scope.outAddress), $scope.range);\n            }\n\n            $scope.outAddress.cur = css.cur;\n            $scope.outAddress.edit = !!css.edit;\n\n            $scope.options = Utils.addressOptions.bind(null, $scope.range);\n\n            $scope.$on('$locationChangeStart', function () {\n                if (!css.edit) return;\n                var path = $location.path();\n                css.showSearchAddress = path == '/search-address'\n            });\n\n            $scope.choose = function () {\n                if (css.cur) {\n                    css.edit = true;\n                    $scope.outAddress.edit = true;\n                } else {\n                    css.cur = true;\n                    // 如果这是一个新地址\n                    if (css.isNewAddress) {\n                        css.edit = true;\n                        $scope.outAddress.edit = true;\n                    }\n                }\n                $scope.outAddress.cur = true;\n            };\n\n            $scope.trySelectUnique = function () {\n                var cities = $scope.options(addr.province);\n                if (cities.length == 1) {\n                    addr.city = cities[0];\n                }\n            };\n\n            $scope.deleteAddress = function (event) {\n                event.stopPropagation();\n\n                Address.delete(addr._id);\n                if ($scope.deleteHook) {\n                    $scope.deleteHook();\n                }\n            };\n\n            $scope.showSearchAddress = function () {\n                data.street = addr.street;\n                $location.path('search-address');\n                $scope.data.streetList && ($scope.data.streetList.length = 0);\n                $scope.searchAddress();\n            };\n\n            $scope.searchAddress = function () {\n                if (data.street) {\n                    Map.search(data.street, addr.city || '全国')\n                        .then(function (res) {\n                            $scope.data.streetList = res.data.results\n                        })\n                }\n            };\n\n            $scope.confirmStreet = function (event, street) {\n                event.stopPropagation();\n\n                $location.path('');\n                if (!street) return;\n\n                addr.street = street.name;\n                addr.geoLatitude = street.location.lat;\n                addr.geoLongitude = street.location.lng;\n            };\n\n            $scope.save = function () {\n                if (css.form.$invalid) return $q.resolve(false);\n\n                css.edit = css.cur = false;\n                $scope.outAddress.edit = $scope.outAddress.cur = false;\n\n                return Address[!css.isNewAddress ? 'update' : 'addOne'](addr)\n                .then(function (res) {\n                        addr = $scope.addr = res.data;\n                        angular.extend($scope.outAddress, res.data);\n                        return res.data;\n                    });\n            };\n\n            $scope.leave = function () {\n                $scope.outAddress.cur = css.cur = false;\n            };\n\n            // 会设置form$submitted为true\n            $scope.valid = function () {\n                css.form.$submitted = true;\n                return !css.form.$invalid;\n            };\n\n            $scope.initForm = function (form) {\n                css.form = form;\n                css.showFakeInput = !addr.province;\n            };\n\n            // todo:必须要先在外部调用Weixin.config,或许内部也用一个后备?\n            $scope.locate = function (event) {\n                event.stopPropagation();\n\n                css.locating = true;\n\n                Weixin.getLocation(function (res) {\n\n                    //console.log(\"weixinGeo:\", res);\n\n                    Weixin.getLocationName(res.latitude, res.longitude).then(function (data) {\n\n                        //console.log(\"baiduGeo:\", data.data);\n\n                        var result = data.data.result;\n                        result = angular.pick(result.addressComponent, 'province', 'city', 'district', 'street', 'street_number');\n                        var location = Map.gcj02ToBd09({\n                            lat: res.latitude,\n                            lng: res.longitude\n                        });\n                        result.geoLatitude = location.lat;\n                        result.geoLongitude = location.lng;\n\n                        Utils.regularizeAddress(result, $scope.range);\n\n                        angular.extend(addr, result);\n\n                    }).catch(angular.noop).then(function () {\n                        css.locating = false; // like finally\n                    })\n                }, function () {\n                    css.locating = false;\n                })\n            };\n\n        }\n    }\n}])","angular.module('xw.directives').directive('addressList', [\"$q\", function ($q) {\n    return {\n        restrict: 'E',\n        scope: {\n            // 外部传入的数据\n            addresses: '=', // 待编辑的地址, 如果为空, 则表示是新地址\n            range: '=', // 省市区数据\n            watchAddress: '=save',\n            editing: '=',\n            hideOthersWhenEdit: '@'\n        },\n        templateUrl: 'address-list.html',\n        link: function ($scope) {\n            var data = $scope.data = {\n                newAddress: {}\n            };\n\n            // 引用地址指令的内部函数\n            var handler = $scope.handler = {\n                save: [],\n                leave: [],\n                valid: []\n            };\n\n            $scope.editing = function () {\n                if (!$scope.addresses) return false;\n                return !!data.newAddress.edit\n                    || $scope.addresses.some(function (addr) {\n                        return addr.edit;\n                    })\n            };\n\n            $scope.remove = function (idx) {\n                $scope.addresses.splice(idx, 1);\n                handler.save.splice(idx, 1);\n                handler.leave.splice(idx, 1);\n                handler.valid.splice(idx, 1);\n            };\n\n            // 此处监听发生在cur地址指令之外的click.\n            // (如果是在cur指令上发生的click,则交给cur指令自己处理,此处忽略即可)\n            // 这些click表明可能需要保存cur地址指令的数据(如果cur地址指令正处在edit阶段)\n            // 并且需要切换地址指令们的cur状态\n            $scope.watchAddress = function (event) {\n                var target = event.target;\n                var parent = target, cur;\n                // 是否是从address指令上产生的click事件,如果是则定位其序号.\n                do {\n                    if (parent.className.indexOf('address-item') != -1) {\n                        var addressNodes = parent.parentElement.children;\n                        for (var i = 0, len = addressNodes.length; i < len; i++) {\n                            if (addressNodes[i] == parent) {\n                                cur = i;\n                                break;\n                            }\n                        }\n                    }\n                } while (parent = parent.parentElement);\n\n                // 从addresses数据中找出正在处在编辑状态的地址序号\n                var editIdx = -1;\n                var curIdx = -1;\n                $scope.addresses.forEach(function (address, i) {\n                    if (address.edit) {\n                        editIdx = i;\n                    }\n                    if (address.cur) {\n                        curIdx = i;\n                    }\n                });\n\n                // 忽略从cur指令上产生的click事件.\n                if (cur == curIdx ||\n                    (cur == $scope.addresses.length && data.newAddress.cur))\n                    return;\n\n                // 保存\n                var promise;\n                if (editIdx != -1) {\n                    if (handler.valid[editIdx]()) {\n                        promise = handler.save[editIdx]()\n                    } else {\n                        // 阻止离开当前地址指令,并阻止其他地址指令响应click事件.\n                        return event.stopPropagation();\n                    }\n                } else if (data.newAddress.edit) {\n                    if (handler.valid.newAddress()) {\n                        promise = handler.save.newAddress().then(function (address) {\n                            $scope.addresses.push(address);\n                            data.newAddress = {};\n                            return address;\n                        });\n                    } else {\n                        return event.stopPropagation();\n                    }\n                }\n\n                // 离开\n                if (curIdx != -1) {\n                    handler.leave[curIdx]();\n                    if (editIdx == -1)\n                        promise = $q.resolve($scope.addresses[curIdx]);\n                } else if (data.newAddress.cur) {\n                    handler.leave.newAddress();\n                }\n\n                // 如果是保存那这就是promise,否则不是.\n                return promise;\n            };\n        }\n    }\n}]);","angular.module('xw.directives').directive('captureClick',[\"$parse\", \"$rootScope\", function($parse, $rootScope) {\n    /**\n     * 监听capture阶段的事件\n     * ng-click不支持capture阶段的事件监听,因为和jquery兼容的jqlite不支持.(jquery不支持是因为ie9以下只有冒泡)\n     * 基于以下修改:https://github.com/angular/angular.js/blob/master/src/ng/directive/ngEventDirs.js\n     */\n    return {\n        restrict: 'A',\n        compile: function($element, attr) {\n            var fn = $parse(attr.captureClick, /* interceptorFn */ null, /* expensiveChecks */ true);\n            return function ngEventHandler(scope, element) {\n                element[0].addEventListener('click', function (event) {\n                    var callback = function() {\n                        fn(scope, {$event:event});\n                    };\n                    if ($rootScope.$$phase) {\n                        scope.$evalAsync(callback);\n                    } else {\n                        scope.$apply(callback);\n                    }\n                }, true);\n            };\n        }\n    };\n}])","angular.module('xw.directives').directive('errTip', function () {\n    return {\n        scope: {\n            form: '=',\n            error: '@',\n            name: '@'\n        },\n        transclude: true,\n        templateUrl: 'err-tip.html'\n    }\n})","angular.module('xw.directives').directive('menuNav', function () {\n    return {\n        restrict: 'E',\n        scope: {\n            path: '@',\n            localBag: '=',\n            isAddressOk: '&'\n        },\n        templateUrl: 'menu-nav.html',\n        link: function ($scope) {\n            $scope.goToCart = function () {\n                location.href= '/mobile/cart';\n            };\n        }\n    }\n})","angular.module('xw.directives').directive('addressSelection', function () {\n    return {\n        restrict: 'E',\n        scope: {\n            animateTrigger: '=',\n            show: '=',\n            address: '=',\n            noAddress: '=',\n            dishId: '@',\n            path: '@'\n        },\n        templateUrl: 'address-selection.html'\n    }\n});","angular.module('xw.services').factory('Alert', function () {\n    var codeMsg = {\n        1110: '手机号码或密码错误',\n        1111: '手机号码或密码错误',\n        1112: '该用户已存在',\n        1113: '手机号码或密码错误',\n\n        2110: '手机号码错误',\n\n        3110: '短信码错误',\n        3111: '短信码已过期',\n        3112: '无效的短信码',\n        3113: '错误的短信码类型',\n        3114: '短信码验证次数过多, 请重新接收短信码',\n        3115: '发送失败, 请稍后重试',\n        3116: '短信码发送次数达到当日最大次数',\n\n        4110: '库存不足',\n\n        5110: '尚未到充值码使用时间',\n        5111: '优惠码/优惠券已过期',\n        5112: '优惠码/优惠券已被使用',\n        5113: '超出优惠码/优惠券最大使用次数'\n    };\n\n    return {\n        show: function (code, def) {\n            var msg = codeMsg[code];\n            if (msg) alert(msg);\n            else if (def) alert(def);\n        },\n        message: function (code) {\n            return codeMsg[code] || '';\n        }\n    }\n})","angular.module('xw.services').provider('Debug', function () {\n    var that = this;\n    that.debugKey = 'debug';\n\n    this.$get = [\"Utils\", function (Utils) {\n        var isDebug = new RegExp('\\\\b' + that.debugKey + '\\\\b');\n        var fakeWarehouse = '';\n        var searches = Utils.searches(location.search);\n        isDebug = isDebug.test(location.search) || !!sessionStorage.getItem('debug');\n\n        if (isDebug && !sessionStorage.getItem('debug')) {\n            sessionStorage.setItem('debug', 'true');\n        }\n        if (isDebug) {\n            if ('fakewarehouse' in searches) {\n                fakeWarehouse = searches.fakewarehouse;\n            }\n        }\n\n        var ret = {\n            //默认根据查询参数中到是否出现debug参数来判断\n            isDebug: isDebug,\n            alert: function (val) {\n                if (this.isDebug) {\n                    console.log(val); // todo:怎么判断log是否有效?如果有效,似乎就没有多大必要调用alert了.\n                    val = Object.prototype.toString.call(val) == \"[object Object]\"\n                        ? JSON.stringify(val) : val;\n                    alert(val);\n                }\n            },\n            assert: function (express, sval) {\n                if (this.isDebug) {\n                    !express && alert(sval);\n                }\n            },\n            promiseErrFn: function (msg) {\n                return function(res) {\n                    ret.alert(msg);\n                    ret.alert(res);\n                }\n            },\n            fakeWarehouse: fakeWarehouse\n        };\n        \n        return ret\n    }]\n});","angular.module('xw.services').factory('Map', [\"$http\", \"Debug\", function ($http, Debug) {\n    // 如果有必要修改则需要改成provider\n    var topDistance = {\n        xinweioffice: 6000,\n        caohejing1: 1560\n    };\n\n    var map = {\n        bentoNoReach: 999999,\n\n        topDistance: {\n            xinweioffice: 6000,\n            caohejing1: 1560\n        },\n\n        suggestion: function (query, region) {\n            return $http.get('/mobile/placesuggestion?query=' + query + '&region=' + region)\n        },\n\n        search: function (query, region) {\n            return $http.get('/mobile/placesearch?query=' + query + '&region=' + region)\n        },\n\n        // 坐标转化\n        // https://github.com/JackZhouCn/JZLocationConverter/\n        gcj02ToBd09: function (location) {\n            var y = location.lat;\n            var x = location.lng;\n            var z = Math.sqrt(x * x + y * y) + 0.00002 * Math.sin(y * Math.PI);\n            var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * Math.PI);\n    \n            return {\n                lng: z * Math.cos(theta) + 0.0065,\n                lat: z * Math.sin(theta) + 0.006\n            }\n        },\n\n        // 在调用百度suggestion api后会用到\n        bd09ToGcj02: function (location) {\n            var y = location.lat - 0.006;\n            var x = location.lng - 0.0065;\n            var z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * Math.PI);\n            var theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * Math.PI);\n    \n            return {\n                lng: z * Math.cos(theta),\n                lat: z * Math.sin(theta)\n            }\n        },\n\n        //根据坐标计算直线距离\n        //https://github.com/googollee/eviltransform\n        lineDistance: function (latA, lngA, latB, lngB) {\n            var earthR = 6371000;\n            var x = Math.cos(latA * Math.PI / 180) * Math.cos(latB * Math.PI / 180) * Math.cos((lngA - lngB) * Math.PI / 180);\n            var y = Math.sin(latA * Math.PI / 180) * Math.sin(latB * Math.PI / 180);\n            var s = x + y;\n            if (s > 1) {\n                s = 1;\n            }\n            if (s < -1) {\n                s = -1;\n            }\n            var alpha = Math.acos(s);\n            return alpha * earthR;\n        },\n\n        lineDistance2CHJ: function (lat, lng) {\n            var CHJ = this.warehouseCoords.caohejing1;\n            return this.lineDistance(lat, lng, CHJ.lat, CHJ.lng)\n        },\n\n        fixZero: function (d, lat, lng) {\n            if (d !== 0) return d;\n            var lineD = this.lineDistance(lat, lng, 31.189426, 121.460625);\n            return lineD > 1500 ? 999999 : d;\n        },\n\n        /**\n         * 对百度地图routematrix api的后端包装,此处原样返回百度的数据\n         * @param lat gcj02坐标 | [sval, obj, ..]\n         * @param lng\n         * @param warehouse\n         * @returns {HttpPromise}\n         */\n        walkingDistance: function (lat, lng, warehouse) {\n            var args;\n            warehouse = warehouse || '';\n            if (Array.isArray(arguments[0])) {\n                args = arguments[0];\n                warehouse = lng;\n            } else {\n                args = [{lat: lat, lng: lng}];\n            }\n\n            var sval = '';\n            args.forEach(function (arg, i) {\n                if (i >= 5) return; //百度限制\n                var prefix = i == 0 ? '' : '|';\n                if (typeof arg == 'string') {\n                    sval += prefix + arg;\n                } else {\n                    sval += prefix + arg.lat + ',' + arg.lng;\n                }\n            });\n\n            return $http.get('/mobile/distance?destinations=' +\n                encodeURIComponent(sval) + '&warehouse=' + warehouse)\n            .then(function (res) {\n                    var results = res.data.result.elements;\n                    var ret = [];\n                    var len = results.length / 2;\n                    var pair;\n                    for (var i = 0; i < len; i++) {\n                        results[i].warehouse = 'xinweioffice';\n                        results[len + i].warehouse = 'caohejing1';\n                        pair = [results[i], results[len + i]];\n                        pair = angular.sort(pair, function (a, b) {\n                            return (a.distance.value - topDistance.xinweioffice) -\n                                (b.distance.value - topDistance.caohejing1)\n                        });\n                        ret.push(pair);\n                    }\n                    return ret;\n                })\n            .catch(function () {\n                    console.log('get distance error');\n                    return []\n                })\n        },\n\n        /**\n         * 计算距离仓库的距离\n         * @param lat gcj02\n         * @param lng gcj02\n         * @param warehouse - 'CHJ'\n         * @returns {*|Promise.<T>}\n         */\n        distance: function (lat, lng, warehouse) {\n            return this.walkingDistance(lat, lng, warehouse).then(function (res) {\n                var d = res[0][0].distance.value;\n                d = map.fixZero(d, lat, lng);\n                var top = topDistance[res[0][0].warehouse];\n                return {\n                    distance: d,\n                    // 百度有时候返回的是null, 此时就当作1000公里\n                    isInRange: (d === null ? 999999 : d) <= top,\n                    warehouse: res[0][0].warehouse\n                }\n            }).catch(function (res) {\n                Debug.alert('获取步行距离失败');\n                Debug.alert(res);\n            })\n        },\n\n        distances: function (dests, warehouse) {\n            dests = Array.isArray(dests) ? dests : [dests];\n            return this.walkingDistance(dests, warehouse).then(function (res) {\n                return res.map(function (el, i) {\n                    var d = map.fixZero(el[0].distance.value, dests[i].lat, dests[i].lng);\n                    var top = topDistance[el[0].warehouse];\n                    return {\n                        distance: d,\n                        isInRange: (d === null ? 999999 : d) <= top,\n                        warehouse: el[0].warehouse\n                    }\n                })\n            })\n        },\n\n        nearestWarehouse: function (lat, lng) {\n            var that = this;\n            var topDistance2HQ = topDistance['xinweioffice'];\n            var topDistance2CHJ = topDistance['caohejing1'];\n            var warehouses = angular.sort(['xinweioffice', 'caohejing1'].map(function (name) {\n                var warehouse = that.warehouseCoords[name];\n                return {\n                    name: name,\n                    distance: that.lineDistance(lat, lng, warehouse.lat, warehouse.lng)\n                }\n            }), function (a, b) {\n                return (a.distance - topDistance2HQ + 1100) - (b.distance - topDistance2CHJ)\n            });\n\n            if (Debug.fakeWarehouse) {return Debug.fakeWarehouse}\n            return warehouses[0].name;\n\n        },\n\n        warehouseCoords: {\n            xinweioffice: {\n                lat: 31.189426,\n                lng: 121.460625\n            },\n            caohejing1: {\n                lat: 31.169250,\n                lng: 121.398949\n            }\n        }\n    };\n\n    return map;\n}]);","angular.module('xw.services').factory('ScopeDecorator', [\"$location\", function ($location) {\n    return {\n        common: function (scope) {\n            if (!scope) return;\n            scope.back = function () {\n                if (history.length > 1) history.back();\n                else location.href = '/mobile/'\n            }\n        },\n        nav: function (scope) {\n            if (!scope) return;\n            scope.$on('$locationChangeStart', function () {\n                scope.path = $location.path();\n            });\n        }\n    }\n}]);","angular.module('xw.services').factory('Utils', [\"$localStorage\", function ($localStorage) {\n    return {\n        // todo: base64编码后的字符包括大小写字母各26各,以及数字,以及 + / = 这3个字符\n        // 而 +(这个...) 和 / 在url中会被转义,因此需要再做替换,这里替换 + 为 - , / 替换为 _\n        utf2b64: function (str) {\n            return btoa(unescape(encodeURIComponent(str))).replace(/\\+/g, '-').replace(/\\//g, '_');\n        },\n        b642utf: function (str) {\n            return decodeURIComponent(escape(window.atob(str.replace(/-/g, '+').replace(/_/g, '/'))));\n        },\n\n        // 两个购物车item是否是同一个,购物车item结构为:{dish:dish, number:, subDish:[]}\n        isSameItemInCart: function (item1, item2) {\n            return item1.dish._id == item2.dish._id && //主dish是否相同\n                item1.subDish.every(function (a) { //子dish是否全部相同\n                    return item2.subDish.some(function (b) {\n                        return a.dish._id == b.dish._id\n                    })\n                }) && item1.subDish.length == item2.subDish.length;\n        },\n\n        // 合并本地购物车和线上购物车, 将数据全部合并到本地购物车.\n        // local dish的数量(非dish.number)只会增加不会减少\n        mergeCarts: function (local, server) {\n            if (!local || !local.length) return server;\n            var that = this;\n            for (var i = 0; i < server.length; i++) {\n                var notInLocal = local.every(function (lDish) {\n                    return !that.isSameItemInCart(lDish, server[i])\n                });\n                if (notInLocal)\n                   local.push(server[i]);\n            }\n            return local;\n        },\n\n        /**\n         * 从/api/dishes获取到dish列表中抽取上线且有货的子属性菜品\n         * @param dishList [{_id:., outOfStock: ., ..}]\n         * @param type - 'main', or 'preference'\n         * @returns [24位id, ..] 最小化localStorage的存储成本.(也许取末几位就可以)\n         */\n        getStockId: function (dishList, type) {\n            var idStockMap = {};\n            if (type == 'preference') {\n                dishList.forEach(function (dish) {\n                    dish.preferences.forEach(function (p) {\n                        p.foodMaterial.forEach(function (f) {\n                            if (!idStockMap[f.dish._id] && f.dish.isPublished) {\n                                idStockMap[f.dish._id] = true;\n                            }\n                        })\n                    })\n                });\n            } else {\n                dishList.forEach(function (dish) {\n                    if (!idStockMap[dish._id] && !dish.outOfStock) {\n                        idStockMap[dish._id] = true;\n                    }\n                })\n            }\n\n            return Object.keys(idStockMap);\n        },\n\n        /**\n         * localStorage实在是太大了,去掉多余的信息,只保留必要的信息.这些必要掉信息需要手动清除\n         */\n        cleanLocalStorage: function () {\n            var remain = [ 'promotion', 'access_token', 'selectedAddress'];\n            Object.keys($localStorage).forEach(function (key) {\n                if (remain.indexOf(key) == -1 && key[0] != '$') {\n                    delete $localStorage[key];\n                }\n            })\n        },\n\n        /**\n         * 接收'?a=1&b=&c'这样的查询字符串,输出:{a:1, b:'', c: ''}\n         * @param search - 如果没有则使用location.search\n         * @returns {*}\n         */\n        searches: function (search) {\n            search = search || location.search;\n            return search.slice(1).split('&').reduce(function (obj, cur) {\n                if (cur) {\n                    cur = cur.split('=');\n                    obj[cur[0]] = decodeURIComponent(cur[1] || '');\n                }\n                return obj;\n            }, {});\n        },\n\n        /**\n         * 确认两个地址是否相同,比如上海和上海市应该是相同的\n         * @param addr1\n         * @param addr2\n         * @returns {boolean}\n         */\n        addressEqual: function (addr1, addr2) {\n            addr1 = addr1 || '';\n            addr2 = addr2 || '';\n            if (!addr1 || !addr2) return false;\n            return !addr1.indexOf(addr2) || !addr2.indexOf(addr1)\n        },\n\n        /**\n         * 将老地址中的`徐汇`之类的转换成新地址的`徐汇区`\n         * @param address - {province:.., city: .., district: ..}\n         * @param ref - [从服务端拉取的地址数组, /api/../range]\n         */\n        regularizeAddress: function (address, ref) {\n            var cities, districts;\n            var equal = this.addressEqual;\n            ref.some(function (state) {\n                if (equal(address.province, state.state)) {\n                    address.province = state.state;\n                    cities = state.cities;\n                    return true;\n                }\n            });\n\n            cities && cities.some(function (city) {\n                if (equal(address.city, city.city)) {\n                    address.city = city.city;\n                    districts = city.areas;\n                    return true;\n                }\n            });\n\n            districts && districts.some(function (district) {\n                if (equal(address.district, district)) {\n                    address.district = district;\n                    return true;\n                }\n            });\n\n            return address\n        },\n\n        /**\n         * 基于服务端传回的配送范围数据,以空,或省,或市为参数来查询相应的子地区列表\n         * @example call('浙江') - return ['杭州市', '宁波市', ..]; call(), - ret[全国省]\n         * @param addresses - 服务端范围数据 /api/../range\n         * @param province\n         * @param city\n         * @returns []\n         */\n        addressOptions: function (addresses, province, city) {\n            var len = arguments.length;\n            if (len == 1) {\n                return addresses.map(function (el) {return el.state})\n\n            } else if (len == 2) {\n                if (!province) return;\n                //这里可以将结果缓存起来, 以节省len == 2时(以及以后可能相同)的多余计算\n                return addresses.filter(function (el) {\n                    return el.state == province\n                })[0].cities.map(function (el) {\n                        return el.city;\n                    })\n\n            } else if (len == 3) {\n                if (!city) return;\n                return addresses.filter(function(el) {\n                    return el.state == province\n                })[0].cities.filter(function (el) {\n                        return el.city\n                    })[0].areas\n            }\n        },\n\n        stockOfDish: function (dish, warehouse) {\n            return dish.stockWarehouse.some(function (item) {\n                return item.warehouse == warehouse && item.stock > 0;\n            })\n        },\n\n        /**\n         * 例如购物中的item {dish: {}, subDish: [..]}\n         * @param item\n         * @param warehouse\n         */\n        stockOfItem: function (item, warehouse) {\n            var stockOfDish = this.stockOfDish;\n            return stockOfDish(item.dish, warehouse) && item.subDish.every(function (el) {\n                    return stockOfDish(el.dish, warehouse)\n                })\n        }\n    }\n}]);","angular.module('xw.weixin').factory('Weixin',[\"$http\", \"Debug\", function ($http, Debug) {\n\n    var defaults = {\n        //weixin js config\n        wx: {\n            appId: 'wx37a1323e488cef84',\n            jsApiList: ['getLocation', 'onMenuShareTimeline', 'onMenuShareAppMessage']\n        },\n\n        // xinwei location, gcj02\n        location: {\n            longitude: 121.460625,\n            latitude: 31.189426\n        },\n\n        ak: 'xnKgWtGYXf4gkLgreox7xpjI',\n\n        oauthUrl: '/api/orders/payment/weixinpay/oauthcode?orderid='\n    };\n\n    return {\n        isWeixin: /MicroMessenger/i.test(navigator.userAgent),\n\n        oauthUrl: defaults.oauthUrl,\n\n        readyState: false,\n\n        // 微信的事后ready似乎不好用，连个详细的文档都没有，还是自己实现靠谱。\n        ready: function (cb) {\n            if (this.readyState) {\n                cb();\n            } else this.ready.cb = cb;\n        },\n        /**\n         * set jsapi config\n         * @param setting\n         */\n        config: function (setting) {\n            var that = this;\n            var _setting = angular.copy(defaults.wx);\n            _setting.timestamp = setting.timestamp;\n            _setting.nonceStr = setting.nonceStr; // todo: be careful to different backend returned data.\n            _setting.signature = setting.signature;\n\n            wx.config(_setting);\n\n            wx.ready(function() {\n                that.ready.cb && that.ready.cb();\n                that.readyState = true;\n            });\n        },\n        /**\n         * @param success - success callback with {lat: . lng: .} arguemnt\n         * @param fail - fail callback with unknown arguemnt\n         */\n        getLocation: function(success, fail) {\n            var setting = {type: 'gcj02'};\n            success && (setting.success = success);\n            fail && (setting.fail = fail);\n            wx.getLocation(setting);\n        },\n\n        /**\n         * 同微信分享朋友圈接口http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html#.E8.8E.B7.E5.8F.96.E2.80.9C.E5.88.86.E4.BA.AB.E5.88.B0.E6.9C.8B.E5.8F.8B.E5.9C.88.E2.80.9D.E6.8C.89.E9.92.AE.E7.82.B9.E5.87.BB.E7.8A.B6.E6.80.81.E5.8F.8A.E8.87.AA.E5.AE.9A.E4.B9.89.E5.88.86.E4.BA.AB.E5.86.85.E5.AE.B9.E6.8E.A5.E5.8F.A3\n         * @param settings\n         */\n        shareTimeline: function (settings) {\n            wx.onMenuShareTimeline(settings);\n        },\n\n        shareAppMessage: function (settings) {\n            wx.onMenuShareAppMessage(settings);\n        },\n\n        showOptionMenu: function () {\n            wx.showOptionMenu();\n        },\n\n        hideOptionMenu: function () {\n            wx.hideOptionMenu();\n        },\n\n        /**\n         * get location with baidu api\n         * @param lat - gcj02\n         * @param lng\n         * @return promise will resolved with $http res.\n         */\n        getLocationName: function (lat, lng) {\n            var mapUrl = 'http://api.map.baidu.com/geocoder/v2/?output=json&pois=1&coordtype=gcj02ll&callback=JSON_CALLBACK'\n            return $http.jsonp(mapUrl, {\n                params: {\n                    ak: defaults.ak,\n                    location: lat + ',' + lng\n                }\n            })\n        },\n        /**\n         * 获取jsconfig 参数\n         * @param url\n         * @returns {HttpPromise}\n         */\n        getJsconfig: function () {\n            return $http.post('/api/orders/payment/weixinpay/config', {\n                url: location.href.substr(0, location.href.length - location.hash.length)\n            });\n        }\n    }\n}]);","/**\n * 图片自适应为屏幕宽度\n */\nangular.module('xw.filters').filter('adapt', function () {\n    var width = Math.floor(document.body.offsetWidth * window.devicePixelRatio);\n    var height = Math.floor(width * 2 / 3);\n    var prefix = '?imageView2/1/w/';\n    var query = prefix + width + '/h/' + height;\n    return function (src, ratio) {\n        return src + (ratio ?\n                prefix + width + '/h/' + Math.floor(width * ratio) :\n                query)\n    }\n});\n\n/**\n *  将类似于1/2的文本显示为¹⁄₂\n */\nangular.module('xw.filters').filter('fraction', function () {\n    var superscripts = ['⁰', '¹', '²', '³', '⁴', '⁵', '⁶', '⁷', '⁸', '⁹'];\n    var subscripts = ['\\u2080', '\\u2081', '\\u2082', '\\u2083', '\\u2084',\n        '\\u2085', '\\u2086', '\\u2087', '\\u2088', '\\u2089'];\n\n    function i2s(sval, scripts) {\n        var ret = '';\n        for (var i = 0; i < sval.length; i++) {\n            ret += scripts[sval[i]]\n        }\n        return ret;\n    }\n\n    return function (str) {\n        return str.replace(/(\\d+)\\/(\\d+)/g, function (_, sup, sub) {\n            return i2s(sup, superscripts) + '⁄' + i2s(sub, subscripts) + ' ';\n        })\n    }\n});\n\n/**\n * 将服务器传回来的dish结构的数据转换为post dish更新购物车时需要的格式(不在模板中使用)\n */\nangular.module('xw.filters').filter('postDish', function () {\n    return function (dish) {\n        return {\n            dish: dish.dish._id,\n            number: dish.number,\n            subDish: !dish.subDish ? [] : dish.subDish.map(function (el) {\n                return {\n                    dish: el.dish._id,\n                    number: el.number\n                }\n            })\n        }\n    }\n});\n\n/**\n * 使mobile变成 133 3333 3333这种形式, 有更好的可读性\n */\nangular.module('xw.filters').filter('beautifyMobile', function () {\n    return function (mobile) {\n        if (!/^\\d{11}$/.test(mobile)) return mobile;\n        return mobile.replace(/^(\\d{3})(\\d{4})(\\d{4})$/,\n            function (_, m1, m2, m3) {\n                return m1 + ' ' + m2 + ' ' + m3;\n            })\n    }\n});\n\n/**\n * 使title变成 '/土豆泥' 这样的形式\n */\nangular.module('xw.filters').filter('subDishTitle', function () {\n    return function (item) {\n        var last = item.subDish.length;\n        if (!last) return '';\n        return '(' + item.subDish.reduce(function (title, cur, i) {\n            return title + cur.dish.title.zh + (i == last - 1 ? '' : '/')\n        }, '') + ')';\n    }\n});\n\n/**\n * 将查询返回的派送时间转换成下单所需要的形式[NOT FOR HTML]\n * time为{hour: ''}, 当type为eat时,\n * time为{day:{day:''}, time: {name: ''}}, 当type为cook时,\n * time为{eat: {hour}, cook:{day,time}}, 当type为all时.\n */\nangular.module('xw.filters').filter('orderTime', function () {\n    return function filter(time, type) {\n        var ret;\n        if (type == 'eat') {\n            return {\n                deliveryDateEat: time.hour.substr(0, 10),\n                deliveryTimeEat: time.hour.substr(11, 5)\n            }\n        } else if (type == 'cook') {\n            ret = {deliveryDateCook: time.day};\n            ret.deliveryTimeCook = time.segment ? time.segment.name+':00' : '12:00';\n            return ret;\n        } else if (type == 'all') {\n            ret = {};\n            if (time.eat) ret = filter(time.eat, 'eat');\n            if (time.cook) angular.extend(ret, filter(time.cook, 'cook'));\n            return ret;\n        }\n    }\n});\n\nangular.module('xw.filters').filter('cookTimeUnion', function () {\n    return function (times) {\n        if (!times || !times.length) {\n            return times\n        }\n        var hasSegment = !!times[0].segment;\n        return times.reduce(function (list, cur) {\n            if (hasSegment) {\n                cur.segment.forEach(function (item) {\n                    list.push({\n                        day: cur.day,\n                        segment: item\n                    })\n                })\n            } else {\n                list.push({day: cur.day})\n            }\n            return list;\n        }, [])\n    }\n})\n\n/**\n * 有多种不同的dishList类型, 有些是从后端获得的, 有些是作为更新购物车post回去的,\n * 有些是前端为了展示方便而构造的, 此处对其做统一转换, 免去放在controller中的苦恼.\n * dishes: 待转换待原始数据. tType:target type. sType: source type\n * type: 'displayCart',用来展示待购物车的dish list\n *       'order', 用来下单的list\n *\n * examples:\n * displayCart, 为 {cookList: [], eatList: []}, 其中[]为如下形式\n * [{\n *   dish: Dish, // {_id: '', title: {zh:'', en: ''}, ...}\n *   subDish: [{dish},.]\n *   number\n * }, ..]\n *\n * order, 为 {dishList: []}, 其中[]为如下形式\n * [{\n *   dish: _id,\n *   number: number,\n *   subDish: [..]\n * }, ..]\n */\nangular.module('xw.filters').filter('dishes', function () {\n    return function (dishes, tType, sType) {\n        var ret;\n        // 将displayCart 转换为 order 类型的dishList\n        if (tType == 'order' && sType == 'displayCart') {\n            ret = [];\n            Object.keys(dishes).forEach(function (key) {\n                dishes[key].forEach(function (el) {\n                    ret.push({\n                        dish: el.dish._id,\n                        number: el.number,\n                        subDish: el.subDish.map(function (sDish) {\n                            return {\n                                dish: sDish.dish._id,\n                                number: sDish.number\n                            }\n                        })\n                    });\n                });\n            });\n\n            return {dishList: ret}\n        } else return dishes\n    }\n});\n\n/**\n * 优惠券下单数据转换.要求传入当数据格式为: {code: '优惠码字符串', card: {优惠券对象}}\n */\nangular.module('xw.filters').filter('coupon', function () {\n    return function (coupon) {\n        var ret = {};\n        if (coupon.code) {\n            ret.promotionCode = coupon.code;\n            if (coupon.code.length == 8) {\n                // tcl 优惠券特殊处理. 我们的优惠券要求必须是10位\n                ret.promotionCode = 'zz' + ret.promotionCode;\n            }\n        }\n        if (coupon.card) {\n            ret.coupon = coupon.card._id;\n        }\n        return ret;\n    }\n});\n\n/**\n * 便当配送时间选项补充上请选择时间\n */\nangular.module('xw.filters').filter('eatTimeOptions', function () {\n    return function (times) {\n        if (!times || !times.length) return times;\n        times.unshift({hour: '请选择配送时间'});\n        return times;\n    }\n});\n\nangular.module('xw.filters').filter('eatTimeDisplay', function () {\n    return function (time) {\n        return time.hour\n    }\n});\n\nangular.module('xw.filters').filter('cookTimeOptions', function () {\n    return function (times) {\n        if (!times || !times.length) return times;\n        times.unshift({day: '请选择配送时间'});\n        return times\n    }\n});\n\nangular.module('xw.filters').filter('cookTimeDisplay', function () {\n    return function (time) {\n        return time.day == '请选择配送时间' || time.segment ?\n            time.day : time.day + ' 送达'\n    }\n});\n\n// 返回购物车item的价格\nangular.module('xw.filters').filter('dishPrice', function () {\n    return function (item, total) {\n        var price = item.dish.priceOriginal;\n        if (item.subDish) {\n            for (var i = 0, len = item.subDish.length; i < len; i++) {\n                price += item.subDish[i].dish.priceOriginal;\n            }\n        }\n        return price * (total ? item.number : 1);\n    }\n})\n\n","angular.module(\"xw.directives\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"add-dish-bar.html\",\"<div class=\\\"selection-cover\\\" ng-cloak ng-if=\\\"dish\\\" ng-click=\\\"hide()\\\"></div><div class=\\\"selections-container\\\" ng-if=\\\"dish\\\" ng-cloak><div class=\\\"block\\\"><h4 class=\\\"text-center\\\">{{dish.title.zh}}<span ng-click=\\\"hide()\\\" class=\\\"button close-button\\\"></span></h4><ul class=\\\"properties\\\" ng-if=\\\"dish.preferences.length\\\"><li ng-repeat=\\\"property in dish.preferences track by property._id\\\"><h5>{{property.name.zh}}</h5><ul class=\\\"selections\\\"><li ng-repeat=\\\"selection in property.foodMaterial track by selection._id\\\" ng-click=\\\"(!selection.dish.outOfStock && selection.dish.isPublished) && (dish.curSelection[property.name.zh] = selection.dish)\\\" ng-class=\\\"{\\'no-stock\\': (selection.dish.outOfStock || !selection.dish.isPublished), selected: dish.curSelection[property.name.zh] == selection.dish}\\\">{{selection.dish.title.zh}}</li></ul></li></ul><div class=\\\"counter-wrapper\\\"><i>份数</i><div class=\\\"counter text-center\\\"><span ng-click=\\\"dish.count>0 && (dish.count=dish.count-1)\\\" class=\\\"minus\\\">-</span> <span class=\\\"number\\\">{{dish.count}}</span> <span ng-click=\\\"dish.count=dish.count+1\\\" class=\\\"add\\\">+</span></div></div><div class=\\\"add-to-cart-button text-center\\\" ng-class=\\\"{invalid: dish.count == 0}\\\" ng-click=\\\"dish.count>0 && addToCart(dish)\\\">加入购物袋</div></div></div>\");\n$templateCache.put(\"address-list.html\",\"<ul class=\\\"address-list\\\" capture-click=\\\"watchAddress($event)\\\"><li class=\\\"address-item\\\" ng-repeat=\\\"address in addresses\\\"><address cur=\\\"{{$first}}\\\" range=\\\"range\\\" out-address=\\\"address\\\" hide leave=\\\"handler.leave[$index]\\\" save=\\\"handler.save[$index]\\\" valid=\\\"handler.valid[$index]\\\" delete-hook=\\\"remove($index)\\\"></address></li><li ng-if=\\\"range\\\" class=\\\"address-item\\\"><address range=\\\"range\\\" out-address=\\\"data.newAddress\\\" cur=\\\"{{!addresses.length}}\\\" leave=\\\"handler.leave.newAddress\\\" save=\\\"handler.save.newAddress\\\" valid=\\\"handler.valid.newAddress\\\"></address></li></ul>\");\n$templateCache.put(\"address-selection.html\",\"<div class=\\\"address-selection\\\" flash-class=\\\"{exp: animateTrigger, duration: 400}\\\" ng-if=\\\"show\\\" ng-cloak><a href=\\\"/mobile/orderaddress?path={{path}}&dishId={{dishId}}\\\"><div ng-show=\\\"path != \\'/eat\\' && address\\\" class=\\\"address-tip\\\">配送至:{{address.street + address.address | limitTo: 18}}</div><div ng-show=\\\"noAddress\\\" class=\\\"no-address-tip\\\">您没有可以配送的地址,请先新建地址</div><div ng-show=\\\"path == \\'/eat\\' && (address && !address.isAvailableForEat)\\\" class=\\\"no-address-tip\\\">当前地址不在便当配送范围内(如果该地址以前可用,请点此重新编辑后再试)</div><div ng-show=\\\"path == \\'/eat\\' && address.isAvailableForEat\\\" class=\\\"address-tip\\\">配送至:{{address.street + address.address | limitTo: 18}}</div></a></div>\");\n$templateCache.put(\"address.html\",\"<div ng-if=\\\"css.isNewAddress && css.edit\\\" class=\\\"new-address-tip\\\">请填写有效的地址以便按时送达</div><div ng-hide=\\\"hide()\\\" class=\\\"address-component\\\" ng-class=\\\"{cur: css.cur || css.isNewAddress, edit: css.edit}\\\" ng-click=\\\"choose($event)\\\"><div class=\\\"address-block\\\" ng-if=\\\"!css.isNewAddress\\\"><span class=\\\"deliverable-tag\\\" ng-if=\\\"addr.isAvailableForEat\\\">便当可送达</span><div>{{addr.contactPerson}}</div><div class=\\\"cur-show\\\">{{addr.mobile | beautifyMobile}}</div><div class=\\\"cur-show\\\">{{addr.province + \\' \\' + addr.city + \\' \\' + addr.district}}</div><div>{{addr.street}}</div><div class=\\\"cur-show\\\">{{addr.address}}</div><div class=\\\"user-actions\\\"><span class=\\\"glyphicon glyphicon-pencil\\\"></span> <span ng-click=\\\"deleteAddress($event)\\\" class=\\\"glyphicon glyphicon-trash\\\"></span></div></div><div class=\\\"new-address-block\\\" ng-if=\\\"css.isNewAddress && !css.edit\\\">+ 新建收货地址</div><form ng-model-options=\\\"{ updateOn: \\'default blur\\', debounce: { \\'default\\': 500, \\'blur\\': 0 } }\\\" ng-class=\\\"{\\'new-address\\': css.isNewAddress}\\\" ng-if=\\\"css.edit\\\" name=\\\"form\\\"><div ng-init=\\\"initForm(form, addr)\\\" ng-class=\\\"{\\'with-tag\\': addr.isAvailableForEat}\\\"><input name=\\\"contactPerson\\\" type=\\\"text\\\" placeholder=\\\"收货人\\\" ng-model=\\\"addr.contactPerson\\\" auto-focus minlength=\\\"2\\\" required><err-tip form=\\\"form\\\" name=\\\"contactPerson\\\" error=\\\"required\\\">必填</err-tip><err-tip form=\\\"form\\\" name=\\\"contactPerson\\\" error=\\\"minlength\\\">联系人姓名至少2个字</err-tip></div><div><input name=\\\"mobile\\\" type=\\\"tel\\\" placeholder=\\\"手机号\\\" ng-model=\\\"addr.mobile\\\" pattern=\\\"^1\\\\d{10}$\\\" required><err-tip form=\\\"form\\\" name=\\\"mobile\\\" error=\\\"required\\\">必填</err-tip><err-tip form=\\\"form\\\" name=\\\"mobile\\\" error=\\\"pattern\\\">请填写11位手机号</err-tip></div><div ng-show=\\\"!css.showFakeInput\\\" class=\\\"selects\\\"><div class=\\\"select\\\"><select required name=\\\"province\\\" id=\\\"province\\\" ng-options=\\\"province for province in options()\\\" ng-change=\\\"trySelectUnique()\\\" ng-model=\\\"addr.province\\\"></select></div><div class=\\\"select\\\"><select required name=\\\"city\\\" id=\\\"city\\\" ng-options=\\\"city for city in options(addr.province)\\\" ng-model=\\\"addr.city\\\"></select></div><div class=\\\"select\\\"><select required name=\\\"district\\\" id=\\\"district\\\" ng-options=\\\"district for district in options(addr.province, addr.city)\\\" ng-model=\\\"addr.district\\\"></select></div></div><div ng-if=\\\"css.showFakeInput\\\"><input type=\\\"text\\\" placeholder=\\\"省、市、区\\\" ng-click=\\\"css.showFakeInput = false\\\"> <span class=\\\"err-tip\\\" ng-if=\\\"(form.province.$error.required||form.city.$error.required||form.district.$error.required) &&form.$submitted\\\">必填</span></div><div ng-click=\\\"showSearchAddress()\\\">{{addr.street}} <input type=\\\"hidden\\\" name=\\\"street\\\" placeholder=\\\"街道\\\" ng-model=\\\"addr.street\\\" required> <span ng-if=\\\"!addr.street\\\" class=\\\"placeholder\\\">街道</span><err-tip form=\\\"form\\\" name=\\\"street\\\" error=\\\"required\\\">必填</err-tip></div><div><input name=\\\"address\\\" type=\\\"text\\\" minlength=\\\"2\\\" placeholder=\\\"楼层、门牌号\\\" required ng-model=\\\"addr.address\\\"><err-tip form=\\\"form\\\" name=\\\"address\\\" error=\\\"required\\\">必填</err-tip><err-tip form=\\\"form\\\" name=\\\"address\\\" error=\\\"minlength\\\">至少2个字符</err-tip></div></form><div class=\\\"search-address\\\" ng-if=\\\"css.edit && css.showSearchAddress\\\"><form id=\\\"address-form\\\"><div><input type=\\\"text\\\" placeholder=\\\"小区、写字楼、地标名称\\\" id=\\\"address\\\" ng-model=\\\"data.street\\\" ng-model-options=\\\"{debounce: 400}\\\" auto-focus ng-change=\\\"searchAddress()\\\"></div></form><div class=\\\"find-address-tip\\\" ng-if=\\\"data.streetList.length\\\">您要找的是不是?</div><div class=\\\"no-address-tip\\\" ng-if=\\\"data.street && !data.streetList.length\\\"><h4>未能找到此地址</h4><p>建议只输入小区、写字楼、地标名称等</p></div><ul class=\\\"results\\\"><li ng-click=\\\"confirmStreet($event, street)\\\" ng-repeat=\\\"street in data.streetList\\\"><h4>{{street.name}}</h4><p>{{street.address}}</p></li></ul></div></div>\");\n$templateCache.put(\"confirm.html\",\"<div class=\\\"xw-confirm\\\" ng-click><modal close=\\\"close\\\" show=\\\"showModal\\\" pre-close=\\\"preClose\\\"><div class=\\\"text\\\" ng-transclude></div><div class=\\\"button-group\\\"><span ng-click=\\\"cancel()\\\">取消</span><span ng-click=\\\"confirm()\\\">确定</span></div></modal></div>\");\n$templateCache.put(\"err-tip.html\",\"<span class=\\\"err-tip\\\" ng-if=\\\"(form[name].$dirty||form.$submitted) && form[name].$error[error]\\\" ng-transclude></span>\");\n$templateCache.put(\"geetest-sms-button.html\",\"<div class=\\\"geetest-sms-button-group\\\"><div id=\\\"geetestContainer\\\" ng-show=\\\"state==2\\\"></div><span class=\\\"geetest-sms-button\\\" ng-if=\\\"state <= 1\\\" ng-class=\\\"{invalid: state === 0}\\\" ng-click=\\\"state == 1 && showGeetest()\\\">获取验证码</span> <span class=\\\"geetest-sms-button invalid\\\" ng-if=\\\"state == 3\\\">发送成功 {{remains}}</span> <span ng-click=\\\"state == 5 && showGeetest()\\\" class=\\\"geetest-sms-button\\\" ng-class=\\\"{invalid: state == 4}\\\" ng-if=\\\"state > 3\\\">重新获取</span></div>\");\n$templateCache.put(\"menu-nav.html\",\"<nav class=\\\"menu-nav\\\" ng-class=\\\"{\\'empty\\': !localBag.length}\\\"><div><a href=\\\"/mobile/me\\\"><span>帐号</span></a></div><div ng-class=\\\"{active: path == \\'/eat\\'}\\\"><a href=\\\"/mobile/#/eat\\\"><span>便当</span></a></div><div ng-class=\\\"{active: path == \\'/cook\\' || !path}\\\"><a href=\\\"/mobile/#/cook\\\"><span>食材包</span></a></div><div class=\\\"go-to-cart\\\" ng-class=\\\"{invalid: !isAddressOk()}\\\" ng-if=\\\"localBag.length\\\" flash-class=\\\"{exp: localBag.length, duration: 400}\\\" ng-click=\\\"isAddressOk({isClick: true}) && goToCart()\\\"><div class=\\\"icon bag-icon\\\"><i class=\\\"number\\\" ng-bind=\\\"localBag.length\\\"></i></div><span class=\\\"price\\\" ng-bind=\\\"localBag.price || 0 | number: 1\\\"></span></div></nav>\");\n$templateCache.put(\"modal.html\",\"<div class=\\\"xw-modal-container\\\" ng-show=\\\"css.show\\\"><div class=\\\"xw-modal-backdrop\\\" ng-click=\\\"close()\\\"></div><div class=\\\"xw-modal-content\\\" ng-transclude></div></div>\");\n$templateCache.put(\"shopping-progress-bar.html\",\"<div class=\\\"shopping-progress-bar\\\"><div class=\\\"states\\\"><span ng-class=\\\"{cur: state == \\'state1\\'}\\\" class=\\\"state1\\\">筛选购物袋</span> <span ng-class=\\\"{cur: state == \\'state2\\'}\\\" class=\\\"state2\\\">确认送货地址</span> <span ng-class=\\\"{cur: state == \\'state3\\'}\\\" class=\\\"state3\\\">支付</span></div><div class=\\\"state-bar-container\\\"><div class=\\\"indicator\\\" ng-class=\\\"state\\\"></div></div></div>\");\n$templateCache.put(\"sms-button.html\",\"<div class=\\\"sms-button-group\\\"><span class=\\\"sms-button\\\" ng-if=\\\"state <= 1\\\" ng-class=\\\"{invalid: state === 0}\\\" ng-click=\\\"state == 1 && getSmsCode()\\\">获取验证码</span> <span class=\\\"sms-button invalid\\\" ng-if=\\\"state == 2\\\">{{remains}}秒后重新获取</span> <span ng-click=\\\"state == 4 && getSmsCode()\\\" class=\\\"sms-button\\\" ng-class=\\\"{invalid: state == 3}\\\" ng-if=\\\"state > 2\\\">重新获取</span></div>\");}]);","angular.module('xw.models').factory('Dishes', [\"$http\", function ($http) {\n\n    return {\n        getList: function (warehouse, cookingType) {\n            warehouse = warehouse || '';\n            cookingType = cookingType || '';\n            return $http.get(\n                '/api/dishes?showForWarehouse=' + warehouse +\n                '&cookingType=' + cookingType\n            );\n        },\n        like: function (id) {\n            return $http.put('/api/dishes/' + id + '/like');\n        },\n        getOne: function (id) {\n            return $http.get('/api/dishes/' + id);\n        }\n    }\n}]);\n\nangular.module('xw.models').factory('Orders', [\"$http\", function ($http) {\n    return {\n        postOrder: function (data) {\n            return $http.post('/api/orders', data);\n        },\n        deliveryTime: function (data) {\n            return $http.post('/api/orders/delivery/time', data)\n        },\n        deliveryEatTime: function (data) {\n            return $http.post('/api/orders/delivery/time/eat/warehouse', data)\n        },\n        getOrder: function (orderId) {\n            return $http.get('/api/orders/' + orderId);\n        },\n        updateOrder: function (id, data) {\n            return $http.put('/api/orders/' + id, data)\n        },\n        getList: function () {\n            return $http.get('/api/orders');\n        },\n        getUnifiedOrder: function (data) {\n            return $http.post('/api/orders/payment/weixinpay/unifiedorder', data);\n        }\n    }\n}]);\n\nangular.module('xw.models').factory('User', [\"$http\", \"$localStorage\", function ($http, $localStorage) {\n    // 这些变量作为更新购物车用\n    // 最近一次添加至cart的时间\n    var cartDate = Date.now();\n    var timeSpan = 500;\n    var timer = null;\n\n    return {\n        login: function (username, password, couponcode) {\n            var args = {\n                username: username,\n                password: password,\n                grant_type: 'password'\n            };\n            if (couponcode) args.couponcode = couponcode;\n            return $http.post('/api/user/token', args).then(function (res) {\n                if (res.data && res.data.access_token) {\n                    $localStorage.access_token = res.data.access_token;\n                }\n\n                return res;\n            })\n        },\n        signup: function (mobile, pwd, code, couponcode) {\n            var opts = {\n                mobile: mobile,\n                pwd: pwd,\n                code: code\n            };\n            if (couponcode) {\n                opts.couponcode = couponcode;\n            }\n            return $http.post('/api/user/signup', opts).then(function (res) {\n                if (res.data && res.data.access_token) {\n                    $localStorage.access_token = res.data.access_token;\n                }\n\n                return res;\n            })\n        },\n        getSmsCode: function (data) {\n            return $http.post('/api/user/sms', data)\n        },\n        logout: function () {\n            return $http.post('/api/user/logout', {\n                token_type_hint: \"access_token\",\n                token: $localStorage.access_token\n            })\n        },\n        getUserInfo: function () {\n            return $http.get('/api/user');\n        },\n        updateUser: function (data) {\n            return $http.put('/api/user', data)\n        },\n        resetPwd: function (mobile, pwd, code) {\n            return $http.post('/api/user/resetpassword', {\n                mobile: mobile,\n                pwd: pwd,\n                code: code\n            });\n        },\n        postCart: function (cart) {\n            var now = Date.now();\n            if (now - cartDate > timeSpan) {\n                clearTimeout(timer);\n                return $http.post('/api/user/shoppingcart', {shoppingCart: cart});\n            } else {\n                clearTimeout(timer);\n                timer = setTimeout(this.postCart.bind(this, cart), timeSpan + 100)\n            }\n            cartDate = now;\n            return {'catch': angular.noop}\n        },\n        applyInvitationCode: function (code) {\n            return $http.get('/api/user/coupon/invitation/' + code)\n        },\n        invitedFriends: function () {\n            return $http.get('/api/user/coupon/friends');\n        },\n\n        getWeixinUserInfo: function (id) {\n            return $http.get('/api/user/weixin/userinfo?userId=' + id);\n        }\n\n    }\n}]);\n\nangular.module('xw.models').factory('Address', [\"$http\", function ($http) {\n    return {\n        getList: function () {\n            return $http.get('/api/user/address')\n        },\n        addOne: function (address) {\n            return $http.post('/api/user/address',address)\n        },\n        update: function (address) {\n            return $http.put('/api/user/address' + '/' + address._id, address)\n        },\n        'delete': function (id) {\n            return $http.delete('/api/user/address/' + id)\n        },\n        range: function () {\n            return $http.get('/api/orders/delivery/range')\n        }\n    }\n}]);\n\nangular.module('xw.models').factory('Coupon', [\"$http\", function ($http) {\n    return {\n        getCouponInfo: function (code) {\n            return $http.get('/api/coupons/code/' + code);\n        },\n        exchangeCouponCode: function (code) {\n            return $http.get('/api/user/coupon/code/' + code);\n        }\n    }\n}]);\n\nangular.module('xw.models').factory('Alipay', [\"$http\", function ($http) {\n    return {\n        notify: function (id, isCharge) {\n            var url = isCharge ? '/api/orders/payment/alipay/notify/account'\n                : '/api/orders/payment/alipay/mobile';\n            return $http.post(url, {out_trade_no: id})\n        }\n    }\n}]);\n\nangular.module('xw.models').factory('Balance', [\"$http\", \"Debug\", function ($http, Debug) {\n    return {\n        balance: function () {\n            return $http.get('/api/user/account')\n        },\n        chargeByCode: function (code) {\n            return $http.post('/api/user/account/chargecode', {accountChargeCode: code});\n        },\n        chargeOnline: function (data) {\n            return $http.post('/api/user/account/details', data);\n        },\n        balanceRecords: function () {\n            return $http.get('/api/user/account/details?skip=0&limit=200')\n                .catch(Debug.promiseErrFn('获取余额记录失败'))\n        }\n    }\n}])","//generated by gulp errcode\nangular.module(\"xw.config\").constant(\"errCode\", function(){\nreturn {\n    user: {\n        // todo: 第二第三位的1 是什么意思, sms独立出来??\n        wrongMobile   : 1110,\n        wrongPassword : 1111,\n        alreadyExist  : 1112,\n        notFound      : 1113,\n\n        userIdWrong : 1150,\n        userGenderWrong : 1152,\n        userOldAddressWrong : 1155,\n\n        invitationSendCodeWrong : 1190,\n\n        addressIdWrong : 1210,\n        addressNotFound : 1212,\n\n        addressLatitudeWrong  : 1220,\n        addressLongitudeWrong : 1221,\n        addressCoordTypeWrong : 1222,\n\n        addressProvinceWrong     : 1225,\n        addressCityWrong         : 1226,\n        addressDistrictWrong     : 1227,\n        addressStreetWrong       : 1228,\n        addressStreetNumberWrong : 1229,\n        addressAddressWrong      : 1230,\n\n        addressContactPersonWrong : 1235,\n        addressMobileWrong        : 1236,\n        addressSortOrderWrong     : 1237,\n\n        addressNotDeliver     : 1270,\n\n        addressBaiduMapNotFoundError     : 1280,\n\n\n        shoppingCartNotArray     : 1500,\n        shoppingCartDishIdWrong     : 1502,\n        shoppingCartDishNumberWrong     : 1504,\n        shoppingCartSubDishIdWrong     : 1506,\n        shoppingCartSubDishNumberWrong     : 1508\n\n\n\n\n\n    },\n    order: {\n        notFound: 2010,\n\n        orderNumberWrong: 2010,\n        orderIdWrong: 2011,\n        warehouseIdWrong: 2012,\n\n        cookingTypeWrong: 2110,\n        clientFromWrong: 2112,\n\n        creditWrong: 2115,\n        freightWrong: 2117,\n        paymentWrong: 2119,\n        paymentUsedCashWrong: 2120,\n\n        deliveryDateCookWrong: 2122,\n        deliveryTimeCookWrong: 2124,\n        deliveryDateEatWrong: 2126,\n        deliveryTimeEatWrong: 2128,\n\n        dishListArrayWrong: 2130,\n        dishListDishNumberWrong: 2132,\n        dishListDishIdWrong: 2134,\n        dishListSubDishArrayWrong: 2136,\n        dishListSubDishNumberWrong: 2138,\n        dishListSubDishIdWrong: 2139,\n\n\n        addressLatitudeWrong  : 2140,\n        addressLongitudeWrong : 2142,\n\n        addressProvinceWrong     : 2144,\n        addressCityWrong         : 2145,\n        addressDistrictWrong     : 2146,\n        addressStreetWrong       : 2147,\n        addressStreetNumberWrong : 2148,\n        addressAddressWrong      : 2149,\n\n        addressContactPersonWrong : 2152,\n        addressMobileWrong        : 2154,\n\n        addressIdWrong : 2160,\n\n        userCommentWrong: 2180,\n\n        dishIdInvalid: 2190,\n        notOnlyDrink: 2192,\n        notOverTenDrinks: 2194,\n\n\n        orderStatusWrong: 2300,\n        orderPaymentStatusWrong: 2310\n\n\n\n\n    },\n    sms: {\n        wrongCode: 3110,\n        expired: 3111,\n        invalidCode: 3112,\n        wrongType: 3113,\n        tooManyTries: 3114,\n        sendFailed: 3115,\n        reachSendLimitation: 3116\n    },\n    dish: {\n        outOfStock: 4110\n    },\n    coupon: {\n\n        notStart: 5110,\n        expired: 5111,\n        used: 5112,\n        outOfCount: 5113,\n        notFound      : 5120,\n\n        couponIdWrong : 5210,\n        promotionCodeWrong : 5212\n    },\n\n    announcement: {\n        announcementIdWrong : 8110,\n        notFound: 8112\n    }\n};\n});\nangular.module('xw.config').factory('commonInterceptor', ['$localStorage', '$q', function($localStorage, $q) {\n    var noRedirectPath = [/^\\/mobile\\/$/, /^\\/mobile\\/login/, /^\\/mobile\\/cook/, /^\\/mobile\\/resetpwd$/];\n    var noRedirectAPI = ['/api/user', '/api/user/token', '/api/user/shoppingcart', '/api/user/address'];\n    var loginRedirectPath = ['/mobile/me', '/mobile/addresslist', '/mobile/orderaddress', '/mobile/orderlist',\n        '/mobile/invite', '/mobile/coupons', '/mobile/cook', '/mobile/balance', '/mobile/chargebalanceonline'];\n\n    return {\n        'request': function(config) {\n            if ($localStorage.access_token) {\n                config.headers.Authorization = 'Bearer ' + $localStorage.access_token;\n            }\n\n            return config;\n        },\n\n        'responseError': function(response) {\n            // do something on error\n            var redirectPath = '';\n            if (response.status == 401) {\n                // todo: redirect\n                console.log(401);\n                if (noRedirectPath.some(function (RE) {return RE.test(location.pathname)})) {\n                    if (noRedirectAPI.indexOf(response.config.url) != -1) {\n                        return $q.reject(response);\n                    }\n                }\n                if (loginRedirectPath.some(function(path){\n                        return location.pathname.indexOf(path) != -1\n                    })) {\n                    redirectPath = '?redirect=' + location.pathname\n                }\n                setTimeout(function () {\n                    // todo:\n                    location.replace('/mobile/login' + redirectPath);\n                }, 120);\n            }\n            return $q.reject(response);\n        }\n    };\n}]);\n\n\nangular.module('xw.config').config(['$httpProvider', '$compileProvider',\n    function($httpProvider, $compileProvider) {\n        // http interceptor\n        $httpProvider.defaults.headers.common.Accept = 'application/vnd.cook.v1+json';\n        $httpProvider.defaults.headers.common['Access-Control-Allow-Origin'] = 'http://m.xinweicook.com';\n        $httpProvider.defaults.headers.common['Accept-Language'] = navigator.language == 'zh-CN' ? 'zh-CN' : 'en-US';\n        $httpProvider.defaults.headers.common['Content-Type'] = 'application/json';\n\n        $httpProvider.interceptors.push('commonInterceptor');\n\n        // disable debug data for performance.\n        $compileProvider.debugInfoEnabled(false);\n    }\n]);\n\n\nangular.pick = function (obj) {\n    var keys = Array.prototype.slice.call(arguments, 1);\n    return keys.reduce(function (o, k) {\n        o[k] = obj[k];\n        return o;\n    }, {});\n};\n\nangular.sort = function sort (_array, compare) {\n    var array = _array.slice(0);\n    var tmp;\n    for (var l = array.length - 1; l >= 1; l--) {\n        for (var i = 0; i < l; i++) {\n            var result = compare(array[i], array[i + 1]);\n            if (result > 0) {\n                tmp = array[i];\n                array[i] = array[i + 1];\n                array[i + 1] = tmp;\n            }\n        }\n    }\n    return array;\n};\n"],"sourceRoot":"/source/"}