angular.module("xw",["xw.config","xw.services","xw.controllers","xw.directives","xw.filters"]),angular.module("xw.config",["ngStorage"]),angular.module("xw.models",["ngStorage"]),angular.module("xw.controllers",["xw.models","xw.weixin"]),angular.module("xw.directives",["xw.models"]),angular.module("xw.filters",[]),angular.module("xw.weixin",[]),angular.module("xw.services",[]);
angular.module("xw.directives").directive("addDishBar",["Debug","User","$localStorage","$filter","Utils",function(r,e,a,t,i){return{scope:{dish:"=",user:"="},templateUrl:"add-dish-bar.html",link:function(r){var n=r.storage=a;n.localBag=n.localBag||[];var o=r.$watch("user",function(e){e&&(o(),n.localBag=i.mergeCarts(n.localBag||[],e.shoppingCart),r.totalPrice())});r.$watch("dish",function(e){if(e){var a={};r.dish.preferences.forEach(function(r){r.foodMaterial.some(function(e){return e.dish.outOfStock?!1:(a[r.name.zh]=e.dish,!0)})}),r.dish.curSelection=a}}),r.addToCart=function(a){var t,o=a.curSelection,u={dish:a,number:a.count,subDish:Object.keys(o).map(function(r){return{dish:o[r],number:a.count}})};n.localBag.some(function(r){return i.isSameItemInCart(r,u)?(t=r,t.number+=u.number,t.subDish.forEach(function(r){r.number=t.number}),!0):void 0}),t||n.localBag.push(u),a.count=0,r.hide(),e.postCart(n.localBag.map(c)),r.totalPrice()};var c=t("postDish");r.totalPrice=function(){var r=n.localBag.reduce(function e(r,a){return r+=a.dish.priceOriginal*a.number,a.subDish&&(r+=a.subDish.reduce(e,0)),r},0);return n.localBag.price=r},r.totalPrice(),r.hide=function(){r.dish=null}}}}]);
angular.module("xw.directives").directive("autoFocus",function(){return{restrict:"A",link:function(t,i){setTimeout(function(){i[0].focus()},100)}}});
angular.module("xw.directives").directive("backButton",function(){return{template:'<div class="back-icon" ng-click="back()"></div>',link:function(i){i.back=function(){history.length<=1&&(location.href="/mobile/"),history.back()}}}});
angular.module("xw.directives").directive("couponCode",["Coupon","$q",function(e,n){return{restrict:"A",scope:{couponPrice:"=couponCode"},require:"?ngModel",link:function(o,t,r,c){c&&(c.$asyncValidators.couponCode=function(t,r){var c=t||r;return c?(c=8==c.length?"zz"+c:c,e.getCouponInfo(c).then(function(e){var t=e.data,r=new Date(e.headers("date")),c=new Date(t.startDate),a=new Date(t.endDate);return r>=c&&a>=r?void(o.couponPrice=t.price):n.reject("未在可使用期限内")})):n.resolve(1)})}}}]);
angular.module("xw.directives").directive("geetestSmsButton",["Debug","User","$interval","$window","Alert","$http",function(e,t,s,a,n,i){return{scope:{valid:"@",mobile:"@",type:"@"},templateUrl:"geetest-sms-button.html",link:function(e){function c(t,s){var a=e.state,n=!!s;"mobile"==t?0===a&&n?e.state=1:1!=a||n?2!=a||n?4==a&&n?e.state=5:5!=a||n||(e.state=4):e.state=4:e.state=0:"show-geetest"==t?(1==a||5==a)&&(e.state=2):"hide-geetest"==t?2==a&&(e.state=3):"show-refetch"==t&&3==a&&(e.state=n?5:4)}i.get("/api/user/signup/geetest/register").success(function(i){var l=document.createElement("script"),u={gt:"d41d16df5b99010ec511ec10aaaafcb8",width:document.body.offsetWidth,challenge:i.challenge};l.src="http://api.geetest.com/get.php?"+Object.keys(u).map(function(e){return e+"="+u[e]}).join("&");var r=angular.element(document.getElementById("geetestContainer"));r.append(l),a.gt_custom_ajax=function(a,i,l){if(a){var u=angular.element(document.getElementById("geetestContainer")).find("input"),r={geetest_challenge:u[0].value,geetest_validate:u[1].value,geetest_seccode:u[2].value,type:e.type,mobile:e.mobile},g=s(function(){if(!--e.remains){s.cancel(g),e.remains=o,c("show-refetch","true"==e.valid);try{GeeTest[0].refresh()}catch(t){}}},1e3);t.getSmsCode(r).success(function(){console.log("success")})["catch"](function(e){n.show(e.data.validationStatus,"验证码发送失败")}),c("hide-geetest")}}});var o=30;e.remains=30,e.$watch("mobile",function(t){c("mobile","true"==e.valid)}),e.showGeetest=function(){c("show-geetest")},e.state=0}}}]);
angular.module("xw.directives").directive("imgLazyLoad",["$window","$document","$timeout",function(o,e,n){function t(o){for(var e=o.offsetTop;o=o.offsetParent;)e+=o.offsetTop;return e}function r(){return c.documentElement.clientHeight+(o.scrollY||c.documentElement.scrollTop||c.body.scrollTop)}var i,l=[],c=e[0];return r.ok=!0,angular.element(o).on("scroll",function(){i=r();for(var o,e=0;e<l.length;)t(l[e][0])<i?(o=angular.element(l[e][0]),o[0].src=l[e][1].$eval(o.attr("img-lazy-load")),l.splice(e,1)):e++}),{restrict:"A",link:function(o,e,n){var c=e[0];l.push([c,o]);var a=o.$watch(n.imgLazyLoad,function(o){o&&(a(),r.ok&&(i=r(),r.ok=!1,setTimeout(function(){r.ok=!0},120)),t(c)<i&&l.some(function(e,n){return e[0]==c?(c.src=o,l.splice(n,1),!0):void 0}))});o._lazyDestroyBinded||(o._lazyDestroyBinded=!0,o.$on("$destroy",function(){for(var e=0;e<l.length;)l[e][1]==o?l.splice(e,1):e++}))}}}]);
angular.module("xw.directives").directive("shoppingProgressBar",function(){return{templateUrl:"shopping-progress-bar.html",scope:!0,link:function(e){var t=location.pathname;"/mobile/cart"==t?e.state="state1":"/mobile/orderaddress"==t?e.state="state2":"/mobile/orderpay"==t&&(e.state="state3")}}});
angular.module("xw.directives").directive("smsButton",["Debug","User","$interval",function(t,e,n){return{scope:{valid:"@",mobile:"@",type:"@"},templateUrl:"sms-button.html",link:function(a){function i(){return a.$watch("mobile",function(t){0===a.state&&t&&11==t.length?a.state=1:1!==a.state||t&&11==t.length?3===a.state&&t&&11==t.length?a.state=4:4!==a.state||t&&11==t.length||(a.state=3):a.state=0})}a.state=0,a.remains=60;var s=i();a.getSmsCode=function(){a.state=2,s&&(s(),s=null);var l=n(function(){--a.remains||(n.cancel(l),a.remains=60,t.assert("string"==typeof a.valid,"由@传入的valid应当是string"),a.state="true"===a.valid?4:3,s=i())},1e3);e.getSmsCode({mobile:a.mobile,type:a.type}).then(function(t){t.data.code})["catch"](function(e){alert("获取验证码失败,请稍后重试"),t.alert(e)})}}}}]);
angular.module("xw.services").constant("Address",[{Name:"天津",City:[{Name:"天津",Region:[{Name:"和平"},{Name:"东丽"},{Name:"西青"},{Name:"津南"},{Name:"北辰"},{Name:"河东"},{Name:"宁河"},{Name:"武清"},{Name:"静海"},{Name:"宝坻"},{Name:"蓟县"},{Name:"河西"},{Name:"南开"},{Name:"河北"},{Name:"红桥"},{Name:"滨海新区"}]}]},{Name:"辽宁",City:[{Name:"大连",Region:[{Name:"中山区"},{Name:"西岗区"},{Name:"沙河口区"},{Name:"甘井子区"},{Name:"旅顺口区"},{Name:"金州区"},{Name:"长海县"},{Name:"瓦房店市"},{Name:"普兰店市"},{Name:"庄河市"}]}]},{Name:"上海",City:[{Name:"上海",Region:[{Name:"黄浦"},{Name:"杨浦"},{Name:"闵行"},{Name:"宝山"},{Name:"嘉定"},{Name:"浦东新区"},{Name:"金山"},{Name:"松江"},{Name:"奉贤"},{Name:"青浦"},{Name:"卢湾"},{Name:"徐汇"},{Name:"长宁"},{Name:"静安"},{Name:"普陀"},{Name:"闸北"},{Name:"虹口"}]}]},{Name:"江苏",City:[{Name:"南京",Region:[{Name:"玄武区"},{Name:"白下区"},{Name:"秦淮区"},{Name:"建邺区"},{Name:"鼓楼区"},{Name:"下关区"},{Name:"浦口区"},{Name:"栖霞区"},{Name:"雨花台区"},{Name:"江宁区"},{Name:"六合区"},{Name:"溧水县"},{Name:"高淳县"}]},{Name:"扬州",Region:[{Name:"广陵区"},{Name:"邗江区"},{Name:"维扬区"},{Name:"宝应县"},{Name:"仪征市"},{Name:"高邮市"},{Name:"江都市"}]},{Name:"镇江",Region:[{Name:"京口区"},{Name:"润州区"},{Name:"丹徒区"},{Name:"丹阳市"},{Name:"扬中市"},{Name:"句容市"}]},{Name:"泰州",Region:[{Name:"海陵区"},{Name:"高港区"},{Name:"兴化市"},{Name:"靖江市"},{Name:"泰兴市"},{Name:"姜堰市"}]},{Name:"宿迁",Region:[{Name:"宿城区"},{Name:"宿豫区"},{Name:"沭阳县"},{Name:"泗阳县"},{Name:"泗洪县"}]},{Name:"无锡",Region:[{Name:"崇安区"},{Name:"南长区"},{Name:"北塘区"},{Name:"锡山区"},{Name:"惠山区"},{Name:"滨湖区"},{Name:"江阴市"},{Name:"宜兴市"}]},{Name:"徐州",Region:[{Name:"鼓楼区"},{Name:"云龙区"},{Name:"九里区"},{Name:"贾汪区"},{Name:"泉山区"},{Name:"丰县"},{Name:"沛县"},{Name:"铜山县"},{Name:"睢宁县"},{Name:"新沂市"},{Name:"邳州市"}]},{Name:"常州",Region:[{Name:"天宁区"},{Name:"钟楼区"},{Name:"戚墅堰区"},{Name:"新北区"},{Name:"武进区"},{Name:"溧阳市"},{Name:"金坛市"}]},{Name:"苏州",Region:[{Name:"沧浪区"},{Name:"平江区"},{Name:"金阊区"},{Name:"虎丘区"},{Name:"吴中区"},{Name:"相城区"},{Name:"常熟市"},{Name:"张家港市"},{Name:"昆山市"},{Name:"吴江市"},{Name:"太仓市"}]},{Name:"南通",Region:[{Name:"崇川区"},{Name:"港闸区"},{Name:"海安县"},{Name:"如东县"},{Name:"启东市"},{Name:"如皋市"},{Name:"通州市"},{Name:"海门市"}]},{Name:"连云港",Region:[{Name:"连云区"},{Name:"新浦区"},{Name:"海州区"},{Name:"赣榆县"},{Name:"东海县"},{Name:"灌云县"},{Name:"灌南县"}]},{Name:"淮安",Region:[{Name:"清河区"},{Name:"楚州区"},{Name:"淮阴区"},{Name:"清浦区"},{Name:"涟水县"},{Name:"洪泽县"},{Name:"盱眙县"},{Name:"金湖县"}]},{Name:"盐城",Region:[{Name:"亭湖区"},{Name:"盐都区"},{Name:"响水县"},{Name:"滨海县"},{Name:"阜宁县"},{Name:"射阳县"},{Name:"建湖县"},{Name:"东台市"},{Name:"大丰市"}]}]},{Name:"浙江",City:[{Name:"杭州",Region:[{Name:"上城区"},{Name:"下城区"},{Name:"江干区"},{Name:"拱墅区"},{Name:"西湖区"},{Name:"滨江区"},{Name:"萧山区"},{Name:"余杭区"},{Name:"桐庐县"},{Name:"淳安县"},{Name:"建德市"},{Name:"富阳市"},{Name:"临安市"}]},{Name:"台州",Region:[{Name:"椒江区"},{Name:"黄岩区"},{Name:"路桥区"},{Name:"玉环县"},{Name:"三门县"},{Name:"天台县"},{Name:"仙居县"},{Name:"温岭市"},{Name:"临海市"}]},{Name:"丽水",Region:[{Name:"莲都区"},{Name:"青田县"},{Name:"缙云县"},{Name:"遂昌县"},{Name:"松阳县"},{Name:"云和县"},{Name:"庆元县"},{Name:"景宁畲族自治县"},{Name:"龙泉市"}]},{Name:"宁波",Region:[{Name:"海曙区"},{Name:"江东区"},{Name:"江北区"},{Name:"北仑区"},{Name:"镇海区"},{Name:"鄞州区"},{Name:"象山县"},{Name:"宁海县"},{Name:"余姚市"},{Name:"慈溪市"},{Name:"奉化市"}]},{Name:"温州",Region:[{Name:"鹿城区"},{Name:"龙湾区"},{Name:"瓯海区"},{Name:"洞头县"},{Name:"永嘉县"},{Name:"平阳县"},{Name:"苍南县"},{Name:"文成县"},{Name:"泰顺县"},{Name:"瑞安市"},{Name:"乐清市"}]},{Name:"嘉兴",Region:[{Name:"南湖区"},{Name:"秀洲区"},{Name:"嘉善县"},{Name:"海盐县"},{Name:"海宁市"},{Name:"平湖市"},{Name:"桐乡市"}]},{Name:"湖州",Region:[{Name:"吴兴区"},{Name:"南浔区"},{Name:"德清县"},{Name:"长兴县"},{Name:"安吉县"}]},{Name:"绍兴",Region:[{Name:"越城区"},{Name:"绍兴县"},{Name:"新昌县"},{Name:"诸暨市"},{Name:"上虞市"},{Name:"嵊州市"}]},{Name:"金华",Region:[{Name:"婺城区"},{Name:"金东区"},{Name:"武义县"},{Name:"浦江县"},{Name:"磐安县"},{Name:"兰溪市"},{Name:"义乌市"},{Name:"东阳市"},{Name:"永康市"}]},{Name:"衢州",Region:[{Name:"柯城区"},{Name:"衢江区"},{Name:"常山县"},{Name:"开化县"},{Name:"龙游县"},{Name:"江山市"}]},{Name:"舟山",Region:[{Name:"定海区"},{Name:"普陀区"},{Name:"岱山县"},{Name:"嵊泗县"}]}]},{Name:"安徽",City:[{Name:"合肥",Region:[{Name:"瑶海区"},{Name:"庐阳区"},{Name:"蜀山区"},{Name:"包河区"},{Name:"长丰县"},{Name:"肥东县"},{Name:"肥西县"}]},{Name:"黄山",Region:[{Name:"屯溪区"},{Name:"黄山区"},{Name:"徽州区"},{Name:"歙县"},{Name:"休宁县"},{Name:"黟县"},{Name:"祁门县"}]},{Name:"滁州",Region:[{Name:"琅琊区"},{Name:"南谯区"},{Name:"来安县"},{Name:"全椒县"},{Name:"定远县"},{Name:"凤阳县"},{Name:"天长市"},{Name:"明光市"}]},{Name:"阜阳",Region:[{Name:"颍州区"},{Name:"颍东区"},{Name:"颍泉区"},{Name:"临泉县"},{Name:"太和县"},{Name:"阜南县"},{Name:"颍上县"},{Name:"界首市"}]},{Name:"宿州",Region:[{Name:"埇桥区"},{Name:"砀山县"},{Name:"萧县"},{Name:"灵璧县"},{Name:"泗县"}]},{Name:"巢湖",Region:[{Name:"居巢区"},{Name:"庐江县"},{Name:"无为县"},{Name:"含山县"},{Name:"和县"}]},{Name:"六安",Region:[{Name:"金安区"},{Name:"裕安区"},{Name:"寿县"},{Name:"霍邱县"},{Name:"舒城县"},{Name:"金寨县"},{Name:"霍山县"}]},{Name:"亳州",Region:[{Name:"谯城区"},{Name:"涡阳县"},{Name:"蒙城县"},{Name:"利辛县"}]},{Name:"池州",Region:[{Name:"贵池区"},{Name:"东至县"},{Name:"石台县"},{Name:"青阳县"}]},{Name:"宣城",Region:[{Name:"宣州区"},{Name:"郎溪县"},{Name:"广德县"},{Name:"泾县"},{Name:"绩溪县"},{Name:"旌德县"},{Name:"宁国市"}]},{Name:"芜湖",Region:[{Name:"镜湖区"},{Name:"弋江区"},{Name:"鸠江区"},{Name:"三山区"},{Name:"芜湖县"},{Name:"繁昌县"},{Name:"南陵县"}]},{Name:"蚌埠",Region:[{Name:"龙子湖区"},{Name:"蚌山区"},{Name:"禹会区"},{Name:"淮上区"},{Name:"怀远县"},{Name:"五河县"},{Name:"固镇县"}]},{Name:"淮南",Region:[{Name:"大通区"},{Name:"田家庵区"},{Name:"谢家集区"},{Name:"八公山区"},{Name:"潘集区"},{Name:"凤台县"}]},{Name:"马鞍山",Region:[{Name:"金家庄区"},{Name:"花山区"},{Name:"雨山区"},{Name:"当涂县"}]},{Name:"淮北",Region:[{Name:"杜集区"},{Name:"相山区"},{Name:"烈山区"},{Name:"濉溪县"}]},{Name:"铜陵",Region:[{Name:"铜官山区"},{Name:"狮子山区"},{Name:"郊区"},{Name:"铜陵县"}]},{Name:"安庆",Region:[{Name:"迎江区"},{Name:"大观区"},{Name:"宜秀区"},{Name:"怀宁县"},{Name:"枞阳县"},{Name:"潜山县"},{Name:"太湖县"},{Name:"宿松县"},{Name:"望江县"},{Name:"岳西县"},{Name:"桐城市"}]}]},{Name:"福建",City:[{Name:"福州",Region:[{Name:"鼓楼区"},{Name:"台江区"},{Name:"仓山区"},{Name:"马尾区"},{Name:"晋安区"},{Name:"闽侯县"},{Name:"连江县"},{Name:"罗源县"},{Name:"闽清县"},{Name:"永泰县"},{Name:"平潭县"},{Name:"福清市"},{Name:"长乐市"}]},{Name:"厦门",Region:[{Name:"思明区"},{Name:"海沧区"},{Name:"湖里区"},{Name:"集美区"},{Name:"同安区"},{Name:"翔安区"}]}]},{Name:"山东",City:[{Name:"济南",Region:[{Name:"历下区"},{Name:"市中区"},{Name:"槐荫区"},{Name:"天桥区"},{Name:"历城区"},{Name:"长清区"},{Name:"平阴县"},{Name:"济阳县"},{Name:"商河县"},{Name:"章丘市"}]},{Name:"青岛",Region:[{Name:"市南区"},{Name:"市北区"},{Name:"四方区"},{Name:"黄岛区"},{Name:"崂山区"},{Name:"李沧区"},{Name:"城阳区"},{Name:"胶州市"},{Name:"即墨市"},{Name:"平度市"},{Name:"胶南市"},{Name:"莱西市"}]}]},{Name:"湖北",City:[{Name:"武汉",Region:[{Name:"江岸区"},{Name:"江汉区"},{Name:"硚口区"},{Name:"汉阳区"},{Name:"武昌区"},{Name:"青山区"},{Name:"洪山区"},{Name:"东西湖区"},{Name:"汉南区"},{Name:"蔡甸区"},{Name:"江夏区"},{Name:"黄陂区"},{Name:"新洲区"}]}]},{Name:"广东",City:[{Name:"广州",Region:[{Name:"荔湾区"},{Name:"越秀区"},{Name:"海珠区"},{Name:"天河区"},{Name:"白云区"},{Name:"黄埔区"},{Name:"番禺区"},{Name:"花都区"},{Name:"南沙区"},{Name:"萝岗区"},{Name:"增城市"},{Name:"从化市"}]},{Name:"东莞",Region:[{Name:"东莞市"}]},{Name:"深圳",Region:[{Name:"罗湖区"},{Name:"福田区"},{Name:"南山区"},{Name:"宝安区"},{Name:"龙岗区"},{Name:"盐田区"}]},{Name:"珠海",Region:[{Name:"香洲区"},{Name:"斗门区"},{Name:"金湾区"}]},{Name:"汕头",Region:[{Name:"龙湖区"},{Name:"金平区"},{Name:"濠江区"},{Name:"潮阳区"},{Name:"潮南区"},{Name:"澄海区"},{Name:"南澳县"}]},{Name:"佛山",Region:[{Name:"禅城区"},{Name:"南海区"},{Name:"顺德区"},{Name:"三水区"},{Name:"高明区"}]}]},{Name:"四川",City:[{Name:"成都",Region:[{Name:"锦江区"},{Name:"青羊区"},{Name:"金牛区"},{Name:"武侯区"},{Name:"成华区"},{Name:"龙泉驿区"},{Name:"青白江区"},{Name:"新都区"},{Name:"温江区"},{Name:"金堂县"},{Name:"双流县"},{Name:"郫县"},{Name:"大邑县"},{Name:"蒲江县"},{Name:"新津县"},{Name:"都江堰市"},{Name:"彭州市"},{Name:"邛崃市"},{Name:"崇州市"}]}]}]);
angular.module("xw.services").factory("Alert",function(){var r={1110:"手机号码或密码错误",1111:"手机号码或密码错误",1112:"该用户已存在",1113:"手机号码或密码错误",2110:"手机号码错误",3110:"短信码错误",3111:"短信码已过期",3112:"无效的短信码",3113:"错误的短信码类型",3114:"短信码验证次数过多, 请重新接收短信码",3115:"发送失败, 请稍后重试",3116:"短信码发送次数达到当日最大次数",4110:"库存不足",5110:"尚未到充值码使用时间",5111:"优惠码/优惠券已过期",5112:"优惠码/优惠券已被使用",5113:"超出优惠码/优惠券最大使用次数"};return{show:function(e,n){var t=r[e];t?alert(t):n&&alert(n)},message:function(e){return r[e]||""}}});
angular.module("xw.services").provider("Debug",function(){var e=this;e.debugKey="debug",this.$get=function(){var t=new RegExp("\\b"+e.debugKey+"\\b");t=t.test(location.search)||!!sessionStorage.getItem("debug"),t&&!sessionStorage.getItem("debug")&&sessionStorage.setItem("debug","true");var r={isDebug:t,alert:function(e){this.isDebug&&(console.log(e),e="[object Object]"==Object.prototype.toString.call(e)?JSON.stringify(e):e,alert(e))},assert:function(e,t){this.isDebug&&!e&&alert(t)},promiseErrFn:function(e){return function(t){r.alert(e),r.alert(t)}}};return r}});
angular.module("xw.services").factory("Map",["$http","Debug",function(n,e){var t={xinweioffice:6e3,caohejing1:1560},a={bentoNoReach:999999,topDistance:{xinweioffice:6e3,caohejing1:1560},suggestion:function(e,t){return n.get("/mobile/placesuggestion?query="+e+"&region="+t)},gcj02ToBd09:function(n){var e=n.lat,t=n.lng,a=Math.sqrt(t*t+e*e)+2e-5*Math.sin(e*Math.PI),i=Math.atan2(e,t)-3e-6*Math.cos(t*Math.PI);return{lng:a*Math.cos(i)+.0065,lat:a*Math.sin(i)+.006}},bd09ToGcj02:function(n){var e=n.lat-.006,t=n.lng-.0065,a=Math.sqrt(t*t+e*e)-2e-5*Math.sin(e*Math.PI),i=Math.atan2(e,t)-3e-6*Math.cos(t*Math.PI);return{lng:a*Math.cos(i),lat:a*Math.sin(i)}},lineDistance:function(n,e,t,a){var i=6371e3,r=Math.cos(n*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.cos((e-a)*Math.PI/180),o=Math.sin(n*Math.PI/180)*Math.sin(t*Math.PI/180),s=r+o;s>1&&(s=1),-1>s&&(s=-1);var c=Math.acos(s);return c*i},lineDistance2CHJ:function(n,e){var t=this.warehouseCoords.caohejing1;return this.lineDistance(n,e,t.lat,t.lng)},fixZero:function(n,e,t){if(0!==n)return n;var a=this.lineDistance(e,t,31.189426,121.460625);return a>1500?999999:n},walkingDistance:function(e,a,i){var r;i=i||"",Array.isArray(arguments[0])?(r=arguments[0],i=a):r=[{lat:e,lng:a}];var o="";return r.forEach(function(n,e){if(!(e>=5)){var t=0==e?"":"|";o+="string"==typeof n?t+n:t+n.lat+","+n.lng}}),n.get("/mobile/distance?destinations="+encodeURIComponent(o)+"&warehouse="+i).then(function(n){for(var e,a=n.data.result.elements,i=[],r=a.length/2,o=0;r>o;o++)a[o].warehouse="xinweioffice",a[r+o].warehouse="caohejing1",e=[a[o],a[r+o]],e=angular.sort(e,function(n,e){return n.distance.value-t.xinweioffice-(e.distance.value-t.caohejing1)}),i.push(e);return i})["catch"](function(){return console.log("get distance error"),[]})},distance:function(n,i,r){return this.walkingDistance(n,i,r).then(function(e){var r=e[0][0].distance.value;r=a.fixZero(r,n,i);var o=t[e[0][0].warehouse];return{distance:r,isInRange:o>=(null===r?999999:r),warehouse:e[0][0].warehouse}})["catch"](function(n){e.alert("获取步行距离失败"),e.alert(n)})},distances:function(n,e){return n=Array.isArray(n)?n:[n],this.walkingDistance(n,e).then(function(e){return e.map(function(e,i){var r=a.fixZero(e[0].distance.value,n[i].lat,n[i].lng),o=t[e[0].warehouse];return{distance:r,isInRange:o>=(null===r?999999:r),warehouse:e[0].warehouse}})})},nearestWarehouse:function(n,e){var a=this,i=t.xinweioffice,r=t.caohejing1,o=angular.sort(["xinweioffice","caohejing1"].map(function(t){var i=a.warehouseCoords[t];return{name:t,distance:a.lineDistance(n,e,i.lat,i.lng)}}),function(n,e){return n.distance-i+1100-(e.distance-r)});return o[0].name},warehouseCoords:{xinweioffice:{lat:31.189426,lng:121.460625},caohejing1:{lat:31.16925,lng:121.398949}}};return a}]);
angular.module("xw.services").factory("ScopeDecorator",["$location",function(o){return{common:function(o){o&&(o.back=function(){history.length>1?history.back():location.href="/mobile/"})},nav:function(n){n&&n.$on("$locationChangeStart",function(){n.path=o.path()})}}}]);
angular.module("xw.services").factory("Utils",["$localStorage",function(e){return{utf2b64:function(e){return btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")},b642utf:function(e){return decodeURIComponent(escape(window.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))},isSameItemInCart:function(e,n){return e.dish._id==n.dish._id&&e.subDish.every(function(e){return n.subDish.some(function(n){return e.dish._id==n.dish._id})})&&e.subDish.length==n.subDish.length},mergeCarts:function(e,n){if(!e||!e.length)return n;for(var t=this,r=0;r<n.length;r++){var i=e.every(function(e){return!t.isSameItemInCart(e,n[r])});i&&e.push(n[r])}return e},getStockId:function(e,n){var t={};return e.forEach("preference"==n?function(e){e.preferences.forEach(function(e){e.foodMaterial.forEach(function(e){!t[e.dish._id]&&e.dish.isPublished&&(t[e.dish._id]=!0)})})}:function(e){t[e._id]||e.outOfStock||(t[e._id]=!0)}),Object.keys(t)},cleanLocalStorage:function(){var n=["localBag","promotion"];Object.keys(e).forEach(function(t){-1==n.indexOf(t)&&"$"!=t[0]&&delete e[t]})}}}]);
angular.module("xw.weixin").factory("Weixin",["$http","Debug",function(e,n){var t={wx:{appId:"wx37a1323e488cef84",jsApiList:["getLocation","onMenuShareTimeline","onMenuShareAppMessage"]},location:{longitude:121.460625,latitude:31.189426},ak:"xnKgWtGYXf4gkLgreox7xpjI",oauthUrl:"/api/orders/payment/weixinpay/oauthcode?orderid="};return{isWeixin:/MicroMessenger/i.test(navigator.userAgent),oauthUrl:t.oauthUrl,readyState:!1,ready:function(e){this.readyState?e():this.ready.cb=e},config:function(e){var n=this,a=angular.copy(t.wx);a.timestamp=e.timestamp,a.nonceStr=e.nonceStr,a.signature=e.signature,wx.config(a),wx.ready(function(){n.ready.cb&&n.ready.cb(),n.readyState=!0})},getLocation:function(e,n){var t={type:"gcj02"};e&&(t.success=e),n&&(t.fail=n),wx.getLocation(t)},shareTimeline:function(e){wx.onMenuShareTimeline(e)},shareAppMessage:function(e){wx.onMenuShareAppMessage(e)},showOptionMenu:function(){wx.showOptionMenu()},hideOptionMenu:function(){wx.hideOptionMenu()},getLocationName:function(n,a){var o="http://api.map.baidu.com/geocoder/v2/?output=json&pois=1&coordtype=gcj02ll&callback=JSON_CALLBACK";return e.jsonp(o,{params:{ak:t.ak,location:n+","+a}})},getJsconfig:function(){return e.post("/api/orders/payment/weixinpay/config",{url:location.href.substr(0,location.href.length-location.hash.length)})}}}]);
angular.module("xw.filters").filter("adapt",function(){var r=Math.floor(document.body.offsetWidth*window.devicePixelRatio),e=Math.floor(2*r/3),n="?imageView2/1/w/",t=n+r+"/h/"+e;return function(e,i){return e+(i?n+r+"/h/"+Math.floor(r*i):t)}}),angular.module("xw.filters").filter("fraction",function(){function r(r,e){for(var n="",t=0;t<r.length;t++)n+=e[r[t]];return n}var e=["⁰","¹","²","³","⁴","⁵","⁶","⁷","⁸","⁹"],n=["₀","₁","₂","₃","₄","₅","₆","₇","₈","₉"];return function(t){return t.replace(/(\d+)\/(\d+)/g,function(t,i,u){return r(i,e)+"⁄"+r(u,n)+" "})}}),angular.module("xw.filters").filter("postDish",function(){return function(r){return{dish:r.dish._id,number:r.number,subDish:r.subDish?r.subDish.map(function(r){return{dish:r.dish._id,number:r.number}}):[]}}}),angular.module("xw.filters").filter("beautifyMobile",function(){return function(r){return/^\d{11}$/.test(r)?r.replace(/^(\d{3})(\d{4})(\d{4})$/,function(r,e,n,t){return e+" "+n+" "+t}):r}}),angular.module("xw.filters").filter("subDishTitle",function(){return function(r){var e=r.subDish.length;return e?"("+r.subDish.reduce(function(r,n,t){return r+n.dish.title.zh+(t==e-1?"":"/")},"")+")":""}}),angular.module("xw.filters").filter("orderTime",function(){return function r(e,n){var t;return"eat"==n?{deliveryDateEat:e.hour.substr(0,10),deliveryTimeEat:e.hour.substr(11,5)}:"cook"==n?(t={deliveryDateCook:e.day.day},t.deliveryTimeCook=e.time?e.time.name+":00":"12:00",t):"all"==n?(t={},e.eat&&(t=r(e.eat,"eat")),e.cook&&angular.extend(t,r(e.cook,"cook")),t):void 0}}),angular.module("xw.filters").filter("dishes",function(){return function(r,e,n){var t;return"order"==e&&"displayCart"==n?(t=[],Object.keys(r).forEach(function(e){r[e].forEach(function(r){t.push({dish:r.dish._id,number:r.number,subDish:r.subDish.map(function(r){return{dish:r.dish._id,number:r.number}})})})}),{dishList:t}):r}}),angular.module("xw.filters").filter("coupon",function(){return function(r){var e={};return r.code&&(e.promotionCode=r.code,8==r.code.length&&(e.promotionCode="zz"+e.promotionCode)),r.card&&(e.coupon=r.card._id),e}}),angular.module("xw.filters").filter("eatTimeOptions",function(){return function(r){return r&&r.length?(r.unshift({hour:"请选择配送时间"}),r):r}}),angular.module("xw.filters").filter("eatTimeDisplay",function(){return function(r){return"请选择配送时间"!=r.hour?r.hour+" 送达":r.hour}}),angular.module("xw.filters").filter("cookTimeOptions",function(){return function(r){return r&&r.length?(r.unshift({day:"请选择配送时间"}),r):r}}),angular.module("xw.filters").filter("cookTimeDisplay",function(){return function(r){return"请选择配送时间"==r.day||r.segment?r.day:r.day+" 送达"}}),angular.module("xw.filters").filter("dishPrice",function(){return function(r,e){var n=r.dish.priceOriginal;if(r.subDish)for(var t=0,i=r.subDish.length;i>t;t++)n+=r.subDish[t].dish.priceOriginal;return n*(e?r.number:1)}});
angular.module("xw.directives").run(["$templateCache",function(s){s.put("add-dish-bar.html",'<div class="selection-cover" ng-cloak ng-if="dish" ng-click="hide()"></div><div class="selections-container" ng-if="dish" ng-cloak><div class="block"><h4 class="text-center">{{dish.title.zh}}<span ng-click="hide()" class="button close-button"></span></h4><ul class="properties" ng-if="dish.preferences.length"><li ng-repeat="property in dish.preferences track by property._id"><h5>{{property.name.zh}}</h5><ul class="selections"><li ng-repeat="selection in property.foodMaterial track by selection._id" ng-click="(!selection.dish.outOfStock && selection.dish.isPublished) && (dish.curSelection[property.name.zh] = selection.dish)" ng-class="{\'no-stock\': (selection.dish.outOfStock || !selection.dish.isPublished), selected: dish.curSelection[property.name.zh] == selection.dish}">{{selection.dish.title.zh}}</li></ul></li></ul><div class="counter-wrapper"><i>份数</i><div class="counter text-center"><span ng-click="dish.count>0 && (dish.count=dish.count-1)" class="minus">-</span> <span class="number">{{dish.count}}</span> <span ng-click="dish.count=dish.count+1" class="add">+</span></div></div><div class="add-to-cart-button text-center" ng-class="{invalid: dish.count == 0}" ng-click="dish.count>0 && addToCart(dish)">加入购物袋</div></div></div>'),s.put("geetest-sms-button.html",'<div class="geetest-sms-button-group"><div id="geetestContainer" ng-show="state==2"></div><span class="geetest-sms-button" ng-if="state <= 1" ng-class="{invalid: state === 0}" ng-click="state == 1 && showGeetest()">获取验证码</span> <span class="geetest-sms-button invalid" ng-if="state == 3">发送成功 {{remains}}</span> <span ng-click="state == 5 && showGeetest()" class="geetest-sms-button" ng-class="{invalid: state == 4}" ng-if="state > 3">重新获取</span></div>'),s.put("shopping-progress-bar.html",'<div class="shopping-progress-bar"><div class="states"><span ng-class="{cur: state == \'state1\'}" class="state1">筛选购物袋</span> <span ng-class="{cur: state == \'state2\'}" class="state2">确认送货地址</span> <span ng-class="{cur: state == \'state3\'}" class="state3">支付</span></div><div class="state-bar-container"><div class="indicator" ng-class="state"></div></div></div>'),s.put("sms-button.html",'<div class="sms-button-group"><span class="sms-button" ng-if="state <= 1" ng-class="{invalid: state === 0}" ng-click="state == 1 && getSmsCode()">获取验证码</span> <span class="sms-button invalid" ng-if="state == 2">{{remains}}秒后重新获取</span> <span ng-click="state == 4 && getSmsCode()" class="sms-button" ng-class="{invalid: state == 3}" ng-if="state > 2">重新获取</span></div>')}]);
angular.module("xw.models").factory("Dishes",["$http",function(e){return{getList:function(t,n){return t=t||"",n=n||"",e.get("/api/dishes?showForWarehouse="+t+"&cookingType="+n)},like:function(t){return e.put("/api/dishes/"+t+"/like")},getOne:function(t){return e.get("/api/dishes/"+t)}}}]),angular.module("xw.models").factory("Orders",["$http",function(e){return{postOrder:function(t){return e.post("/api/orders",t)},deliveryTime:function(t){return e.post("/api/orders/delivery/time",t)},deliveryEatTime:function(t){return e.post("/api/orders/delivery/time/eat/warehouse",t)},getOrder:function(t){return e.get("/api/orders/"+t)},updateOrder:function(t,n){return e.put("/api/orders/"+t,n)},getList:function(){return e.get("/api/orders")},getUnifiedOrder:function(t){return e.post("/api/orders/payment/weixinpay/unifiedorder",t)}}}]),angular.module("xw.models").factory("User",["$http","$localStorage",function(e,t){var n=Date.now(),r=500,o=null;return{login:function(n,r,o){var u={username:n,password:r,grant_type:"password"};return o&&(u.couponcode=o),e.post("/api/user/token",u).then(function(e){return e.data&&e.data.access_token&&(t.access_token=e.data.access_token),e})},signup:function(n,r,o,u){var a={mobile:n,pwd:r,code:o};return u&&(a.couponcode=u),e.post("/api/user/signup",a).then(function(e){return e.data&&e.data.access_token&&(t.access_token=e.data.access_token),e})},getSmsCode:function(t){return e.post("/api/user/sms",t)},logout:function(){return e.post("/api/user/logout",{token_type_hint:"access_token",token:t.access_token})},getUserInfo:function(){return e.get("/api/user")},updateUser:function(t){return e.put("/api/user",t)},resetPwd:function(t,n,r){return e.post("/api/user/resetpassword",{mobile:t,pwd:n,code:r})},postCart:function(t){var u=Date.now();return u-n>r?(clearTimeout(o),e.post("/api/user/shoppingcart",{shoppingCart:t})):(clearTimeout(o),o=setTimeout(this.postCart.bind(this,t),r+100),n=u,{"catch":angular.noop})},applyInvitationCode:function(t){return e.get("/api/user/coupon/invitation/"+t)},invitedFriends:function(){return e.get("/api/user/coupon/friends")},getWeixinUserInfo:function(t){return e.get("/api/user/weixin/userinfo?userId="+t)}}}]),angular.module("xw.models").factory("Coupon",["$http",function(e){return{getCouponInfo:function(t){return e.get("/api/coupons/code/"+t)},exchangeCouponCode:function(t){return e.get("/api/user/coupon/code/"+t)}}}]),angular.module("xw.models").factory("Alipay",["$http",function(e){return{notify:function(t,n){var r=n?"/api/orders/payment/alipay/notify/account":"/api/orders/payment/alipay/mobile";return e.post(r,{out_trade_no:t})}}}]),angular.module("xw.models").factory("Balance",["$http","Debug",function(e,t){return{balance:function(){return e.get("/api/user/account")},chargeByCode:function(t){return e.post("/api/user/account/chargecode",{accountChargeCode:t})},chargeOnline:function(t){return e.post("/api/user/account/details",t)},balanceRecords:function(){return e.get("/api/user/account/details?skip=0&limit=200")["catch"](t.promiseErrFn("获取余额记录失败"))}}}]);
angular.module("xw.config").constant("errCode",function(){return{user:{wrongMobile:1110,wrongPassword:1111,alreadyExist:1112,notFound:1113,addressIdNotFound:1210,addressNotFound:1212,addressLatitudeWrong:1220,addressLongitudeWrong:1221,addressProvinceWrong:1222,addressCityWrong:1223,addressDistrictWrong:1224,addressStreetWrong:1225,addressStreetNumberWrong:1226,addressAddressWrong:1227,addressContactPersonWrong:1228,addressMobileWrong:1229,addressSortOrderWrong:1230},order:{wrongMobile:2110},sms:{wrongCode:3110,expired:3111,invalidCode:3112,wrongType:3113,tooManyTries:3114,sendFailed:3115,reachSendLimitation:3116},dish:{outOfStock:4110},coupon:{notStart:5110,expired:5111,used:5112,outOfCount:5113}}}),angular.module("xw.config").factory("commonInterceptor",["$localStorage","$q",function(e,o){var r=[/^\/mobile\/$/,/^\/mobile\/login/,/^\/mobile\/cook/,/^\/mobile\/cart/,/^\/mobile\/resetpwd$/],n=["/api/user","/api/user/token","/api/user/shoppingcart"],t=["/mobile/me","/mobile/addresslist","/mobile/orderaddress","/mobile/invite","/mobile/coupons","/mobile/cook","/mobile/balance","/mobile/chargebalanceonline"];return{request:function(o){return e.access_token&&(o.headers.Authorization="Bearer "+e.access_token),o},responseError:function(e){var a="";if(401==e.status){if(console.log(401),r.some(function(e){return e.test(location.pathname)})&&-1!=n.indexOf(e.config.url))return o.reject(e);t.some(function(e){return-1!=location.pathname.indexOf(e)})&&(a="?redirect="+location.pathname),setTimeout(function(){location.replace("/mobile/login"+a)},120)}return o.reject(e)}}}]),angular.module("xw.config").config(["$httpProvider","$compileProvider",function(e,o){e.defaults.headers.common.Accept="application/vnd.cook.v1+json",e.defaults.headers.common["Access-Control-Allow-Origin"]="http://m.xinweicook.com",e.defaults.headers.common["Accept-Language"]="zh-CN"==navigator.language?"zh-CN":"en-US",e.defaults.headers.common["Content-Type"]="application/json",e.interceptors.push("commonInterceptor"),o.debugInfoEnabled(!1)}]),angular.pick=function(e){var o=Array.prototype.slice.call(arguments,1);return o.reduce(function(o,r){return o[r]=e[r],o},{})},angular.sort=function(e,o){for(var r,n=e.slice(0),t=n.length-1;t>=1;t--)for(var a=0;t>a;a++){var i=o(n[a],n[a+1]);i>0&&(r=n[a],n[a]=n[a+1],n[a+1]=r)}return n};
//# sourceMappingURL=app-0c2f4caeb6.min.js.map
