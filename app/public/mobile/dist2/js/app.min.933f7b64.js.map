{"version":3,"names":[],"mappings":"","sources":["app.min.js"],"sourcesContent":["angular.module(\"xw\",[\"xw.config\",\"xw.services\",\"xw.controllers\",\"xw.directives\",\"xw.filters\"]),angular.module(\"xw.config\",[\"ngStorage\"]),angular.module(\"xw.models\",[\"ngStorage\"]),angular.module(\"xw.controllers\",[\"xw.models\",\"xw.weixin\"]),angular.module(\"xw.directives\",[\"xw.models\"]),angular.module(\"xw.filters\",[]),angular.module(\"xw.weixin\",[]),angular.module(\"xw.services\",[]),angular.module(\"xw.config\").constant(\"errCode\",function(){return{user:{wrongMobile:1110,wrongPassword:1111,alreadyExist:1112,notFound:1113,userReferrerWrong:1140,userIdWrong:1150,userGenderWrong:1152,userOldAddressWrong:1155,invitationSendCodeWrong:1190,addressIdWrong:1210,addressNotFound:1212,addressNotInUser:1214,addressLatitudeWrong:1220,addressLongitudeWrong:1221,addressCoordTypeWrong:1222,addressProvinceWrong:1225,addressCityWrong:1226,addressDistrictWrong:1227,addressStreetWrong:1228,addressStreetNumberWrong:1229,addressAddressWrong:1230,addressContactPersonWrong:1235,addressMobileWrong:1236,addressSortOrderWrong:1237,addressNotDeliver:1270,addressBaiduMapNotFoundError:1280,addressBaiduMapQueryWrong:1290,addressBaiduMapRegionWrong:1291,shoppingCartNotArray:1500,shoppingCartDishIdWrong:1502,shoppingCartDishNumberWrong:1504,shoppingCartSubDishIdWrong:1506,shoppingCartSubDishNumberWrong:1508},order:{notFound:2010,orderNumberWrong:2010,orderIdWrong:2011,warehouseIdWrong:2012,cookingTypeWrong:2110,clientFromWrong:2112,creditWrong:2115,freightWrong:2117,paymentWrong:2119,paymentUsedCashWrong:2120,deliveryDateCookWrong:2122,deliveryTimeCookWrong:2124,deliveryDateEatWrong:2126,deliveryTimeEatWrong:2128,dishListArrayWrong:2130,dishListDishNumberWrong:2132,dishListDishIdWrong:2134,dishListSubDishArrayWrong:2136,dishListSubDishNumberWrong:2138,dishListSubDishIdWrong:2139,addressLatitudeWrong:2140,addressLongitudeWrong:2142,addressProvinceWrong:2144,addressCityWrong:2145,addressDistrictWrong:2146,addressStreetWrong:2147,addressStreetNumberWrong:2148,addressAddressWrong:2149,addressContactPersonWrong:2152,addressMobileWrong:2154,addressIdWrong:2160,userCommentWrong:2180,dishIdInvalid:2190,notOnlyDrink:2192,notOverTenDrinks:2194,orderStatusWrong:2300,orderPaymentStatusWrong:2310},sms:{wrongCode:3110,expired:3111,invalidCode:3112,wrongType:3113,tooManyTries:3114,sendFailed:3115,reachSendLimitation:3116},dish:{outOfStock:4110},coupon:{notStart:5110,expired:5111,used:5112,outOfCount:5113,notFound:5120,exchanged:5121,couponIdWrong:5210,promotionCodeWrong:5212},announcement:{announcementIdWrong:8110,notFound:8112}}}),angular.module(\"xw.config\").factory(\"commonInterceptor\",[\"$localStorage\",\"$q\",function(e,t){var n=[/^\\/mobile\\/$/,/^\\/mobile\\/login/,/^\\/mobile\\/cook/,/^\\/mobile\\/resetpwd$/],r=[\"/api/user\",\"/api/user/token\",\"/api/user/shoppingcart\",\"/api/user/address\"],s=[\"/mobile/me\",\"/mobile/addresslist\",\"/mobile/orderaddress\",\"/mobile/orderlist\",\"/mobile/invite\",\"/mobile/coupons\",\"/mobile/cook\",\"/mobile/balance\",\"/mobile/chargebalanceonline\",\"/mobile/promotion01\"];return{request:function(t){return e.access_token&&(t.headers.Authorization=\"Bearer \"+e.access_token),t},responseError:function(e){var i=\"\";if(401==e.status){if(n.some(function(e){return e.test(location.pathname)})&&-1!=r.indexOf(e.config.url))return t.reject(e);s.some(function(e){return-1!=location.pathname.indexOf(e)})&&(i=\"?redirect=\"+location.pathname),setTimeout(function(){location.replace(\"/mobile/login\"+i)},120)}return t.reject(e)}}}]),angular.module(\"xw.config\").config([\"$httpProvider\",\"$compileProvider\",function(e,t){e.defaults.headers.common.Accept=\"application/vnd.cook.v1+json\",e.defaults.headers.common[\"Access-Control-Allow-Origin\"]=\"http://m.xinweicook.com\",e.defaults.headers.common[\"Accept-Language\"]=\"zh-CN\"==navigator.language?\"zh-CN\":\"en-US\",e.defaults.headers.common[\"Content-Type\"]=\"application/json\",e.interceptors.push(\"commonInterceptor\"),t.debugInfoEnabled(!1)}]),angular.pick=function(e){var t=Array.prototype.slice.call(arguments,1);return t.reduce(function(t,n){return t[n]=e[n],t},{})},angular.sort=function(e,t){for(var n,r=e.slice(0),s=r.length-1;s>=1;s--)for(var i=0;s>i;i++){var o=t(r[i],r[i+1]);o>0&&(n=r[i],r[i]=r[i+1],r[i+1]=n)}return r},angular.module(\"xw.filters\").filter(\"adapt\",function(){var e=Math.floor(document.body.offsetWidth*window.devicePixelRatio),t=Math.floor(2*e/3),n=\"?imageView2/1/w/\",r=n+e+\"/h/\"+t;return function(t,s){return t+(s?n+e+\"/h/\"+Math.floor(e*s):r)}}),angular.module(\"xw.filters\").filter(\"fraction\",function(){function e(e,t){for(var n=\"\",r=0;r<e.length;r++)n+=t[e[r]];return n}var t=[\"⁰\",\"¹\",\"²\",\"³\",\"⁴\",\"⁵\",\"⁶\",\"⁷\",\"⁸\",\"⁹\"],n=[\"₀\",\"₁\",\"₂\",\"₃\",\"₄\",\"₅\",\"₆\",\"₇\",\"₈\",\"₉\"];return function(r){return r.replace(/(\\d+)\\/(\\d+)/g,function(r,s,i){return e(s,t)+\"⁄\"+e(i,n)+\" \"})}}),angular.module(\"xw.filters\").filter(\"postDish\",function(){return function(e){return{dish:e.dish._id,number:e.number,subDish:e.subDish?e.subDish.map(function(e){return{dish:e.dish._id,number:e.number}}):[]}}}),angular.module(\"xw.filters\").filter(\"beautifyMobile\",function(){return function(e){return/^\\d{11}$/.test(e)?e.replace(/^(\\d{3})(\\d{4})(\\d{4})$/,function(e,t,n,r){return t+\" \"+n+\" \"+r}):e}}),angular.module(\"xw.filters\").filter(\"subDishTitle\",function(){return function(e){var t=e.subDish.length;return t?\"(\"+e.subDish.reduce(function(e,n,r){return e+n.dish.title.zh+(r==t-1?\"\":\"/\")},\"\")+\")\":\"\"}}),angular.module(\"xw.filters\").filter(\"orderTime\",function(){return function e(t,n){var r;return\"eat\"==n?{deliveryDateEat:t.hour.substr(0,10),deliveryTimeEat:t.hour.substr(11,5)}:\"cook\"==n?(r={deliveryDateCook:t.day},r.deliveryTimeCook=t.segment?t.segment.name+\":00\":\"12:00\",r):\"all\"==n?(r={},t.eat&&(r=e(t.eat,\"eat\")),t.cook&&angular.extend(r,e(t.cook,\"cook\")),r):void 0}}),angular.module(\"xw.filters\").filter(\"cookTimeUnion\",function(){return function(e){if(!e)return e;var t=!!e[0].segment;return e.reduce(function(e,n){return t?n.segment.forEach(function(t){e.push({day:n.day,segment:t})}):e.push({day:n.day}),e},[])}}),angular.module(\"xw.filters\").filter(\"dishes\",function(){return function(e,t,n){var r;return\"order\"==t&&\"displayCart\"==n?(r=[],Object.keys(e).forEach(function(t){e[t].forEach(function(e){r.push({dish:e.dish._id,number:e.number,subDish:e.subDish.map(function(e){return{dish:e.dish._id,number:e.number}})})})}),{dishList:r}):e}}),angular.module(\"xw.filters\").filter(\"coupon\",function(){return function(e){var t={};return e.code&&(t.promotionCode=e.code,8==e.code.length&&(t.promotionCode=\"zz\"+t.promotionCode)),e.card&&(t.coupon=e.card._id),t}}),angular.module(\"xw.filters\").filter(\"eatTimeOptions\",function(){return function(e){return e&&e.length?(e.unshift({hour:\"请选择配送时间\"}),e):e}}),angular.module(\"xw.filters\").filter(\"eatTimeDisplay\",function(){return function(e){return e.hour}}),angular.module(\"xw.filters\").filter(\"cookTimeOptions\",function(){return function(e){return e&&e.length?(e.unshift({day:\"请选择配送时间\"}),e):e}}),angular.module(\"xw.filters\").filter(\"cookTimeDisplay\",function(){return function(e){return\"请选择配送时间\"==e.day||e.segment?e.day:e.day+\" 送达\"}}),angular.module(\"xw.filters\").filter(\"dishPrice\",function(){return function(e,t){var n=e.dish.priceOriginal;if(e.subDish)for(var r=0,s=e.subDish.length;s>r;r++)n+=e.subDish[r].dish.priceOriginal;return n*(t?e.number:1)}}),angular.module(\"xw.filters\").filter(\"orderStatus\",function(){var e={\"not paid\":\"未支付\",paid:\"已支付\",confirmed:\"已确认\",\"dish finished\":\"已完成\",packaged:\"已打包\",shipped:\"配送中\",finished:\"已完成\",canceled:\"已取消\"};return function(t){return e[t]||\"\"}}),angular.module(\"xw.filters\").filter(\"orderId\",function(){return function(e){if(!e)return e;for(var t=[],n=0;n<e.length;n+=4)t.push(e.substr(n,4));return t.join(\" \")}}),angular.module(\"xw.filters\").filter(\"payment\",function(){var e={\"alipay direct\":\"支付宝\",weixinpay:\"微信钱包\",\"account balance\":\"新味币\"};return function(t){return e[t]||t}}),angular.module(\"xw.models\").factory(\"Dishes\",[\"$http\",function(e){return{getList:function(t){return t=t||\"\",e.get(\"/api/dishes?cookingType=\"+t)},like:function(t){return e.put(\"/api/dishes/\"+t+\"/like\")},getOne:function(t){return e.get(\"/api/dishes/\"+t)}}}]),angular.module(\"xw.models\").factory(\"Orders\",[\"$http\",function(e){return{postOrder:function(t){return e.post(\"/api/orders\",t)},deliveryTime:function(t){return e.post(\"/api/orders/delivery/time\",t)},deliveryEatTime:function(t){return e.post(\"/api/orders/delivery/time/eat/warehouse\",t)},getOrder:function(t){return e.get(\"/api/orders/\"+t)},updateOrder:function(t,n){return e.put(\"/api/orders/\"+t,n)},cancel:function(t){return e.put(\"/api/orders/\"+t,{isPaymentPaid:\"false\",status:\"canceled\"})},getList:function(){return e.get(\"/api/orders\")},getUnifiedOrder:function(t){return e.post(\"/api/orders/payment/weixinpay/unifiedorder\",t)},price:function(t){return e.post(\"/api/orderprice\",t)},payByAlipay:function(t){return e.post(\"/api/orders/payment/alipay/sign\",{_id:t})}}}]),angular.module(\"xw.models\").factory(\"User\",[\"$http\",\"$localStorage\",function(e,t){var n=Date.now(),r=500,s=null;return{login:function(n,r,s){var i={username:n,password:r,grant_type:\"password\"};return s&&(i.couponcode=s),e.post(\"/api/user/token\",i).then(function(e){return e.data&&e.data.access_token&&(t.access_token=e.data.access_token),e})},signup:function(n,r,s,i,o){var a={mobile:n,pwd:r,code:s,referrer:o||\"\"};return i&&(a.couponcode=i),e.post(\"/api/user/signup\",a).then(function(e){return e.data&&e.data.access_token&&(t.access_token=e.data.access_token),e})},getSmsCode:function(t){return e.post(\"/api/user/sms\",t)},logout:function(){return e.post(\"/api/user/logout\",{token_type_hint:\"access_token\",token:t.access_token})},getUserInfo:function(){return e.get(\"/api/user\").then(function(e){return localStorage.uid=e.data._id,window.trackJs.configure({userId:e.data._id}),e})},updateUser:function(t){return e.put(\"/api/user\",t)},resetPwd:function(t,n,r){return e.post(\"/api/user/resetpassword\",{mobile:t,pwd:n,code:r})},postCart:function(t){var i=Date.now();return i-n>r?(clearTimeout(s),e.post(\"/api/user/shoppingcart\",{shoppingCart:t})):(clearTimeout(s),s=setTimeout(this.postCart.bind(this,t),r+100),n=i,{\"catch\":angular.noop})},applyInvitationCode:function(t){return e.get(\"/api/user/coupon/invitation/\"+t)},invitedFriends:function(){return e.get(\"/api/user/coupon/friends\")},getWeixinUserInfo:function(t){return e.get(\"/api/user/weixin/userinfo?userId=\"+t)}}}]),angular.module(\"xw.models\").factory(\"Address\",[\"$http\",function(e){return{getList:function(){return e.get(\"/api/user/address\")},addOne:function(t){return e.post(\"/api/user/address\",t)},update:function(t){return e.put(\"/api/user/address/\"+t._id,t)},\"delete\":function(t){return e[\"delete\"](\"/api/user/address/\"+t)},range:function(){return e.get(\"/api/orders/delivery/range\")}}}]),angular.module(\"xw.models\").factory(\"Coupon\",[\"$http\",function(e){return{getCouponInfo:function(t){return e.get(\"/api/coupons/code/\"+t)},exchangeCouponCode:function(t){return e.get(\"/api/user/coupon/code/\"+t)}}}]),angular.module(\"xw.models\").factory(\"Alipay\",[\"$http\",function(e){return{notify:function(t,n){var r=n?\"/api/orders/payment/alipay/notify/account\":\"/api/orders/payment/alipay/mobile\";return e.post(r,{out_trade_no:t})}}}]),angular.module(\"xw.models\").factory(\"Balance\",[\"$http\",\"Debug\",function(e,t){return{balance:function(){return e.get(\"/api/user/account\")},chargeByCode:function(t){return e.post(\"/api/user/account/chargecode\",{accountChargeCode:t})},chargeOnline:function(t){return e.post(\"/api/user/account/details\",t)},balanceRecords:function(){return e.get(\"/api/user/account/details?skip=0&limit=200\")[\"catch\"](t.promiseErrFn(\"获取余额记录失败\"))}}}]),angular.module(\"xw.directives\").run([\"$templateCache\",function(e){e.put(\"add-dish-bar.html\",'<div class=\"selection-cover\" ng-cloak ng-if=\"dish\" ng-click=\"hide()\"></div><div class=\"selections-container\" ng-if=\"dish\" ng-cloak><div class=\"block\"><h4 class=\"text-center\">{{dish.title.zh}}<span ng-click=\"hide()\" class=\"button close-button\"></span></h4><ul class=\"properties\" ng-if=\"dish.preferences.length\"><li ng-repeat=\"property in dish.preferences track by property._id\"><h5>{{property.name.zh}}</h5><ul class=\"selections\"><li ng-repeat=\"selection in property.foodMaterial track by selection._id\" ng-click=\"(!selection.outOfStock && selection.dish.isPublished) && (dish.curSelection[property.name.zh] = selection.dish)\" ng-class=\"{\\'no-stock\\': (selection.outOfStock || !selection.dish.isPublished), selected: dish.curSelection[property.name.zh] == selection.dish}\">{{selection.dish.title.zh}}</li></ul></li></ul><div class=\"counter-wrapper\"><i>份数</i><div class=\"counter text-center\"><span ng-click=\"dish.count>0 && (dish.count=dish.count-1)\" class=\"minus\">-</span> <span class=\"number\">{{dish.count}}</span> <span ng-click=\"dish.count=dish.count+1\" class=\"add\">+</span></div></div><div class=\"add-to-cart-button text-center\" ng-class=\"{invalid: dish.count == 0}\" ng-click=\"dish.count>0 && addToCart(dish)\">加入购物袋</div></div></div>'),e.put(\"address-list.html\",'<ul class=\"address-list\" capture-click=\"watchAddress($event)\"><li class=\"address-item\" ng-repeat=\"address in addresses\"><address cur=\"{{address.isDefault}}\" range=\"range\" out-address=\"address\" hide=\"hideAddress($index)\" leave=\"handler.leave[$index]\" save=\"handler.save[$index]\" valid=\"handler.valid[$index]\" delete-hook=\"remove($index)\"></address></li><li ng-if=\"range\" class=\"address-item\"><address range=\"range\" out-address=\"data.newAddress\" cur=\"{{!addresses.length}}\" hide=\"hideAddress(-2)\" leave=\"handler.leave.newAddress\" save=\"handler.save.newAddress\" valid=\"handler.valid.newAddress\"></address></li></ul>'),e.put(\"address-selection.html\",'<div class=\"address-selection\" flash-class=\"{exp: animateTrigger, duration: 400}\" ng-if=\"show\" ng-cloak><a href=\"/mobile/orderaddress?path={{path}}&dishId={{dishId}}\"><div ng-show=\"path != \\'/eat\\' && address\" class=\"address-tip\">配送至:{{address.street + address.address | limitTo: 18}}</div><div ng-show=\"noAddress\" class=\"no-address-tip\">您没有可以配送的地址,请先新建地址</div><div ng-show=\"path == \\'/eat\\' && (address && !address.isAvailableForEat)\" class=\"no-address-tip\">当前地址不在便当配送范围内</div><div ng-show=\"path == \\'/eat\\' && address.isAvailableForEat\" class=\"address-tip\">配送至:{{address.street + address.address | limitTo: 18}}</div></a></div>'),e.put(\"address.html\",'<div ng-if=\"css.isNewAddress && css.edit\" class=\"new-address-tip\">请填写有效的地址以便按时送达</div><div ng-hide=\"hide()\" class=\"address-component\" ng-class=\"{cur: css.cur || css.isNewAddress, edit: css.edit}\" ng-click=\"choose($event)\"><div class=\"address-block\" ng-if=\"!css.isNewAddress\"><span class=\"deliverable-tag\" ng-if=\"addr.isAvailableForEat\">便当可送达</span><div>{{addr.contactPerson}}</div><div class=\"cur-show\">{{addr.mobile | beautifyMobile}}</div><div class=\"cur-show\">{{addr.province + \\' \\' + addr.city + \\' \\' + addr.district}}</div><div>{{addr.street}}</div><div class=\"cur-show\">{{addr.address}}</div><div class=\"user-actions\"><span class=\"glyphicon glyphicon-pencil\"></span> <span ng-click=\"deleteAddress($event)\" class=\"glyphicon glyphicon-trash\"></span></div></div><div class=\"new-address-block\" ng-if=\"css.isNewAddress && !css.edit\">+ 新建收货地址</div><form ng-model-options=\"{ updateOn: \\'default blur\\', debounce: { \\'default\\': 500, \\'blur\\': 0 } }\" ng-class=\"{\\'new-address\\': css.isNewAddress}\" ng-if=\"css.edit\" name=\"form\"><div ng-init=\"initForm(form, addr)\" ng-class=\"{\\'with-tag\\': addr.isAvailableForEat}\"><input name=\"contactPerson\" type=\"text\" placeholder=\"收货人\" ng-model=\"addr.contactPerson\" auto-focus minlength=\"2\" required><err-tip form=\"form\" name=\"contactPerson\" error=\"required\">必填</err-tip><err-tip form=\"form\" name=\"contactPerson\" error=\"minlength\">联系人姓名至少2个字</err-tip></div><div><input name=\"mobile\" type=\"tel\" placeholder=\"手机号\" ng-model=\"addr.mobile\" pattern=\"^1\\\\d{10}$\" required><err-tip form=\"form\" name=\"mobile\" error=\"required\">必填</err-tip><err-tip form=\"form\" name=\"mobile\" error=\"pattern\">请填写11位手机号</err-tip></div><div ng-show=\"!css.showFakeInput\" class=\"selects\"><div class=\"select\"><select required name=\"province\" id=\"province\" ng-options=\"province for province in options()\" ng-change=\"trySelectUnique()\" ng-model=\"addr.province\"></select></div><div class=\"select\"><select required name=\"city\" id=\"city\" ng-options=\"city for city in options(addr.province)\" ng-model=\"addr.city\"></select></div><div class=\"select\"><select required name=\"district\" id=\"district\" ng-options=\"district for district in options(addr.province, addr.city)\" ng-model=\"addr.district\"></select></div></div><div ng-if=\"css.showFakeInput\"><input type=\"text\" placeholder=\"省、市、区\" ng-click=\"css.showFakeInput = false\"> <span class=\"err-tip\" ng-if=\"(form.province.$error.required||form.city.$error.required||form.district.$error.required) &&form.$submitted\">必填</span></div><div ng-click=\"showSearchAddress()\">{{addr.street}} <input type=\"hidden\" name=\"street\" placeholder=\"街道\" ng-model=\"addr.street\" required> <span ng-if=\"!addr.street\" class=\"placeholder\">街道</span><err-tip form=\"form\" name=\"street\" error=\"required\">必填</err-tip></div><div><input name=\"address\" type=\"text\" minlength=\"2\" placeholder=\"详细地址, 楼层、门牌号\" required ng-model=\"addr.address\"><err-tip form=\"form\" name=\"address\" error=\"required\">必填</err-tip><err-tip form=\"form\" name=\"address\" error=\"minlength\">至少2个字符</err-tip></div></form><div class=\"search-address\" ng-if=\"css.edit && css.showSearchAddress\"><form id=\"address-form\"><div><input type=\"text\" placeholder=\"街道、小区、写字楼、地标名称\" id=\"address\" ng-model=\"data.street\" ng-model-options=\"{debounce: 400}\" auto-focus ng-change=\"searchAddress()\"></div></form><div class=\"find-address-tip\" ng-if=\"data.streetList.length\">您要找的是不是?</div><div class=\"no-address-tip\" ng-if=\"data.street && !data.streetList.length\"><h4>未能找到此地址</h4><p>建议输入街道、小区、写字楼、地标名称等</p></div><ul class=\"results\"><li ng-click=\"confirmStreet($event, street)\" ng-repeat=\"street in data.streetList\"><h4>{{street.address}}</h4><p>{{street.addressInfoBaidu}}</p></li></ul></div></div>'),e.put(\"confirm.html\",'<div class=\"xw-confirm\" ng-click><modal close=\"close\" show=\"showModal\" pre-close=\"preClose\"><div class=\"text\" ng-transclude></div><div class=\"button-group\"><span ng-click=\"cancel()\">取消</span><span ng-click=\"confirm()\">确定</span></div></modal></div>'),e.put(\"err-tip.html\",'<span class=\"err-tip\" ng-if=\"(form[name].$dirty||form.$submitted) && form[name].$error[error]\" ng-transclude></span>'),e.put(\"geetest-sms-button.html\",'<div class=\"geetest-sms-button-group\"><div id=\"geetestContainer\" ng-show=\"state==2\"></div><span class=\"geetest-sms-button\" ng-if=\"state <= 1\" ng-class=\"{invalid: state === 0}\" ng-click=\"state == 1 && showGeetest()\">获取验证码</span> <span class=\"geetest-sms-button invalid\" ng-if=\"state == 3\">发送成功 {{remains}}</span> <span ng-click=\"state == 5 && showGeetest()\" class=\"geetest-sms-button\" ng-class=\"{invalid: state == 4}\" ng-if=\"state > 3\">重新获取</span></div>'),e.put(\"menu-nav.html\",'<nav class=\"menu-nav\" ng-class=\"{\\'empty\\': !localBag.length}\"><div ng-class=\"{active: path == \\'/mobile/me\\'}\"><a href=\"/mobile/me\"><span>帐号</span></a></div><div ng-class=\"{active: path == \\'/eat\\'}\"><a href=\"/mobile/#/eat\"><span>便当</span></a></div><div ng-class=\"{active: path == \\'/cook\\' || !path}\"><a href=\"/mobile/#/cook\"><span>食材包</span></a></div><div class=\"go-to-cart\" ng-class=\"{invalid: !isAddressOk()}\" ng-if=\"localBag.length\" flash-class=\"{exp: localBag.length, duration: 400}\" ng-click=\"isAddressOk({isClick: true}) && goToCart()\"><div class=\"icon bag-icon\"><i class=\"number\" ng-bind=\"localBag.length\"></i></div><span class=\"price\" ng-bind=\"localBag.price || 0 | number: 1\"></span></div></nav>'),e.put(\"modal.html\",'<div class=\"xw-modal-container\" ng-show=\"css.show\"><div class=\"xw-modal-backdrop\" ng-click=\"close()\"></div><div class=\"xw-modal-content\" ng-transclude></div></div>'),e.put(\"shopping-progress-bar.html\",'<div class=\"shopping-progress-bar\"><div class=\"states\"><span ng-class=\"{cur: state == \\'state1\\'}\" class=\"state1\">筛选购物袋</span> <span ng-class=\"{cur: state == \\'state2\\'}\" class=\"state2\">确认送货地址</span> <span ng-class=\"{cur: state == \\'state3\\'}\" class=\"state3\">支付</span></div><div class=\"state-bar-container\"><div class=\"indicator\" ng-class=\"state\"></div></div></div>'),e.put(\"sms-button.html\",'<div class=\"sms-button-group\"><span class=\"sms-button\" ng-if=\"state <= 1\" ng-class=\"{invalid: state === 0}\" ng-click=\"state == 1 && getSmsCode()\">获取验证码</span> <span class=\"sms-button invalid\" ng-if=\"state == 2\">{{remains}}秒后重新获取</span> <span ng-click=\"state == 4 && getSmsCode()\" class=\"sms-button\" ng-class=\"{invalid: state == 3}\" ng-if=\"state > 2\">重新获取</span></div>'),e.put(\"thanksgiving.html\",'<div class=\"thanksgiving\"><modal default=\"show\" ng-click=\"close()\" close=\"close\"><div class=\"thanksgiving-main\">全周好品味，新味感谢您!</div></modal></div>')}]),angular.module(\"xw.weixin\").factory(\"Weixin\",[\"$http\",\"Debug\",function(e,t){var n={wx:{appId:\"wx37a1323e488cef84\",jsApiList:[\"getLocation\",\"onMenuShareTimeline\",\"onMenuShareAppMessage\"]},location:{longitude:121.460625,latitude:31.189426},ak:\"xnKgWtGYXf4gkLgreox7xpjI\",oauthUrl:\"/api/orders/payment/weixinpay/oauthcode?orderid=\"};return{isWeixin:/MicroMessenger/i.test(navigator.userAgent),oauthUrl:n.oauthUrl,readyState:!1,ready:function(e){this.readyState?e():this.ready.cb=e},config:function(e){var t=this,r=angular.copy(n.wx);r.timestamp=e.timestamp,r.nonceStr=e.nonceStr,r.signature=e.signature,wx.config(r),wx.ready(function(){t.ready.cb&&t.ready.cb(),t.readyState=!0})},getLocation:function(e,t){var n={type:\"gcj02\"};e&&(n.success=e),t&&(n.fail=t),wx.getLocation(n)},shareTimeline:function(e){wx.onMenuShareTimeline(e)},shareAppMessage:function(e){wx.onMenuShareAppMessage(e)},showOptionMenu:function(){wx.showOptionMenu()},hideOptionMenu:function(){wx.hideOptionMenu()},getLocationName:function(t,r){var s=\"http://api.map.baidu.com/geocoder/v2/?output=json&pois=1&coordtype=gcj02ll&callback=JSON_CALLBACK\";return e.jsonp(s,{params:{ak:n.ak,location:t+\",\"+r}})},getJsconfig:function(){return e.post(\"/api/orders/payment/weixinpay/config\",{url:location.href.substr(0,location.href.length-location.hash.length)})}}}]),angular.module(\"xw.services\").factory(\"Alert\",function(){var e={1110:\"手机号码或密码错误\",1111:\"手机号码或密码错误\",1112:\"该用户已存在\",1113:\"手机号码或密码错误\",2110:\"手机号码错误\",3110:\"短信码错误\",3111:\"短信码已过期\",3112:\"无效的短信码\",3113:\"错误的短信码类型\",3114:\"短信码验证次数过多, 请重新接收短信码\",3115:\"发送失败, 请稍后重试\",3116:\"短信码发送次数达到当日最大次数\",4110:\"库存不足\",5110:\"尚未到充值码使用时间\",5111:\"优惠码/优惠券已过期\",5112:\"优惠码/优惠券已被使用\",5113:\"超出优惠码/优惠券最大使用次数\",5121:\"只能兑换一次朋友的邀请码(无论是否是同一个朋友), 您已经兑换过一次了\"};return{show:function(t,n){var r=e[t];r?alert(r):n&&alert(n)},message:function(t){return e[t]||\"\"}}}),angular.module(\"xw.services\").provider(\"Debug\",function(){var e=this;e.debugKey=\"debug\",this.$get=[\"Utils\",function(t){var n=new RegExp(\"\\\\b\"+e.debugKey+\"\\\\b\"),r=\"\",s=t.searches(location.search);n=n.test(location.search)||!!sessionStorage.getItem(\"debug\"),n&&!sessionStorage.getItem(\"debug\")&&sessionStorage.setItem(\"debug\",\"true\"),n&&\"fakewarehouse\"in s&&(r=s.fakewarehouse);var i={isDebug:n,alert:function(e){this.isDebug&&(console.log(e),e=\"[object Object]\"==Object.prototype.toString.call(e)?JSON.stringify(e):e,alert(e))},assert:function(e,t){this.isDebug&&!e&&alert(t)},promiseErrFn:function(e){return function(t){i.alert(e),i.alert(t)}},fakeWarehouse:r};return i}]}),angular.module(\"xw.services\").factory(\"Map\",[\"$http\",\"Debug\",function(e,t){var n={xinweioffice:6e3,caohejing1:1560},r={bentoNoReach:999999,topDistance:{xinweioffice:6e3,caohejing1:1560},suggestion:function(t,n){return e.get(\"/mobile/placesuggestion?query=\"+t+\"&region=\"+n)},search:function(t,n){return e.post(\"/api/user/address/suggestion\",{query:t,region:n})},gcj02ToBd09:function(e){var t=e.lat,n=e.lng,r=Math.sqrt(n*n+t*t)+2e-5*Math.sin(t*Math.PI),s=Math.atan2(t,n)-3e-6*Math.cos(n*Math.PI);return{lng:r*Math.cos(s)+.0065,lat:r*Math.sin(s)+.006}},bd09ToGcj02:function(e){var t=e.lat-.006,n=e.lng-.0065,r=Math.sqrt(n*n+t*t)-2e-5*Math.sin(t*Math.PI),s=Math.atan2(t,n)-3e-6*Math.cos(n*Math.PI);return{lng:r*Math.cos(s),lat:r*Math.sin(s)}},lineDistance:function(e,t,n,r){var s=6371e3,i=Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.cos((t-r)*Math.PI/180),o=Math.sin(e*Math.PI/180)*Math.sin(n*Math.PI/180),a=i+o;a>1&&(a=1),-1>a&&(a=-1);var d=Math.acos(a);return d*s},lineDistance2CHJ:function(e,t){var n=this.warehouseCoords.caohejing1;return this.lineDistance(e,t,n.lat,n.lng)},fixZero:function(e,t,n){if(0!==e)return e;var r=this.lineDistance(t,n,31.189426,121.460625);return r>1500?999999:e},walkingDistance:function(t,r,s){var i;s=s||\"\",Array.isArray(arguments[0])?(i=arguments[0],s=r):i=[{lat:t,lng:r}];var o=\"\";return i.forEach(function(e,t){if(!(t>=5)){var n=0==t?\"\":\"|\";o+=\"string\"==typeof e?n+e:n+e.lat+\",\"+e.lng}}),e.get(\"/mobile/distance?destinations=\"+encodeURIComponent(o)+\"&warehouse=\"+s).then(function(e){for(var t,r=e.data.result.elements,s=[],i=r.length/2,o=0;i>o;o++)r[o].warehouse=\"xinweioffice\",r[i+o].warehouse=\"caohejing1\",t=[r[o],r[i+o]],t=angular.sort(t,function(e,t){return e.distance.value-n.xinweioffice-(t.distance.value-n.caohejing1)}),s.push(t);return s})[\"catch\"](function(){return console.log(\"get distance error\"),[]})},distance:function(e,s,i){return this.walkingDistance(e,s,i).then(function(t){var i=t[0][0].distance.value;i=r.fixZero(i,e,s);var o=n[t[0][0].warehouse];return{distance:i,isInRange:o>=(null===i?999999:i),warehouse:t[0][0].warehouse}})[\"catch\"](function(e){t.alert(\"获取步行距离失败\"),t.alert(e)})},distances:function(e,t){return e=Array.isArray(e)?e:[e],this.walkingDistance(e,t).then(function(t){return t.map(function(t,s){var i=r.fixZero(t[0].distance.value,e[s].lat,e[s].lng),o=n[t[0].warehouse];return{distance:i,isInRange:o>=(null===i?999999:i),warehouse:t[0].warehouse}})})},nearestWarehouse:function(e,r){var s=this,i=n.xinweioffice,o=n.caohejing1,a=angular.sort([\"xinweioffice\",\"caohejing1\"].map(function(t){var n=s.warehouseCoords[t];return{name:t,distance:s.lineDistance(e,r,n.lat,n.lng)}}),function(e,t){return e.distance-i+1100-(t.distance-o)});return t.fakeWarehouse?t.fakeWarehouse:a[0].name},warehouseCoords:{xinweioffice:{lat:31.189426,lng:121.460625},caohejing1:{lat:31.16925,lng:121.398949}}};return r}]),angular.module(\"xw.services\").factory(\"ScopeDecorator\",[\"$location\",function(e){return{common:function(e){e&&(e.back=function(){history.length>1?history.back():location.href=\"/mobile/\"})},nav:function(t){t&&t.$on(\"$locationChangeStart\",function(){t.path=e.path()})}}}]),angular.module(\"xw.services\").factory(\"Utils\",[\"$localStorage\",function(e){return{utf2b64:function(e){return btoa(unescape(encodeURIComponent(e))).replace(/\\+/g,\"-\").replace(/\\//g,\"_\")},b642utf:function(e){return decodeURIComponent(escape(window.atob(e.replace(/-/g,\"+\").replace(/_/g,\"/\"))))},isSameItemInCart:function(e,t){return e.dish._id==t.dish._id&&e.subDish.every(function(e){return t.subDish.some(function(t){return e.dish._id==t.dish._id})})&&e.subDish.length==t.subDish.length},mergeCarts:function(e,t){if(!e||!e.length)return t;for(var n=this,r=0;r<t.length;r++){var s=e.every(function(e){return!n.isSameItemInCart(e,t[r])});s&&e.push(t[r])}return e},getStockId:function(e,t){var n={};return\"preference\"==t?e.forEach(function(e){e.preferences.forEach(function(e){e.foodMaterial.forEach(function(e){!n[e.dish._id]&&e.dish.isPublished&&(n[e.dish._id]=!0)})})}):e.forEach(function(e){n[e._id]||e.outOfStock||(n[e._id]=!0)}),Object.keys(n)},cleanLocalStorage:function(){var t=[\"promotion\",\"access_token\",\"selectedAddress\"];Object.keys(e).forEach(function(n){-1==t.indexOf(n)&&\"$\"!=n[0]&&delete e[n]})},searches:function(e){return e=e||location.search,e.slice(1).split(\"&\").reduce(function(e,t){return t&&(t=t.split(\"=\"),e[t[0]]=decodeURIComponent(t[1]||\"\")),e},{})},addressEqual:function(e,t){return e=e||\"\",t=t||\"\",e&&t?!e.indexOf(t)||!t.indexOf(e):!1},regularizeAddress:function(e,t){var n,r,s=this.addressEqual;return t.some(function(t){return s(e.province,t.state)?(e.province=t.state,n=t.cities,!0):void 0}),n&&n.some(function(t){return s(e.city,t.city)?(e.city=t.city,r=t.areas,!0):void 0}),r&&r.some(function(t){return s(e.district,t)?(e.district=t,!0):void 0}),e},addressOptions:function(e,t,n){var r=arguments.length;if(1==r)return e.map(function(e){return e.state});if(2==r){if(!t)return;return e.filter(function(e){return e.state==t})[0].cities.map(function(e){return e.city})}if(3==r){if(!n)return;var s=e.filter(function(e){return e.state==t})[0].cities.filter(function(e){return e.city==n});if(s&&s.length)return s[0].areas}},stockOfDish:function(e,t){return e.stockWarehouse.some(function(e){return e.warehouse==t&&e.stock>0})},stockOfItem:function(e,t){var n=this.stockOfDish;return n(e.dish,t)&&!!e.subDish&&e.subDish.every(function(e){return n(e.dish,t)})}}}]),angular.module(\"xw.directives\").directive(\"addDishBar\",[\"Debug\",\"User\",\"$localStorage\",\"$filter\",\"Utils\",function(e,t,n,r,s){return{scope:{dish:\"=\",user:\"=\",localBag:\"=\"},templateUrl:\"add-dish-bar.html\",link:function(e){var i=e.storage=n,o=e.localBag=[],a=e.$watch(\"user\",function(t){t&&(a(),e.localBag=o=s.mergeCarts(o,t.shoppingCart.filter(function(e){return!!e.dish})),e.totalPrice())});e.$watch(\"dish\",function(t){if(t){var n={};e.dish.preferences.forEach(function(e){e.foodMaterial.forEach(function(e){e.outOfStock=!(e.dish.stockWarehouseObj[i.warehouse]>0||\"ready to cook\"==e.dish.cookingType)}),e.foodMaterial.some(function(t){return t.outOfStock?!1:(n[e.name.zh]=t.dish,!0)})}),e.dish.curSelection=n}}),e.addToCart=function(n){var r,i=n.curSelection,a={dish:n,number:n.count,subDish:Object.keys(i).map(function(e){return{dish:i[e],number:n.count}})};o.some(function(e){return s.isSameItemInCart(e,a)?(r=e,r.number+=a.number,r.subDish.forEach(function(e){e.number=r.number}),!0):void 0}),r||o.push(a),n.count=0,e.hide(),t.postCart(o.filter(function(e){return!!e.dish}).map(d)),e.totalPrice()};var d=r(\"postDish\");e.totalPrice=function(){var e=o.filter(function(e){return!!e.dish}).reduce(function t(e,n){return e+=n.dish.priceOriginal*n.number,n.subDish&&(e+=n.subDish.reduce(t,0)),e},0);return o.price=e},e.totalPrice(),e.hide=function(){e.dish=null}}}}]),angular.module(\"xw.directives\").directive(\"addressList\",[\"$q\",\"Alert\",function(e,t){return{restrict:\"E\",scope:{addresses:\"=\",range:\"=\",watchAddress:\"=save\",editing:\"=\",hideOthersWhenEdit:\"@\"},templateUrl:\"address-list.html\",link:function(n){var r=n.data={newAddress:{}},s=n.handler={save:[],leave:[],valid:[]};n.hideAddress=function(e){if(\"true\"==n.hideOthersWhenEdit&&n.addresses){var t=-1;return n.data.newAddress.edit&&(t=-2),-1==t&&n.addresses.some(function(e,n){return e.edit?(t=n,!0):void 0}),-1!=t&&e!=t}},n.editing=function(){return n.addresses?!!r.newAddress.edit||n.addresses.some(function(e){return e.edit}):!1},n.remove=function(e){n.addresses.splice(e,1),s.save.splice(e,1),s.leave.splice(e,1),s.valid.splice(e,1)},n.watchAddress=function(i){var o,a=i.target,d=a;do if(-1!=d.className.indexOf(\"address-item\"))for(var c=d.parentElement.children,u=0,l=c.length;l>u;u++)if(c[u]==d){o=u;break}while(d=d.parentElement);var g=-1,f=-1;if(n.addresses.forEach(function(e,t){e.edit&&(g=t),e.cur&&(f=t)}),!(o==f||o==n.addresses.length&&r.newAddress.cur)){var p;if(-1!=g){if(!s.valid[g]())return i.stopPropagation();p=s.save[g]()}else if(r.newAddress.edit){if(!s.valid.newAddress())return i.stopPropagation();p=s.save.newAddress().then(function(e){return n.addresses.push(e),r.newAddress={},e})[\"catch\"](function(e){t.show(e.data.validationStatus,\"保存失败\")})}return-1!=f?(s.leave[f](),-1==g&&(p=e.resolve(n.addresses[f]))):r.newAddress.cur&&s.leave.newAddress(),p}}}}}]),angular.module(\"xw.directives\").directive(\"addressSelection\",function(){return{restrict:\"E\",scope:{animateTrigger:\"=\",show:\"=\",address:\"=\",noAddress:\"=\",dishId:\"@\",path:\"@\"},templateUrl:\"address-selection.html\"}}),angular.module(\"xw.directives\").directive(\"address\",[\"$timeout\",\"$location\",\"Address\",\"Utils\",\"$q\",\"Weixin\",\"Map\",\"Alert\",function(e,t,n,r,s,i,o,a){return{restrict:\"E\",scope:{outAddress:\"=\",range:\"=\",save:\"=\",leave:\"=\",valid:\"=\",deleteHook:\"&\",hide:\"&\",cur:\"@\"},templateUrl:\"address.html\",link:function(e){var a,d=e.css={edit:!1,cur:\"true\"==e.cur,showSearchAddress:!1,form:null,locating:!1,\nisWeixin:i.isWeixin,isNewAddress:Object.keys(e.outAddress).length<2},c=e.data={street:\"\"};d.isNewAddress?(a=e.addr={sortOrder:0},d.cur&&(d.edit=!0)):a=e.addr=r.regularizeAddress(angular.copy(e.outAddress),e.range),e.outAddress.cur=d.cur,e.outAddress.edit=!!d.edit,e.options=r.addressOptions.bind(null,e.range),e.$on(\"$locationChangeStart\",function(){if(d.edit){var e=t.path();d.showSearchAddress=\"/search-address\"==e}}),e.choose=function(){d.cur?(d.edit=!0,e.outAddress.edit=!0):(d.cur=!0,d.isNewAddress&&(d.edit=!0,e.outAddress.edit=!0)),e.outAddress.cur=!0},e.trySelectUnique=function(){var t=e.options(a.province);1==t.length&&(a.city=t[0])},e.deleteAddress=function(t){t.stopPropagation(),n[\"delete\"](a._id),e.deleteHook&&e.deleteHook()},e.showSearchAddress=function(){c.street=a.street,t.path(\"search-address\"),e.data.streetList&&(e.data.streetList.length=0),e.searchAddress()},e.searchAddress=function(){c.street&&o.search(c.street,a.city||\"全国\").then(function(t){e.data.streetList=t.data})},e.confirmStreet=function(e,n){e.stopPropagation(),t.path(\"\"),n&&(a.street=n.address,a.geoLatitude=n.lat,a.geoLongitude=n.lng)},e.save=function(){return d.form.$invalid?s.resolve(!1):(d.edit=d.cur=!1,e.outAddress.edit=e.outAddress.cur=!1,a.isDefault=!0,n[d.isNewAddress?\"addOne\":\"update\"](a).then(function(t){return a=e.addr=t.data,e.outAddress.cur=d.cur=!0,angular.extend(e.outAddress,t.data),t.data}))},e.leave=function(){e.outAddress.cur=d.cur=!1},e.valid=function(){return d.form.$submitted=!0,!d.form.$invalid},e.initForm=function(e){d.form=e,d.showFakeInput=!a.province},e.locate=function(t){t.stopPropagation(),d.locating=!0,i.getLocation(function(t){i.getLocationName(t.latitude,t.longitude).then(function(n){var s=n.data.result;s=angular.pick(s.addressComponent,\"province\",\"city\",\"district\",\"street\",\"street_number\");var i=o.gcj02ToBd09({lat:t.latitude,lng:t.longitude});s.geoLatitude=i.lat,s.geoLongitude=i.lng,r.regularizeAddress(s,e.range),angular.extend(a,s)})[\"catch\"](angular.noop).then(function(){d.locating=!1})},function(){d.locating=!1})}}}}]),angular.module(\"xw.directives\").directive(\"autoFocus\",function(){return{restrict:\"A\",link:function(e,t){setTimeout(function(){t[0].focus()},100)}}}),angular.module(\"xw.directives\").directive(\"backButton\",function(){return{template:'<div class=\"back-icon\" ng-click=\"back()\"></div>',link:function(e){e.back=function(){history.length<=1&&(location.href=\"/mobile/\"),history.back()}}}}),angular.module(\"xw.directives\").directive(\"captureClick\",[\"$parse\",\"$rootScope\",function(e,t){return{restrict:\"A\",compile:function(n,r){var s=e(r.captureClick,null,!0);return function(e,n){n[0].addEventListener(\"click\",function(n){var r=function(){s(e,{$event:n})};t.$$phase?e.$evalAsync(r):e.$apply(r)},!0)}}}}]),angular.module(\"xw.directives\").directive(\"confirm\",[\"$q\",function(e){return{restrict:\"E\",transclude:!0,scope:{show:\"=\"},templateUrl:\"confirm.html\",link:function(t){var n;t.show=function(){return n=e.defer(),t.showModal(),n.promise},t.confirm=function(){t.close(!0),n.resolve(!0)},t.cancel=function(){t.close()},t.preClose=function(){n.resolve(!1)}}}}]),angular.module(\"xw.directives\").directive(\"couponCode\",[\"Coupon\",\"$q\",function(e,t){return{restrict:\"A\",scope:{couponPrice:\"=couponCode\",couponCodeType:\"=\"},require:\"?ngModel\",link:function(n,r,s,i){i&&(i.$asyncValidators.couponCode=function(r,s){var i=r||s;return i?(i=8==i.length?\"zz\"+i:i,e.getCouponInfo(i).then(function(e){var r=e.data,s=new Date(e.headers(\"date\")),i=new Date(r.startDate),o=new Date(r.endDate);return s>=i&&o>=s?(\"promocodepercentage\"==r.couponType&&(n.couponCodeType=\"promocodepercentage\"),void(n.couponPrice=r.price)):t.reject(\"未在可使用期限内\")})):t.resolve(1)})}}}]),angular.module(\"xw.directives\").directive(\"errTip\",function(){return{scope:{form:\"=\",error:\"@\",name:\"@\"},transclude:!0,templateUrl:\"err-tip.html\"}}),angular.module(\"xw.directives\").directive(\"flashClass\",function(){return{restrict:\"A\",scope:{options:\"=flashClass\"},link:function(e,t){var n=e.options.duration||700,r=e.options.className||\"flash\";e.$watch(\"options.exp\",function(e){e&&setTimeout(function(){t.addClass(r),setTimeout(function(){t.removeClass(r)},n)},200)})}}}),angular.module(\"xw.directives\").directive(\"geetestSmsButton\",[\"Debug\",\"User\",\"$interval\",\"$window\",\"Alert\",\"$http\",function(e,t,n,r,s,i){return{scope:{valid:\"@\",mobile:\"@\",type:\"@\",triggered:\"=\"},templateUrl:\"geetest-sms-button.html\",link:function(e){function o(t,n){var r=e.state,s=!!n;\"mobile\"==t?0===r&&s?e.state=1:1!=r||s?2!=r||s?4==r&&s?e.state=5:5!=r||s||(e.state=4):e.state=4:e.state=0:\"show-geetest\"==t?1!=r&&5!=r||(e.state=2):\"hide-geetest\"==t?2==r&&(e.state=3):\"show-refetch\"==t&&3==r&&(e.state=s?5:4)}i.get(\"/api/user/signup/geetest/register\").success(function(i){var d=document.createElement(\"script\"),c={gt:\"d41d16df5b99010ec511ec10aaaafcb8\",width:document.body.offsetWidth,challenge:i.challenge};d.src=\"http://api.geetest.com/get.php?\"+Object.keys(c).map(function(e){return e+\"=\"+c[e]}).join(\"&\");var u=angular.element(document.getElementById(\"geetestContainer\"));u.append(d),r.gt_custom_ajax=function(r,i,d){if(r){var c=angular.element(document.getElementById(\"geetestContainer\")).find(\"input\"),u={geetest_challenge:c[0].value,geetest_validate:c[1].value,geetest_seccode:c[2].value,type:e.type,mobile:e.mobile},l=n(function(){if(!--e.remains){n.cancel(l),e.remains=a,e.triggered=!0,o(\"show-refetch\",\"true\"==e.valid);try{GeeTest[0].refresh()}catch(t){}}},1e3);t.getSmsCode(u).success(function(){console.log(\"success\")})[\"catch\"](function(e){s.show(e.data.validationStatus,\"验证码发送失败\")}),o(\"hide-geetest\")}}});var a=30;e.remains=30,e.$watch(\"mobile\",function(t){o(\"mobile\",\"true\"==e.valid)}),e.showGeetest=function(){o(\"show-geetest\")},e.state=0}}}]),angular.module(\"xw.directives\").directive(\"imgLazyLoad\",[\"$window\",\"$document\",\"$timeout\",function(e,t,n){function r(e){for(var t=e.offsetTop;e=e.offsetParent;)t+=e.offsetTop;return t}function s(){return a.documentElement.clientHeight+(e.scrollY||a.documentElement.scrollTop||a.body.scrollTop)}var i,o=[],a=t[0];return s.ok=!0,angular.element(e).on(\"scroll\",function(){i=s();for(var e,t=0;t<o.length;)r(o[t][0])<i?(e=angular.element(o[t][0]),e[0].src=o[t][1].$eval(e.attr(\"img-lazy-load\")),o.splice(t,1)):t++}),{restrict:\"A\",link:function(e,t,n){var a=t[0];o.push([a,e]);var d=e.$watch(n.imgLazyLoad,function(e){e&&(d(),s.ok&&(i=s(),s.ok=!1,setTimeout(function(){s.ok=!0},120)),r(a)<i&&o.some(function(t,n){return t[0]==a?(a.src=e,o.splice(n,1),!0):void 0}))});e._lazyDestroyBinded||(e._lazyDestroyBinded=!0,e.$on(\"$destroy\",function(){for(var t=0;t<o.length;)o[t][1]==e?o.splice(t,1):t++}))}}}]),angular.module(\"xw.directives\").directive(\"menuNav\",function(){return{restrict:\"E\",scope:{path:\"@\",localBag:\"=\",isAddressOk:\"&\"},templateUrl:\"menu-nav.html\",link:function(e){e.goToCart=function(){location.href=\"/mobile/cart\"},\"/mobile/me\"==location.pathname&&(e.path=\"/mobile/me\")}}}),angular.module(\"xw.directives\").directive(\"modal\",function(){return{restrict:\"E\",transclude:!0,scope:{show:\"=\",close:\"=\",toggle:\"=\",preClose:\"=?\"},templateUrl:\"modal.html\",link:function(e,t,n){function r(t,n){t&&t.stopPropagation(),void 0===n?e.css.show=!e.css.show:e.css.show=n}e.css={show:!1},\"show\"==n[\"default\"]&&(e.css.show=!0),e.show=function(){r(event,!0)},e.close=function(t){!t&&e.preClose&&e.preClose(),r(event,!1)},e.toggle=function(){r(event)}}}}),angular.module(\"xw.directives\").directive(\"shoppingProgressBar\",function(){return{templateUrl:\"shopping-progress-bar.html\",scope:!0,link:function(e){var t=location.pathname;\"/mobile/cart\"==t?e.state=\"state1\":\"/mobile/orderaddress\"==t?e.state=\"state2\":\"/mobile/orderpay\"==t&&(e.state=\"state3\")}}}),angular.module(\"xw.directives\").directive(\"smsButton\",[\"Debug\",\"User\",\"$interval\",function(e,t,n){return{scope:{valid:\"@\",mobile:\"@\",type:\"@\"},templateUrl:\"sms-button.html\",link:function(r){function s(){return r.$watch(\"mobile\",function(e){0===r.state&&e&&11==e.length?r.state=1:1!==r.state||e&&11==e.length?3===r.state&&e&&11==e.length?r.state=4:4!==r.state||e&&11==e.length||(r.state=3):r.state=0})}r.state=0,r.remains=60;var i=s();r.getSmsCode=function(){r.state=2,i&&(i(),i=null);var o=n(function(){--r.remains||(n.cancel(o),r.remains=60,e.assert(\"string\"==typeof r.valid,\"由@传入的valid应当是string\"),\"true\"===r.valid?r.state=4:r.state=3,i=s())},1e3);t.getSmsCode({mobile:r.mobile,type:r.type}).then(function(e){e.data.code})[\"catch\"](function(t){alert(\"获取验证码失败,请稍后重试\"),e.alert(t)})}}}}]),angular.module(\"xw.directives\").directive(\"thanksgiving\",[\"$timeout\",function(e){return{restrict:\"E\",templateUrl:\"thanksgiving.html\",link:function(t){e(function(){t.close()},4500)}}}]);\n//# sourceMappingURL=app.min.js.map\n"],"file":"js/app.min.933f7b64.js","sourceRoot":"/source/"}