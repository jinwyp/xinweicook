{"version":3,"names":[],"mappings":"","sources":["cook.js"],"sourcesContent":["angular.module('xw.controllers').controller('cookCtrl', function ($scope, Address, Dishes, Debug, User, $localStorage) {\n    $scope.user = null;\n    $scope.address = '';\n    $scope.addressLoaded = false;\n\n    $scope.likeDish = function (dish) {\n        Dishes.like(dish._id).then(function (res) {\n            // 如果成功,并不是很有必要重新拉取用户列表.因为这里不会更新用户信息.\n            dish.liked = !dish.liked;\n        }).catch(Debug.promiseErrFn('更新用户喜欢状态失败'))\n    };\n\n    $scope.addDish = function (dish) {\n        $scope.curDish = dish;\n        if (!dish.count) {\n            dish.count = 1;\n        }\n    };\n\n    // for flash-class\n    $scope.addressCount = 0;\n    $scope.isAddressOk = function (isClick) {\n        if (!$scope.address) {\n            isClick && $scope.addressCount++;\n            return false\n        }\n        if (!$scope.address.isAvailableForEat && $scope.path == '/eat') {\n            isClick && $scope.addressCount++;\n            return false;\n        }\n\n        return true;\n    };\n\n    function init() {\n        var paths = location.href.split('/');\n        var dishId = $scope.dishId = paths[paths.length - 1];\n\n        Dishes.getOne(dishId).then(function (res) {\n            $scope.dish = res.data;\n        }).then(Debug.promiseErrFn('获取Dish失败'));\n\n        User.getUserInfo().then(function (res) {\n            $scope.user = res.data;\n        });\n\n        Address.getList().then(function (res) {\n            $scope.addresses = res.data;\n            if (!$scope.addresses.length) return;\n\n            // 选择了一个地址,将此作为默认地址\n            if ($localStorage.selectedAddress) {\n                $scope.address = $localStorage.selectedAddress;\n                $scope.address.isDefault = true;\n                Address.update($scope.address).then(function () {\n                    delete $localStorage.selectedAddress;\n                });\n            } else {\n                // 如果没有经过选择,则选择一个可配送默认地址\n                $scope.addresses.some(function (addr) {\n                    if (addr.isDefault) {\n                        $scope.address = addr;\n                        return true;\n                    }\n                });\n\n                if (!$scope.address) {\n                    $scope.address = $scope.addresses[0];\n                }\n            }\n\n            // 保存warehouse到下单的时候需要,不过回到这个页面的时候会被cleanLocalStorage清除\n            $localStorage.warehouse = $scope.warehouse = $scope.address.warehouse;\n            $localStorage.orderAddress = $scope.address;\n        }).catch(angular.noop).then(function () {\n            $scope.addressLoaded = true;\n        });\n    }\n\n    init();\n});"],"file":"js/controllers/cook.95baaaae.js","sourceRoot":"/source/"}