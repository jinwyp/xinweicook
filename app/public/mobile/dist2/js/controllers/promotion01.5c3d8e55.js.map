{"version":3,"names":[],"mappings":"","sources":["promotion01.js"],"sourcesContent":["angular.module('xw.controllers').controller('promotion01', function (Coupon, $scope, Debug, Alert, User, $location) {\n\n    $scope.exchange = function (code) {\n        var card;\n        $scope.cards.some(function (el) {\n            if (el.code == code) {\n                card = el;\n                return true;\n            }\n        })\n        if (!card || card.exchanged) return;\n        Coupon.exchangeCouponCode(code).then(function () {\n            card.exchanged = true;\n            alert('兑换成功!')\n        }).catch(function () {\n            alert('兑换失败')\n        })\n    };\n\n    function init() {\n        var cards = $scope.cards = []\n        //var cards = $scope.cards = [\n        //    {\n        //        name: '美丽公主礼券',\n        //        price: 6,\n        //        code: 'XWPRM00301'\n        //    }, {\n        //        name: '气场女王礼券',\n        //        price: 6,\n        //        code: 'XWPRM00302'\n        //    }\n        //];\n\n        var path = $location.path()\n\n        if (path == '/queen') {\n            cards.push({\n                name: '气场女王礼券',\n                price: 6,\n                code: 'XWPRM00302'\n            })\n        } else {\n            $scope.cards.push(            {\n                name: '美丽公主礼券',\n                price: 6,\n                code: 'XWPRM00301'\n            })\n        }\n\n        User.getUserInfo().then(function (res) {\n            res.data.couponList.forEach(function (el) {\n                // for old name convention\n                var code = el.name.zh.split(' ')[1]\n                var exist;\n                if (code) {\n                    exist = cards.some(function (card) {\n                        if (card.code == code) {\n                            card.exchanged = true;\n                            return true;\n                        }\n                    })\n                }\n                if (exist) return;\n                cards.some(function (card) {\n                    if (card.name == el.name.zh) {\n                        card.exchanged = true;\n                        return true;\n                    }\n                })\n            })\n        })\n    }\n\n    init();\n\n});"],"file":"js/controllers/promotion01.5c3d8e55.js","sourceRoot":"/source/"}